---
title: 2-2.创建插件
---

本节内容基于[Vite插件API](https://vitejs.cn/vite3-cn/guide/api-plugin.html)。

`vite` 的插件机制是基于 `Rollup` 生态的。也就是说[大多数兼容情况下](https://vitejs.cn/vite3-cn/guide/api-plugin.html#rollup-plugin-compatibility)，`Rollup` 插件能够直接用于 `vite` 工程中。

您可以查看完整的[Rollup插件文档](https://cn.rollupjs.org/plugin-development/)。

## 定义与使用

一个插件的简单定义与使用方式如下：

```js
// myPlugin.js
const fileRegex = /\.(my-file-ext)$/

export default function myPlugin() {
  return {
    name: 'transform-file',

    transform(src, id) {
      if (fileRegex.test(id)) {
        return {
          code: compileFileToJS(src),
          map: null // 如果可行将提供 source map
        }
      }
    }
  }
}
```

```js
// vite.config.js
import { defineConfig } from 'vite'
import myPlugin from 'myPlugin.js'

export default defineConfig({
  plugins: [myPlugin()]
})
```

## 通用钩子

正如上文所述，`vite` 插件机制是基于 `Rollup` 的。因此二者具有一些[通用钩子](https://vitejs.cn/vite3-cn/guide/api-plugin.html#universal-hooks)。

以下钩子在**服务器启动时**被调用：

- `options`
- `buildStart`

以下钩子会在**每个传入模块请求时**被调用：

- `resolveId`
- `load`
- `transform`

以下钩子在**服务器关闭时**被调用：

- `buildEnd`
- `closeBundle`

:::tip
请注意 `moduleParsed` 钩子在开发中是**不会**被调用的，因为 `Vite` 为了性能会避免完整的 `AST` 解析。
:::

## 特殊钩子

## 虚拟模块

## 插件顺序
