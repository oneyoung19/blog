---
title: 2.è¿é€šæ€§
---

`HTML5` çš„è¿é€šæ€§åŠŸèƒ½ä¸»è¦æ¶‰åŠä¸æœåŠ¡å™¨æˆ–å…¶ä»–å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡å’Œäº¤äº’ï¼Œä»¥åŠåœ¨ç½‘é¡µä¸Šå®ç°å®æ—¶çš„ã€åŠ¨æ€çš„æ“ä½œã€‚

`HTML5` æä¾›äº† `Web Sockets`ã€`Server-Sent Events`ã€`Fetch API` ç­‰æŠ€æœ¯ï¼Œä½¿å¾—ä¸æœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ›´åŠ é«˜æ•ˆå’Œå®æ—¶ï¼Œæ”¯æŒåŒå‘é€šä¿¡å’ŒæœåŠ¡å™¨æ¨é€ã€‚

## 2-1.Drag

æ‹–æ‹½äº‹ä»¶ï¼ˆ`Drag`ï¼‰å…è®¸ç”¨æˆ·é€šè¿‡ç‚¹å‡»å¹¶æ‹–åŠ¨é¡µé¢ä¸Šçš„å…ƒç´ æ¥å®ç°äº¤äº’æ“ä½œã€‚

### 2-1-1.æ‹–æ‹½å…ƒç´ 

æ‹–æ‹½å…ƒç´ åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šæ‹–æ‹½æº `origin` å’Œæ‹–æ‹½ç›®æ ‡ `target`ã€‚

æ‹–æ‹½ç›¸å…³äº‹ä»¶æ¶‰åŠåˆ°ï¼š

- æ‹–æ‹½æºï¼š`dragstart`ã€`drag`ã€`dragend`
- æ‹–æ‹½ç›®æ ‡ï¼š`dragenter`ã€`dragover`ã€`dragleave`ã€`drop`

### 2-1-2.æ‹–æ‹½æ³¨æ„ç‚¹

1. `img` å›¾ç‰‡å…ƒç´ é»˜è®¤æ˜¯èƒ½å¤Ÿæ‹–æ‹½çš„ï¼Œå…¶ä»–å…ƒç´ éœ€è¦è®¾ç½® `DOM` æ ‡ç­¾ä¸Šçš„ `draggable` å±æ€§ä¸º `true`ã€‚

2. å¦å¤–ä¸ºäº†ä¿è¯ `drop` äº‹ä»¶çš„è§¦å‘ï¼Œéœ€è¦åœ¨ `dragover` äº‹ä»¶ä¸­è°ƒç”¨ `event.preventDefault()` æ–¹æ³•ï¼Œå·²é˜»æ­¢é»˜è®¤äº‹ä»¶ã€‚

### 2-1-3.æ•°æ®é€šä¿¡

äº‹ä»¶å¯¹è±¡ `event` ä¸­çš„ `dataTransfer` å±æ€§ç”¨äºåœ¨æ‹–æ‹½æºå’Œæ‹–æ‹½ç›®æ ‡ä¹‹é—´ä¼ é€’æ•°æ®ã€‚

`dataTransfer` å±æ€§ä¸­çš„ `setData` æ–¹æ³•ç”¨äºè®¾ç½®æ•°æ®ï¼Œ`getData` æ–¹æ³•ç”¨äºè·å–æ•°æ®ã€‚

å¦å¤–ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œ`setData` æ–¹æ³•åªèƒ½è®¾ç½®å­—ç¬¦ä¸²ç±»å‹çš„æ•°æ®ï¼Œå¦‚æœéœ€è¦ä¼ é€’å¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨ `JSON.stringify` æ–¹æ³•å°†å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚

è­¬å¦‚ï¼š

```js
// æ‹–æ‹½æº
event.dataTransfer.setData('text/plain', JSON.stringify({ name: 'å¼ ä¸‰' }))

// æ‹–æ‹½ç›®æ ‡
const data = JSON.parse(event.dataTransfer.getData('text/plain'))
```

### 2-1-3.Demo

<template>
  <div class="home">
    <div class="source">
      <div class="source-item">
        <div class="img">
          <img id="sourceImg" src="./images/cat.jpg" alt="" ref="sourceImg">
          <div id="sourceText" draggable="false" ref="sourceText">æˆ‘æ˜¯ä¸€åªçŒ«ï¼Œæ‹–æˆ‘åˆ°ğŸ‘‰ğŸ»</div>
        </div>
      </div>
    </div>
    <div id="target" class="target" ref="target">
    </div>
  </div>
</template>

<script>
export default {
  name: 'home',
  data () {
    return {
      startOffsetX: 0,
      startOffsetY: 0
    }
  },
  mounted () {
    // æ‹–åŠ¨å¯¹è±¡ dragstart drag dragend
    const sourceImg = document.querySelector('#sourceImg')
    const target = document.querySelector('#target')
    sourceImg.ondragstart = this.ondragstart
    // ç›®æ ‡åŒºåŸŸ dragenter dragover dragleave  é‡Šæ”¾drop  dragenterã€dragoverä»¥åŠdropé»˜è®¤æ‹’ç»æ¥å—é‡Šæ”¾çš„å…ƒç´ ï¼Œéœ€è¦é˜»æ­¢æµè§ˆå™¨çš„é»˜è®¤äº‹ä»¶
    target.ondragenter = this.ondragenter
    target.ondragover = this.ondragover
    target.ondrop = this.ondrop
  },
  methods: {
    // æ‹–æ‹½å…ƒç´ 
    ondragstart (e) {
      // åœ¨å¼€å§‹æ‹–æ‹½æ—¶ï¼Œå°†å…ƒç´ çš„idå€¼ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼Œè®¾ç½®åˆ°dataTransferä¸Šï¼Œè¿™æ ·åœ¨æ‹–æ‹½ç»“æŸæ—¶å°±èƒ½é€šè¿‡getDataè·å–åˆ°id,è¿™æ ·å°±çŸ¥é“æ‹–æ‹½æ˜¯å…·ä½“å“ªä¸ªå…ƒç´ 
      e.dataTransfer.setData('Text', e.target.id)
      // è®°å½•ä¸‹é¼ æ ‡åœ¨å…ƒç´ ä¸Šçš„è·ç¦»ã€‚å› ä¸ºæ‹–æ‹½è¿‡ç¨‹ä¸­è·å–åˆ°çš„offsetXä»¥åŠoffsetYéƒ½æ˜¯é’ˆå¯¹äºé¼ æ ‡æ¥è¯´ã€‚
      this.startOffsetX = e.offsetX
      this.startOffsetY = e.offsetY
    },
    // ç›®æ ‡åŒºåŸŸ  => å¿…é¡»åœ¨dragoveræ—¶é˜»æ­¢é»˜è®¤äº‹ä»¶ï¼Œæ‰ä¼šè§¦å‘dropäº‹ä»¶ã€‚å¯¹å…ƒç´ çš„å¤„ç†ä¸€èˆ¬æ”¾åœ¨dropäº‹ä»¶ä¸­å³å¯ã€‚
    ondragenter (e) {
      console.log('ondragenter')
    },
    ondragover (e) {
      e.preventDefault()
    },
    ondrop (e) {
      const id = e.dataTransfer.getData('Text')
      if (!id) {
        return
      }
      // è·å–ç›®æ ‡åŒºåŸŸ
      const target = document.getElementById('target')
      // è·å–åˆ°æ‹–æ‹½å…ƒç´ 
      const ele = document.getElementById(id)
      // å¤åˆ¶ä¸€ä»½æ‹–æ‹½å…ƒç´ 
      const node = ele.cloneNode(true)
      // è®¾ç½®nodeçš„æ ·å¼å±æ€§ => å‡å»åˆšå¼€å§‹è®°å½•çš„å€¼ã€‚å¦å¤–ç”±äºè·å–åˆ°çš„offsetX Yéƒ½æ˜¯æ•´æ•°ï¼Œæ‰€ä»¥è¿™ç§æ¾å¼€é¼ æ ‡æœ‰äº›è®¸çš„è·ç¦»å‡ºå…¥æ˜¯å¾ˆæ­£å¸¸çš„ã€‚
      node.style.position = 'absolute'
      node.style.left = e.offsetX - this.startOffsetX + 'px'
      node.style.top = e.offsetY - this.startOffsetY + 'px'
      // å°†å¤åˆ¶å…ƒç´ æ·»åŠ åˆ°ç›®æ ‡åŒºåŸŸ
      target.appendChild(node)
    }
  }
}
</script>

<style scoped>
.home {
  display: flex;
  justify-content: space-between;
  width: 100%;
}
.source {
  width: 30%;
  height: 800px;
  background-color: #348AC7;
}
.source-item {
  width: 160px;
  height: 100px;
}
img {
  width: 120px;
  height: 80px;
}
.target {
  position: relative;
  width: 60%;
  height: 800px;
  border: 1px solid #ccc;
}
</style>


## 2-2.WebSocket

## 2-3.Server-Sent Events

## 2-4.EventStream

`ChatGPT`
