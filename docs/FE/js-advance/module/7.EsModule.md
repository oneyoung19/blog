---
title: 7.EsModule
---

`EsModule` æ˜¯ `Es6` ä¸­æä¾›çš„ä¸€ç§æ–°çš„æ¨¡å—åŒ–è¯­æ³•æ ‡å‡†ã€‚

**é‡‡ç”¨äº† `EsModule` çš„ä»£ç ä¼šè‡ªåŠ¨å¯ç”¨ä¸¥æ ¼æ¨¡å¼ `use strict`**ã€‚

å¯¼å‡ºä½¿ç”¨ `export` æˆ– `export default` è¯­æ³•ã€‚

å¯¼å…¥ä½¿ç”¨ `import from` æˆ–è€… `import()` è¯­æ³•ã€‚

:::tip
`export`ã€`export default`ã€`import from` è¯­æ³•å¯ä»¥æ”¾åœ¨**é¡¶å±‚ä»£ç çš„ä»»ä½•ä½ç½®**ï¼Œä½†ä¸èƒ½æ”¾åœ¨**å—çº§ä½œç”¨åŸŸ**å†…ã€‚

å› ä¸º `EsModule` æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µæ‰§è¡Œçš„ï¼Œåœ¨ä»£ç è¿è¡Œä¹‹å‰ã€‚

è¿™å°†ä¸åˆ©äº `EsModule` çš„é™æ€åˆ†æï¼Œè¿èƒŒäº† `EsModule` çš„è®¾è®¡å‡†åˆ™ã€‚
:::

é€šå¸¸ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸ºäº†ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬**å»ºè®®å°† `import from` è¯­æ³•æ”¾ç½®åœ¨æ–‡ä»¶å¤´éƒ¨ï¼Œè€Œ `export` ç›¸å…³è¯­æ³•æ”¾åœ¨æ–‡ä»¶åº•éƒ¨**ã€‚

## 7-1.export

`export` ç”¨æ¥å¯¼å‡ºæ¨¡å—ã€‚

### 7-1-1.å‘½åå¯¼å‡º

**å‘½åå¯¼å‡º**ï¼Œé¡¾åæ€ä¹‰ï¼ŒæŒ‡çš„æ˜¯å¯¼å‡ºçš„æ˜¯å‘½åå½¢å¼ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œ**è¿™ç§å½¢å¼çš„å¯¼å‡ºï¼Œå¿…é¡»è¦æœ‰åå­—ã€‚è¿™æ ·çš„è¯ï¼Œå¯¼å‡ºä¸åå­—æœ‰äº†ç»‘å®šå…³ç³»ï¼Œå¯¼å…¥æ—¶æ‰èƒ½è·å–åˆ°å…·ä½“çš„å¯¼å‡º**ã€‚

å› æ­¤ï¼Œå¯¼å‡ºä¸€ä¸ªå€¼æˆ–è€…åŒ¿åå‡½æ•°å£°æ˜ï¼Œéƒ½æ˜¯ä¸è¡Œçš„ã€‚

- å¯ä»¥å¯¼å‡ºä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡ç»‘å®šå€¼ã€‚
- å¯ä»¥å¯¼å‡ºä¸€ä¸ªå‘½åå‡½æ•°å£°æ˜æˆ–è€…å‡½æ•°è¡¨è¾¾å¼ã€‚

åœ¨é˜®ä¸€å³°è€å¸ˆçš„[ECMAScript 6 å…¥é—¨](https://es6.ruanyifeng.com/#docs/module#export-%E5%91%BD%E4%BB%A4)ä¸­ï¼Œå°†è¿™é‡Œçš„ `export` çœ‹åšæ˜¯å¯¼å‡ºä¸€ä¸ªæ¥å£ï¼Œä½†å¹¶æ²¡æœ‰å¯¹æ¥å£çš„å«ä¹‰åŠ ä»¥è¯¦ç»†è§£é‡Šå³å‰–æã€‚

å› æ­¤ï¼Œä¸Šè¿°çš„åŠ ç²—é‡ç‚¹æ–‡å­—æ˜¯ç¬”è€…ä¸ªäººçš„ç†è§£ï¼Œæ–¹ä¾¿æœ¬äººè®°å¿†ã€‚

**ä»¥ä¸‹æ˜¯èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œçš„å‘½åå¯¼å‡ºå½¢å¼**ï¼š

```js
var key = 'foo'

// 1.å¯¼å‡ºä¸€ä¸ªå˜é‡
export var name = 'Jack'

// 2.å¯¼å‡ºä¸€ä¸ªå‡½æ•°
export function getName () {
  return name
}

// 3.å¯¼å‡ºä¸€ä¸ªclass
export class MyClass {}

// 4.è™½ç„¶ç±»ä¼¼å¯¹è±¡çš„å†™æ³•ï¼Œä½†å¹¶ä¸æ˜¯å¯¼å‡ºå¯¹è±¡ï¼Œå¯ä»¥çœ‹åšå¯¼å‡ºä¸€ä¸ªé›†åˆ
export {
  key
}
```

**ä»¥ä¸‹æ˜¯ä¸èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œçš„å‘½åå¯¼å‡ºå½¢å¼**ï¼š

```js
var key = 'foo'

// 1.ä¸èƒ½å¯¼å‡ºä¸€ä¸ªå€¼ å› ä¸ºè¿™é‡Œç›¸å½“äºexport 'Jack'ï¼Œå¯¼å…¥çš„æ—¶å€™æ²¡æ³•ç”¨
var name = 'Jack'
export name

// 2.ä¸èƒ½å¯¼å‡ºåŒ¿åå‡½æ•°
export function () {
  return name
}

// 3.å¯¼å‡ºä¸€ä¸ªæœªå‘½åçš„class
export class {}

// 4.è¿™é‡Œå¹¶ä¸æ˜¯å¯¼å‡ºå¯¹è±¡ æ‰€ä»¥è¿™ç§å¯¹è±¡çš„å†™æ³•å¹¶ä¸ä¼šæ”¯æŒ
export {
  key: 'bar'
}
```

### 7-1-2.åˆ«åå¯¼å‡º

åœ¨å¯¼å‡ºçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ `as` è¿›è¡Œé‡å‘½åï¼š

```js
var v1 = 'Bruce Wayne'
var v2 = 'Clark Kent'

export {
  v1: BatMan,
  v2: SuperMan,
  v2: IronHero 
}
```

å¯¹åº”çš„ï¼Œåœ¨å¯¼å…¥çš„æ—¶å€™ï¼Œå°†ä¸ä¼šä½¿ç”¨ `v1`ã€`v2`ï¼Œè€Œæ˜¯ä½¿ç”¨æ–°çš„åå­—ã€‚

æ­£å¦‚ä¸Šè¿°ä»£ç ï¼Œå¯ä»¥åˆ©ç”¨ `as` å°†åŒä¸€å˜é‡è¿›è¡Œå¤šæ¬¡é‡å‘½åå¯¼å‡ºã€‚ 

### 7-1-3.é»˜è®¤å¯¼å‡º

å…³äºé»˜è®¤å¯¼å‡ºï¼Œéœ€è¦æå‰è¯´æ˜çš„ä¸¤ç‚¹æ˜¯ï¼š

:::tip
1. **é»˜è®¤å¯¼å‡ºç›¸å½“äºå¯¼å‡ºåå·²è®¾ç½®ä¸º `default` çš„å‘½åå¯¼å‡º**ã€‚
   
2. **é»˜è®¤å¯¼å‡ºåœ¨åŒä¸€ä¸ªæ–‡ä»¶å†…åªèƒ½è°ƒç”¨ä¸€æ¬¡**ã€‚
:::

```js
var name = 'Jack'
// â‘ 
export default name
// â‘¡
export {
  name as default
}
```

è¿™å¯¼è‡´çš„ç»“æœæ˜¯**åœ¨ä½¿ç”¨é»˜è®¤å¯¼å‡ºæ—¶ï¼Œæˆ‘ä»¬æ— éœ€å†æŒ‡å®šå¯¼å‡ºåã€‚**

åœ¨ä½¿ç”¨é»˜è®¤å¯¼å‡ºæ—¶ï¼ŒæŒ‡å®šå¯¼å‡ºåï¼Œå±äºç”»è›‡æ·»è¶³ã€‚ç¨‹åºå¹¶ä¸èƒ½æ­£å¸¸æ‰§è¡Œã€‚

**ä»¥ä¸‹æ˜¯èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œçš„é»˜è®¤å¯¼å‡ºå½¢å¼**ï¼š

```js
var key = 'foo'
var name = 'Jack'

// 1.å¯¼å‡ºä¸€ä¸ªå˜é‡
export default name

// 2.å¯¼å‡ºä¸€ä¸ªå‡½æ•°
export default function () {
  return name
}

// 3.å¯¼å‡ºä¸€ä¸ªclass
export default class {}

// 4.å¯¼å‡ºä¸€ä¸ªå¯¹è±¡
export default {
  key
}
```

**ä»¥ä¸‹æ˜¯ä¸èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œçš„é»˜è®¤å¯¼å‡ºå½¢å¼**ï¼š

```js
var key = 'foo'

// 1.å¯¼å‡ºä¸€ä¸ªå˜é‡
export default var name = 'Jack'

// 2.å¯¼å‡ºä¸€ä¸ªå‡½æ•°è¡¨è¾¾å¼
export default const getName = function () {
  return name
}

// 3.å¯¼å‡ºä¸€ä¸ªclassè¡¨è¾¾å¼
export default const MyClass = class {}
```

**æ¯”è¾ƒç‰¹æ®Šçš„ä¸€ç‚¹æ˜¯ï¼Œå¯ä»¥é»˜è®¤å¯¼å‡ºå‡½æ•°å£°æ˜ï¼Œä½†ä¸èƒ½é»˜è®¤å¯¼å‡ºå‡½æ•°è¡¨è¾¾å¼**ï¼š

```js
// 1.å¯¼å‡ºä¸€ä¸ªå‡½æ•°å£°æ˜âœ…
export default function getName () {
  return 'Jack'
}

// 2.å¯¼å‡ºä¸€ä¸ªclasså£°æ˜âœ…
export default class MyClass {}
```

### 7-1-4.é‡æ–°å¯¼å‡º

**é‡æ–°å¯¼å‡º**çš„åº”ç”¨åœºæ™¯ï¼Œå¤§å¤šæ˜¯åœ¨å¼•ç”¨åŒ…çš„æ—¶å€™ï¼Œè¯¥æ–‡ä»¶åªä½œ**ä¸­è½¬ä½œç”¨**ã€‚

å®é™…å«ä¹‰ï¼Œå°±æ˜¯å¯¼å…¥åŒ…çš„æ—¶å€™ï¼ŒåŒæ—¶ç›´æ¥é‡æ–°å¯¼å‡ºåŒ…ã€‚

ä»ä¸‹æ–‡ä¸­çš„å¯¼å…¥æ–¹å¼ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å‡ ç§ï¼š

```js
// å‘½åå¯¼å…¥
import { moduleA } from './path/to/module'

// åˆ«åå¯¼å…¥
import { moduleA as a } from './path/to/module'
import * as totalModule from './path/to/module' // è¿™é‡Œçš„ * ä¼šåŒ…å«æ‰€æœ‰çš„å‘½åå¯¼å‡ºå’Œé»˜è®¤å¯¼å‡º

// é»˜è®¤å¯¼å…¥
import myModule from './path/to/module'
```

é‚£ä¹ˆå¯¹äºé‡æ–°å¯¼å‡ºï¼Œä¸Šé¢çš„å¯¹åº”è¯­å¥ä¸ºï¼š

```js
// é‡æ–°å¯¼å‡º-å‘½åå¯¼å…¥
export { moduleA } from './path/to/module'

// é‡æ–°å¯¼å‡º-åˆ«åå¯¼å…¥
export { moduleA as a } from './path/to/module'
export * as totalModule from './path/to/module'

// é‡æ–°å¯¼å‡º-é»˜è®¤å¯¼å…¥
export { default } from './path/to/module'
```

## 7-2.é™æ€import

é™æ€ `import` æŒ‡çš„æ˜¯ `import ... from ''` è¯­æ³•ã€‚

é™æ€ `import` è¯­æ³•æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µæ‰§è¡Œçš„ï¼Œåœ¨ä»£ç è¿è¡Œä¹‹å‰ã€‚æ‰€ä»¥ä¸‹è¿°ä»£ç èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œï¼š

```js
foo()

import { foo } from 'my_module'
```

å› ä¸º `import { foo } from 'my_module'` è¢«æå‰è§£æï¼Œè¿™æ ·çš„è¯ï¼Œè°ƒç”¨ `foo()` æ—¶å·²ç»èƒ½å¤Ÿæ‹¿åˆ° `foo` è¿™ä¸ªå˜é‡äº†ã€‚

**é™æ€ `import` è¯­æ³•èƒ½å¤Ÿæ”¾åœ¨æ¨¡å—é¡¶å±‚ä»£ç çš„ä»»ä½•ä½ç½®ï¼Œä¸èƒ½æ”¾ç½®åœ¨å—çº§ä½œç”¨åŸŸå†…**ã€‚

å¦å¤–ï¼Œ**`import` å¯¼å…¥çš„å˜é‡ç›¸å½“äº `const` å£°æ˜çš„å¸¸é‡ï¼Œä¸èƒ½æ›´æ”¹**ã€‚

### 7-2-1.å‘½åå¯¼å…¥

å‘½åå¯¼å…¥æ˜¯ä¸å‘½åå¯¼å‡ºç›¸å¯¹åº”çš„ã€‚

```js
// utils.js
export var name = 'Jack'
export function getName () {
  return name
}

// main.js
import { name, getName } from 'path/to/utils.js'
console.log(name)
console.log(getName())
```

éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œè¿™ç§å½¢å¼å¹¶ä¸æ˜¯åˆ©ç”¨äº† `Es6` ä¸­çš„**è§£æ„èµ‹å€¼**ã€‚

è¿™ä¸ `CommonJS` æ˜¯æœ‰åŒºåˆ«çš„ã€‚è­¬å¦‚ï¼š

```js
// è¿™é‡Œï¼ŒCommonJSæ˜¯ä½œäº†å…¨é‡åŠ è½½ï¼Œç„¶ååˆ©ç”¨è§£æ„ï¼Œåªè·å–æŒ‡å®šçš„éƒ¨åˆ†
var { name, getName } = require('path/to/module')
```

```js
// è¿™é‡Œï¼ŒEsModuleæ˜¯ä½œäº†æŒ‰éœ€åŠ è½½ï¼Œä¼šåˆ©ç”¨é™æ€åˆ†æï¼ŒåªåŠ è½½æŒ‡å®šçš„éƒ¨åˆ†
import { name, getName } from 'path/to/module'
```

### 7-2-2.åˆ«åå¯¼å…¥

åˆ©ç”¨å‘½åå¯¼å…¥æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹å…¶è¿›è¡Œé‡å‘½åï¼š

```js
// utils.js
export var name = 'Jack'
export function getName () {
  return name
}

// main.js
import { name as myName, getName as getMyName } from 'path/to/utils.js'
console.log(myName)
console.log(getMyName())
```

å¦å¤–ä¹Ÿå¯ä»¥å…¨é‡å¯¼å…¥ï¼š

```js
// utils.js
export var name = 'Jack'
export function getName () {
  return name
}

// main.js
import * as myModule from 'path/to/utils.js'
console.log(myModule.name)
console.log(myModule.getName())
```

ä½†å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸æ¨èè¿™ç§å½¢å¼ã€‚å› ä¸ºå®ƒè¿èƒŒäº†æŒ‰éœ€å¯¼å…¥çš„è®¾è®¡å‡†åˆ™ï¼Œä¸åˆ©äº `webpack` çš„ `tree shaking`ã€‚

### 7-2-3.é»˜è®¤å¯¼å…¥

é»˜è®¤å¯¼å…¥ä¸é»˜è®¤å¯¼å‡ºæ˜¯ç›¸å¯¹åº”çš„ã€‚

```js
// utils.js
export var name = 'Jack'
export function getName () {
  return name
}
export default function () {
  return new Date()
}

// main.js
import getTime from 'path/to/utils.js'
console.log(getTime())
```

é»˜è®¤å¯¼å…¥ï¼Œä¹Ÿå¯ä»¥ä¸å‘½åå¯¼å…¥è”ç”¨ï¼š

```js
// utils.js
export var name = 'Jack'
export function getName () {
  return name
}
export default function () {
  return new Date()
}

// main.js æ³¨æ„è¿™é‡Œçš„å¯¼å…¥é¡ºåº
import getTime, { name, getName } from 'path/to/utils.js'

console.log(name)
console.log(getName())
console.log(getTime())
```

ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤å¯¼å…¥ä¸å‘½åå¯¼å…¥è”ç”¨æ—¶ï¼Œ**å¯¼å…¥é¡ºåºæ˜¯é»˜è®¤å¯¼å…¥åœ¨å‰ï¼Œå‘½åå¯¼å…¥åœ¨åï¼Œç”¨é€—å· `,` åˆ†éš”**ã€‚

## 7-3.åŠ¨æ€import

å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬æåˆ°é™æ€ `import` ä¸èƒ½æ”¾åœ¨å—çº§ä½œç”¨åŸŸå†…ã€‚

ä½†å®é™…å¼€å‘ä¸­ï¼Œéš¾ä»¥é¿å…éœ€è¦ `require` è¿™ç§å½¢å¼çš„è¿è¡Œæ—¶åŠ¨æ€åŠ è½½ã€‚

äºæ˜¯æœ‰äººæå‡ºäº† `import()` è¯­æ³•ã€‚

å®ƒåœ¨ä½¿ç”¨å½¢å¼ç±»ä¼¼äº `CommonJS` ä¸­çš„ `require()` è¯­æ³•ï¼Œä½†äºŒè€…ä¹Ÿæœ‰åŒºåˆ«ï¼š

1. `require()` æ˜¯åŒæ­¥åŠ è½½ï¼Œ`import()` æ˜¯å¼‚æ­¥åŠ è½½ã€‚
2. `require()` è¿”å›çš„æ˜¯æ¨¡å—ï¼ˆå…·ä½“ç±»å‹ä»¥å¯¼å‡ºä¸ºå‡†ï¼‰ï¼Œ`import()` è¿”å›çš„æ˜¯ `Promise` å®ä¾‹ã€‚

```js
import('path/to/utils.js').then(data => {
  console.log(data)
})
```

æ‰“å°ç»“æœå¦‚ä¸‹ï¼š

![](https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/e6c9d24ely1h51k1opf1sj20s60b8myl.jpg)

## 7-4.æµè§ˆå™¨ä¸­çš„EsModule

ç°ä»£æµè§ˆå™¨ï¼Œå·²ç»é€æ¸å¼€å§‹æ”¯æŒç›´æ¥åœ¨ `<script>` æ ‡ç­¾å†…ä½¿ç”¨ `EsModule`ã€‚

å¦‚æœè¦ä½¿ç”¨ `import from` è¿™æ ·çš„é™æ€å¯¼å…¥è¯­æ³•ï¼Œéœ€è¦å£°æ˜ `<script>` æ ‡ç­¾çš„ `type` å±æ€§ä¸º `module`ã€‚

å¦åˆ™ä¼šæŠ¥é”™ `Uncaught SyntaxError: Cannot use import statement outside a module`ã€‚

è€Œå¦‚æœè¦ä½¿ç”¨ `import()` è¿™æ ·çš„åŠ¨æ€å¯¼å…¥è¯­æ³•ï¼Œåˆ™ä¸éœ€è¦å£°æ˜ã€‚

å…³äº `type` å±æ€§çš„æ›´å¤šä¿¡æ¯å¯è§æœ¬ç«™çš„[scriptæ ‡ç­¾çš„typeå±æ€§](../../html/2.attr-part.md#_3-2-type)

## 7-5.Nodeä¸­çš„EsModule

é«˜ç‰ˆæœ¬çš„ `Node` ä¹Ÿå¼€å§‹æ”¯æŒ `EsModule`ã€‚

å¦‚æœæƒ³è¦åœ¨ `Node` ç¯å¢ƒä¸‹æ­£å¸¸æ‰§è¡Œ `EsModule` çš„è¯ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š

1. å°† `.js` çš„åç¼€åä¿®æ”¹ä¸º `.mjs`ã€‚
2. åœ¨ `package.json` ä¸­å£°æ˜ `type` ä¸º `module`ã€‚

```json
{
  "type": "module"
}
```

:::tip
`ES6` æ¨¡å—ä¸ `CommonJS` æ¨¡å—å°½é‡ä¸è¦æ··ç”¨ã€‚

`require` å‘½ä»¤ä¸èƒ½åŠ è½½ `.mjs` æ–‡ä»¶ï¼Œä¼šæŠ¥é”™ï¼Œåªæœ‰ `import` å‘½ä»¤æ‰å¯ä»¥åŠ è½½ `.mjs` æ–‡ä»¶ã€‚

åè¿‡æ¥ï¼Œ`.mjs` æ–‡ä»¶é‡Œé¢ä¹Ÿä¸èƒ½ä½¿ç”¨ `require` å‘½ä»¤ï¼Œå¿…é¡»ä½¿ç”¨ `import`ã€‚
:::

### 7-5-1.`CommonJS` æ¨¡å—åŠ è½½ `EsModule` æ¨¡å—

è­¬å¦‚ï¼š

```js
// è¿™é‡Œåˆ©ç”¨CommonJSåŠ è½½EsModule
var name = require('path/to/utils.mjs')
```

è¿è¡Œä¼šæŠ¥é”™ã€‚

`CommonJS` æ¨¡å—å¹¶ä¸èƒ½åŠ è½½ `EsModule` æ¨¡å—ã€‚

åªèƒ½é‡‡ç”¨ `EsModule` çš„æ¨¡å—åŒ–æ ‡å‡†åŠ è½½ `EsModule` æ¨¡å—ã€‚

ä»”ç»†æ€è€ƒçš„è¯ğŸ¤”ï¼Œ`CommonJS` æ¨¡å—åŒ–æ ‡å‡†æ˜¯å¾ˆæ—©ä¹‹å‰å‡ºæ¥çš„ï¼Œè€Œ `EsModule` å±äºè¿‘æœŸçš„åæœŸä¹‹ç§€ã€‚

`EsModule` æœ¬èº«æœ‰é™æ€åˆ†æã€å‘½åå¯¼å‡ºã€é»˜è®¤å¯¼å‡ºç­‰ç­‰ç‰¹ç‚¹ã€‚

æ‰€ä»¥ `CommonJS` çš„è®¾è®¡å¹¶ä¸èƒ½è€ƒè™‘åˆ°ç°åœ¨ `EsModule` çš„ç‰¹ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ`CommonJS` ä¸å…¼å®¹ `EsModule` æ ‡å‡†ã€‚

### 7-5-2.`EsModule` æ¨¡å—åŠ è½½ `CommonJS` æ¨¡å—

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œ`EsModule` æ¨¡å—å¯ä»¥åŠ è½½ `CommonJS` æ¨¡å—ã€‚

åœ¨é˜®ä¸€å³°çš„[æ·±å…¥ç†è§£Es6](https://es6.ruanyifeng.com/#docs/module-loader#ES6-%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD-CommonJS-%E6%A8%A1%E5%9D%97)ä¸­ï¼Œæåˆ°ï¼š

> ES6 æ¨¡å—çš„importå‘½ä»¤å¯ä»¥åŠ è½½ CommonJS æ¨¡å—ï¼Œä½†æ˜¯åªèƒ½æ•´ä½“åŠ è½½ï¼Œä¸èƒ½åªåŠ è½½å•ä¸€çš„è¾“å‡ºé¡¹ã€‚

ä½†**ç¬”è€…æµ‹è¯•æ—¶ï¼Œå‘ç° `EsModule` æ—¢èƒ½æ•´ä½“åŠ è½½ï¼Œåˆèƒ½åªåŠ è½½å•ä¸€çš„è¾“å‡ºé¡¹**ã€‚

**æµ‹è¯•æ—¶ `Node` ç‰ˆæœ¬ä¸º `v14.16.0`**ã€‚

è­¬å¦‚ï¼Œæœ‰ä¸€ä¸ªæ¨¡å—æ–‡ä»¶ `utils.js`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```js
module.exports = {
  name: 'Understand Es6',
  author: 'ruanyifeng'
}
```

å¯ä»¥è¿™æ ·åˆ©ç”¨ `EsModule` å¯¼å…¥ï¼š

```js
// work
import info from 'path/to/utils.js'
console.log(info.name)
console.log(info.author)
```

ä¹Ÿèƒ½é‡‡ç”¨å‘½åå¯¼å…¥çš„æ–¹å¼ï¼š

```js
// work
import { name, author } from 'path/to/utils.js'
console.log(name)
console.log(author)
```

## 7-6.EsModuleä¸CommonJSçš„åŒºåˆ«

`EsModule` ä¸ `CommonJS` çš„åŒºåˆ«åœ¨äºï¼š

1. `CommonJS` æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼Œ`EsModule` æ¨¡å—æ˜¯ç¼–è¯‘æ—¶åŠ è½½ã€‚
2. `CommonJS` æ¨¡å—**å¯¼å‡º**çš„æ˜¯å€¼çš„æ‹·è´ï¼Œ`EsModule` æ¨¡å—**å¯¼å‡º**çš„æ˜¯å€¼çš„å¼•ç”¨ã€‚
3. `CommonJS` æ¨¡å—çš„ `require()` æ˜¯åŒæ­¥åŠ è½½ï¼Œ`EsModule` æ¨¡å—çš„ `import()` æ˜¯å¼‚æ­¥åŠ è½½ã€‚

å…¶ä¸­ï¼Œç¬¬ `1`ã€`3` ç‚¹åœ¨ä¸Šæ–‡ä¸­å·²ç»æœ‰äº†ç›¸å…³ä»‹ç»ï¼Œæœ¬èŠ‚ä¸åšè¿‡å¤šèµ˜è¿°ã€‚

æˆ‘ä»¬é‡ç‚¹éªŒè¯ä¸‹ç¬¬ `2` ç‚¹ã€‚

åœ¨ `CommonJs` æ¨¡å—ç³»ç»Ÿä¸‹æµ‹è¯•ï¼Œå¯ä»¥å‘ç°**æ¨¡å—å†…éƒ¨çš„å€¼æ”¹å˜æ—¶ï¼Œå¯¼å‡ºçš„å€¼ä¸ä¼šæ”¹å˜**ï¼š

```js
// utils.js
var name = 'Tom'
function setName (val) {
  name = val
}
module.exports = {
  name,
  setName
}

// main.js
var utils = require('path/to/utils.js')
console.log(utils.name) // Tom
setName('Jerry')
console.log(utils.name) // Tom
```

åœ¨ `EsModule` æ¨¡å—ç³»ç»Ÿä¸‹æµ‹è¯•ï¼Œå¯ä»¥å‘ç°**æ¨¡å—å†…éƒ¨çš„å€¼æ”¹å˜æ—¶ï¼Œå¯¼å‡ºçš„å€¼ä¹Ÿä¼šæ”¹å˜**ï¼š

```js
// utils.js
var name = 'Tom'
function setName (val) {
  name = val
}
export {
  name,
  setName
}

// main.js
import { name, setName } from 'path/to/utils.js'
console.log(name) // Tom
setName('Jerry')
console.log(name) // Jerry
```

## 7-7.å¾ªç¯ä¾èµ–

å¾ªç¯ä¾èµ–ï¼ŒæŒ‡çš„æ˜¯æ¨¡å—ä¹‹é—´äº’ç›¸å¯¼å…¥ã€äº’ç›¸ä¾èµ–ã€‚

æ­£å¦‚æŸä¸ªå“²å­¦é—®é¢˜ï¼Œä¸–ç•Œä¸Šæ˜¯å…ˆæœ‰é¸¡ï¼Œè¿˜æ˜¯å…ˆæœ‰è›‹ï¼Œä¸€æ—¦çº ç¼ ç»“æœï¼Œè¿™å°±æ˜¯å¾ªç¯ä¸æ–­çš„å‘½é¢˜ã€‚

æ‰€ä»¥ï¼Œä¸€èˆ¬å¯¹æ­¤çš„å¤„ç†æ–¹æ³•ï¼Œè¦ææ–­è¿™ç§å¾ªç¯é€»è¾‘ã€‚

`CommonJS` ä¸ `EsModule` çš„å¤„ç†æ–¹å¼ç±»ä¼¼ï¼Œä½†æ˜¯ç”±äºäºŒè€…çš„æ¨¡å—åŒ–ç‰¹ç‚¹ï¼Œå…·ä½“ç»†èŠ‚ä¸Šæœ‰å·®åˆ«ã€‚

è­¬å¦‚ä¸‹æ–‡ä¸­çš„ `a` åŠ è½½ `b`ï¼Œ**æ­¤æ—¶ `a` æ¨¡å—*å¹¶æ²¡æœ‰å®Œå…¨å¯¼å‡º*ï¼Œ`CommonJS` å’Œ `EsModule` éƒ½æ˜¯å»åŠ è½½ `b`**ã€‚

åœ¨ `b` ä¸­åŠ è½½ `a` æ—¶ï¼Œç”±äº `a` æ¨¡å—å¹¶æ²¡æœ‰å®Œå…¨å¯¼å‡ºï¼Œè€Œä¸” `CommonJS` ä¸ `EsModule` æœ‰æ‰§è¡Œå·®å¼‚ï¼Œæ‰€ä»¥è¿™é‡Œçš„ç»“æœä¼šæœ‰å·®å¼‚ã€‚

å¦‚æœè¦æˆ‘æ€»ç»“ `CommonJS` ä¸ `EsModule` å¯¹äºå¾ªç¯ä¾èµ–çš„å·®å¼‚ä¹‹å¤„ï¼Œé‚£å°±æ˜¯ï¼š

**`CommonJS` æŒ‰ç…§é¡ºåºåŠ è½½ï¼Œè€Œ `EsModule` æå‡åŠ è½½**ã€‚

æ›´å¤šç»†èŠ‚å’ŒéªŒè¯ï¼Œå¯ä»¥åˆ†åˆ«å‚è€ƒä¸‹æ–‡ä¸­å„èŠ‚çš„å¯¹åº”ä¾‹å­ã€‚

### 7-7-1.CommonJS

åœ¨[Nodeå®˜æ–¹æ–‡æ¡£](https://nodejs.org/api/modules.html#cycles)ä¸­ï¼Œæœ‰ä¸€ä¸ªä¾‹å­è¿›è¡Œè¯´æ˜ï¼š

```js
// a.js
exports.done = false
var b = require('./b.js')
console.log('åœ¨ a.js ä¹‹ä¸­ï¼Œb.done = %j', b.done)
exports.done = true
console.log('a.js æ‰§è¡Œå®Œæ¯•')
```

```js
// b.js
exports.done = false
var a = require('./a.js')
console.log('åœ¨ b.js ä¹‹ä¸­ï¼Œa.done = %j', a.done)
exports.done = true
console.log('b.js æ‰§è¡Œå®Œæ¯•')
```

```js
// main.js
console.log('main start')
const a = require('./a.js')
const b = require('./b.js')
console.log('in main, a.done = %j, b.done = %j', a.done, b.done)
```

**æ‰§è¡Œ `main.js`** ä¹‹åï¼Œæ‰“å°ä¾æ¬¡æ˜¯ï¼š

```
main start
åœ¨ b.js ä¹‹ä¸­ï¼Œa.done = false
b.js æ‰§è¡Œå®Œæ¯•
åœ¨ a.js ä¹‹ä¸­ï¼Œb.done = true
a.js æ‰§è¡Œå®Œæ¯•
in main, a.done = true, b.done = true
```

å¯ä»¥å¾—å‡ºçš„ç»“è®ºæ˜¯ï¼š

- `require` å¹¶æ²¡æœ‰æå‡æ•ˆæœã€‚å®ƒæŒ‰ç…§å†™åœ¨ä»£ç å¤„çš„ä½ç½®ï¼Œè§¦å‘æ‰§è¡Œã€‚
- `require` é‡åˆ°å¾ªç¯åŠ è½½æ—¶ï¼Œè¿”å›çš„æ˜¯å½“å‰**å·²ç»æ‰§è¡Œçš„éƒ¨åˆ†çš„å€¼**ï¼Œè€Œ**ä¸æ˜¯ä»£ç å…¨éƒ¨æ‰§è¡Œåçš„å€¼**ã€‚
- `require` æ˜¯åŒæ­¥åŠ è½½ã€‚ä¾èµ–åŠ è½½ä»ä¸Šè‡³ä¸‹ï¼Œå±‚å±‚åˆ†æåŠ è½½ã€‚
- `require` åªä¼šæ‰§è¡Œä¸€æ¬¡ä»£ç ï¼Œå³ä½¿æœ‰å¾ªç¯ä¾èµ–ï¼Œåç»­åŠ è½½ä¼šä»ç¼“å­˜ä¸­è·å–å¯¼å‡ºã€‚

### 7-7-2.EsModule

å‚ç…§ `CommonJS` çš„ä¾‹å­ï¼Œä¿®æ”¹ä¸º `EsModule` çš„è¯æ˜¯è¿™æ ·çš„ï¼š

```js
// a.mjs
export var a1 = false
import { b1, b2 } from './b.mjs'
console.log('åœ¨ a.mjs ä¹‹ä¸­ï¼Œ', b1, b2)
export var a2 = true
console.log('a.mjs æ‰§è¡Œå®Œæ¯•')
```

```js
// b.mjs
export var b1 = false
import { a1, a2 } from './a.mjs'
console.log('åœ¨ b.mjs ä¹‹ä¸­ï¼Œ', a1, a2)
export var b2 = true
console.log('b.mjs æ‰§è¡Œå®Œæ¯•')
```

```js
// main.mjs
console.log('main start')
import { a1, a2 } from './a.mjs'
import { b1, b2 } from './b.mjs'
console.log('in main,', a1, a2, b1, b2)
```

**æ‰§è¡Œ `main.js`** ä¹‹åï¼Œæ‰“å°ä¾æ¬¡æ˜¯ï¼š

```
åœ¨ b.mjs ä¹‹ä¸­ï¼Œ undefined undefined
b.mjs æ‰§è¡Œå®Œæ¯•
åœ¨ a.mjs ä¹‹ä¸­ï¼Œ false true
a.mjs æ‰§è¡Œå®Œæ¯•
main start
in main, false true false true
```

å¯ä»¥çœ‹å‡ºï¼Œ`EsModule` æœ‰è‡ªå·±çš„ç‰¹ç‚¹(ä»¥ä¸‹ `import` å‡æŒ‡ `import ... from ...`)ï¼š

- `import` å…·æœ‰æå‡æ•ˆæœã€‚å®ƒä¼šæå‡åˆ°ä»£ç å¤´éƒ¨ï¼Œ**ä¼˜å…ˆæ‰§è¡Œ**ã€‚
- `import` åœ¨æ¨¡å—ä¸­ä¸€å®šæ˜¯æœ€å…ˆæ‰§è¡Œçš„ï¼Œå³ä½¿å®ƒå†™åœ¨ä»£ç ä¸‹æ–¹ã€‚è¿™æ ·å°±å¯¼è‡´å¾ªåä¾èµ–ä¸­ï¼Œä¼šå¯¼å‡º `undefined`ã€‚
- `import` ä¹Ÿæ˜¯åŒæ­¥åŠ è½½ã€‚ä¾èµ–åŠ è½½ä»ä¸Šè‡³ä¸‹ï¼Œå±‚å±‚åˆ†æåŠ è½½ã€‚
- `import` ä¹Ÿåªä¼šæ‰§è¡Œä¸€æ¬¡ä»£ç ï¼Œå³ä½¿æœ‰å¾ªç¯ä¾èµ–ã€‚
