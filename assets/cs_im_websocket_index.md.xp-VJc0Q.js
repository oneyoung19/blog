import{_ as e,c as i,o as a,b0 as t}from"./chunks/framework.CEggy_nf.js";const r=JSON.parse('{"title":"Websocket","description":"","frontmatter":{"title":"Websocket"},"headers":[],"relativePath":"cs/im/websocket/index.md","filePath":"cs/im/websocket/index.md","lastUpdated":1745067306000}'),n={name:"cs/im/websocket/index.md"};function c(o,s,l,p,d,k){return a(),i("div",null,s[0]||(s[0]=[t(`<p><code>Websocket</code> 依赖于 <code>ws</code> 协议，而非 <code>http</code> 协议。</p><p>在建立连接时，首先由客户端发起请求，大概有如下请求头：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">GET</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /api/websocket</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Host:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> localhost</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Origin:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://localhost:8080</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Connection:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Upgrade</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Upgrade:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> websocket</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sec-Websocket-Extensions:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> permessage-deflate</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sec-WebSocket-Key:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> CPcdLMSy3wmUpYZmq0OUZA==</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sec-WebSocket-Version:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 13</span></span></code></pre></div><p>其中部分 <code>header</code> 头的含义如下：</p><ul><li><code>Connection: Upgrade</code> —— 表示客户端想要更改协议。</li><li><code>Upgrade: websocket</code> —— 请求的协议是 <code>websocket</code>。</li><li><code>Sec-Websocket-Extensions</code> —— <code>Websocket</code> 拓展，支持数据压缩。</li><li><code>Sec-Websocket-Key</code> —— 浏览器随机生成的安全密钥。</li><li><code>Sec-Websocket-Version</code> —— <code>Websocket</code> 协议版本，当前为 <code>13</code>。</li></ul><p>如果服务器同意切换为 <code>Websocket</code> 协议，服务器应该返回响应码 <code>101</code>：</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">101</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Switching</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Protocols</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Upgrade:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> websocket</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Connection:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Upgrade</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Sec-Websocket-Accept:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 6KI8x4yb7zRbvjrYKttNMq8yiAg=</span></span></code></pre></div><p>参考文档：</p><ul><li><a href="https://zh.javascript.info/websocket" target="_blank" rel="noreferrer">现代教程之Websocket</a></li></ul><p>第三方库及框架：</p><ul><li><a href="https://github.com/websockets/ws" target="_blank" rel="noreferrer">ws</a></li><li><a href="https://github.com/socketio/socket.io" target="_blank" rel="noreferrer">socket.io</a></li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>ws</code> 其实相当于 <code>Websocket</code> 在 <code>node</code> 环境下的 <code>polyfill</code> 库。</p><p>而 <code>socket.io</code> 则能够支持 <code>client</code> 和 <code>server</code> 端，而且对于其他语言如 <code>java</code>、<code>python</code> 等，也有对应版本。</p><p>整体而言，<code>socket.io</code> 的功能更完整，周边生态更好。</p></div>`,12)]))}const F=e(n,[["render",c]]);export{r as __pageData,F as default};
