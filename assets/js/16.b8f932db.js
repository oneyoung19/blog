(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{454:function(s,t,a){s.exports=a.p+"assets/img/require.demo.drawio.78c07e24.png"},455:function(s,t,a){s.exports=a.p+"assets/img/amd.drawio.4fa43f76.png"},571:function(s,t,a){"use strict";a.r(t);var n=a(40),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[n("code",[s._v("AMD")]),s._v(" 的全称是 "),n("code",[s._v("Asynchronous Module Definition")]),s._v("。即"),n("strong",[s._v("异步模块定义")]),s._v("。")]),s._v(" "),n("p",[n("code",[s._v("AMD")]),s._v(" 规范的具体实现是 "),n("code",[s._v("RequireJS")]),s._v("。")]),s._v(" "),n("h2",{attrs:{id:"_4-1-基本用法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-基本用法"}},[s._v("#")]),s._v(" 4-1.基本用法")]),s._v(" "),n("p",[n("strong",[s._v("这里只声明基本用法形式")]),s._v("。")]),s._v(" "),n("p",[s._v("模板文件 "),n("code",[s._v("index.html")]),s._v(":")]),s._v(" "),n("ol",[n("li",[s._v("利用 "),n("code",[s._v("script")]),s._v(" 标签引入 "),n("code",[s._v("require.js")]),s._v("。")]),s._v(" "),n("li",[s._v("声明 "),n("code",[s._v("data-main")]),s._v(" 自定义属性定义"),n("strong",[s._v("入口文件")]),s._v("。")])]),s._v(" "),n("div",{staticClass:"language-html line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-html"}},[n("code",[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("data-main")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("path/to/main.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("src")]),n("span",{pre:!0,attrs:{class:"token attr-value"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/path/to/require.js"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),n("span",{pre:!0,attrs:{class:"token script"}}),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("入口文件 "),n("code",[s._v("main.js")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/path/to/modules/a'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("a")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'main'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("code",[s._v("a.js")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("define")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/path/to/modules/b'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/path/to/modules/d'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("b"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" d")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'a'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("code",[s._v("b.js")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("define")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/path/to/modules/c'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("c")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'b'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'b'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("code",[s._v("c.js")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("define")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'c'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("code",[s._v("d.js")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("define")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/path/to/modules/e'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'d'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("code",[s._v("e.js")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("define")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'e'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'e'")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("其引用关系如下图：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(454),alt:""}})]),s._v(" "),n("p",[s._v("可以看出，"),n("code",[s._v("require.js")]),s._v(" 的基本用法是：")]),s._v(" "),n("ol",[n("li",[s._v("利用 "),n("code",[s._v("data-main")]),s._v(" 属性声明入口文件。")]),s._v(" "),n("li",[s._v("入口文件利用 "),n("code",[s._v("require")]),s._v(" 导入依赖。")]),s._v(" "),n("li",[s._v("模块使用 "),n("code",[s._v("define")]),s._v(" 声明，而且相关依赖会提前在 "),n("code",[s._v("define")]),s._v(" 中声明。")])]),s._v(" "),n("h2",{attrs:{id:"_4-2-requirejs的基本原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-requirejs的基本原理"}},[s._v("#")]),s._v(" 4-2.requireJs的基本原理")]),s._v(" "),n("p",[n("img",{attrs:{src:a(455),alt:""}})]),s._v(" "),n("p",[s._v("对于 "),n("code",[s._v("commonJS")]),s._v(" 模块化规范来说，它是同步读取磁盘内的文件，很快，不会有延时，而且 "),n("code",[s._v("node")]),s._v(" 能够读取、处理文件。")]),s._v(" "),n("p",[s._v("但对于浏览器端来说，"),n("code",[s._v("JS")]),s._v(" 并不能直接读取操作文件。")]),s._v(" "),n("p",[s._v("那浏览器端的模块化具体是怎样实现的呢？（这个问题在之前，对我来讲，一直是疑问和困扰，百思不得其解。）")]),s._v(" "),n("p",[s._v("后来我明白了"),n("code",[s._v("AMD")]),s._v(" 和 "),n("code",[s._v("CMD")]),s._v(" 都是利用的动态脚本以及其对应的 "),n("code",[s._v("onload")]),s._v(" 事件监听。")]),s._v(" "),n("p",[n("code",[s._v("AMD")]),s._v(" 表示的是 "),n("code",[s._v("Asynchronous Module Definition")]),s._v("，其中的 "),n("code",[s._v("Asynchronous")]),s._v(" 表示的就是 "),n("code",[s._v("<script>")]),s._v(" 标签的 "),n("code",[s._v("async")]),s._v(" 性质。")]),s._v(" "),n("p",[s._v("即异步加载，不阻塞 "),n("code",[s._v("DOM")]),s._v("。异步加载"),n("strong",[s._v("所有依赖")]),s._v("后，再执行 "),n("code",[s._v("factory")]),s._v(" 回调函数。")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("要注意的两个特点：")]),s._v(" "),n("ol",[n("li",[n("code",[s._v("RequireJS")]),s._v(" 的依赖需要提前声明好。")]),s._v(" "),n("li",[n("code",[s._v("RequireJS")]),s._v(" 模块在加载完所有依赖后，会将各自的 "),n("code",[s._v("exports")]),s._v(" 作为参数传入该模块对应的 "),n("code",[s._v("factory")]),s._v(" 函数中，并立即执行该 "),n("code",[s._v("factory")]),s._v(" 函数，也就是说每一个 "),n("code",[s._v("define")]),s._v(" 的 "),n("code",[s._v("factory")]),s._v(" 回调函数在执行时已经能够拿到其依赖项目的 "),n("code",[s._v("exports")]),s._v(" 导出。")])]),s._v(" "),n("p",[s._v("这两点也是 "),n("code",[s._v("AMD")]),s._v(" 与 "),n("code",[s._v("CMD")]),s._v(" 的差异，下一节在 "),n("code",[s._v("CMD")]),s._v(" 中会详述。")])]),s._v(" "),n("p",[n("code",[s._v("RequireJS")]),s._v(" 源码晦涩冗余，比较难以梳理其逻辑关系。")]),s._v(" "),n("p",[s._v("这里推荐一个简化版的 "),n("a",{attrs:{href:"https://github.com/ZhiCYue/requireJs-analysis",target:"_blank",rel:"noopener noreferrer"}},[s._v("RequireJS Analysis"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("h2",{attrs:{id:"_4-3-r-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-r-js"}},[s._v("#")]),s._v(" 4-3.r.js")]),s._v(" "),n("p",[s._v("我们已经知道 "),n("code",[s._v("require.js")]),s._v(" 是利用动态脚本加载依赖。")]),s._v(" "),n("p",[s._v("那么显而易见的一个问题是：")]),s._v(" "),n("p",[s._v("当项目越来越大，依赖越来越多，会发起越来越多的 "),n("code",[s._v("http")]),s._v(" 请求以加载依赖。")]),s._v(" "),n("p",[s._v("这对于项目性能，无疑是一种巨大的损耗。")]),s._v(" "),n("p",[s._v("出于这种角度的考虑，"),n("code",[s._v("requireJs")]),s._v(" 团队他们提供了 "),n("a",{attrs:{href:"https://github.com/requirejs/r.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("r.js"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("p",[s._v("该工具会将依赖打包以减少 "),n("code",[s._v("http")]),s._v(" 请求。")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),n("p",[s._v("我们可以在生产环境下，利用该工具进行处置依赖，从而提升生产环境的项目性能。")])])])}),[],!1,null,null,null);t.default=e.exports}}]);