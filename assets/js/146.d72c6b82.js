(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{604:function(t,s,a){"use strict";a.r(s);var n=a(40),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("该篇文章，之前本人发布在"),a("a",{attrs:{href:"https://juejin.cn/post/6844904152011636749",target:"_blank",rel:"noopener noreferrer"}},[t._v("掘金"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("p",[t._v("该文章首次于 "),a("code",[t._v("2020-05-09")]),t._v(" 更新。")]),t._v(" "),a("p",[t._v("本站于 "),a("code",[t._v("2022-10-02")]),t._v(" 对上述文章重新校正。")]),t._v(" "),a("h2",{attrs:{id:"_1-前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-前言"}},[t._v("#")]),t._v(" 1.前言")]),t._v(" "),a("p",[t._v("我们都知道，由于浏览器的同源策略，所以在前后端分离的开发过程中，难免出现跨域的问题。")]),t._v(" "),a("p",[t._v("最常用的解决方法有：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("CORS")])]),t._v(" "),a("li",[a("code",[t._v("JSONP")])]),t._v(" "),a("li",[a("code",[t._v("webpack-dev-server")])]),t._v(" "),a("li",[a("code",[t._v("nginx")])]),t._v(" "),a("li",[a("code",[t._v("...等")])])]),t._v(" "),a("p",[t._v("本文重点讨论下 "),a("code",[t._v("CORS")]),t._v("。")]),t._v(" "),a("p",[t._v("后端服务暂以原生 "),a("code",[t._v("node")]),t._v(" 为例，另外编辑器使用 "),a("code",[t._v("vscode")]),t._v("，浏览器为 "),a("code",[t._v("chrome81")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"_2-启动项目服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-启动项目服务"}},[t._v("#")]),t._v(" 2.启动项目服务")]),t._v(" "),a("p",[t._v("先使用 "),a("code",[t._v("yarn init -y")]),t._v(" 创建一个初始项目。然后安装 "),a("code",[t._v("axios")]),t._v(" 以及 "),a("code",[t._v("node")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("yarn add axios\nyarn add node\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-1-前端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-前端"}},[t._v("#")]),t._v(" 2-1.前端")]),t._v(" "),a("ul",[a("li",[t._v("创建一个 "),a("code",[t._v("http.js")]),t._v(" 文件。这个文件会书写 "),a("code",[t._v("XMLHttpRequest")]),t._v(" 以及 "),a("code",[t._v("axios")]),t._v(" 来请求后端的接口。")]),t._v(" "),a("li",[t._v("创建 "),a("code",[t._v("index.html")]),t._v("。引入 "),a("code",[t._v("node_modules")]),t._v(" 中的 "),a("code",[t._v("dist")]),t._v(" 目录下的 "),a("code",[t._v("axios")]),t._v("。以及之前的 "),a("code",[t._v("http.js")]),t._v("。注意 "),a("code",[t._v("script")]),t._v(" 标签的先后顺序。")]),t._v(" "),a("li",[t._v("利用 "),a("code",[t._v("vscode")]),t._v(" 的 "),a("code",[t._v("live server")]),t._v(" 启动前端 "),a("code",[t._v("html")]),t._v(" 服务。"),a("code",[t._v("live server")]),t._v(" 可以配置前端项目启动的 "),a("code",[t._v("ip")]),t._v(" 以及端口。这里我设置成 "),a("code",[t._v("http://localhost:8082")]),t._v("。")])]),t._v(" "),a("h3",{attrs:{id:"_2-2-后端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-后端"}},[t._v("#")]),t._v(" 2-2.后端")]),t._v(" "),a("p",[t._v("下面是node的代码：")]),t._v(" "),a("p",[t._v("这里我们先直接设置 "),a("code",[t._v("Access-Control-Allow-Origin")]),t._v(" 为 "),a("code",[t._v("*")]),t._v("。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" http "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nhttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Access-Control-Allow-Origin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'text/plain'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8081")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Server running at http://127.0.0.1:8081/'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("可利用 "),a("code",[t._v("vscode")]),t._v(" 的 "),a("code",[t._v("code run")]),t._v(" 直接运行上面代码。这样，"),a("code",[t._v("node")]),t._v(" 服务就会启动在 "),a("code",[t._v("http://127.0.0.1:8081")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"_3-前端发起请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-前端发起请求"}},[t._v("#")]),t._v(" 3.前端发起请求")]),t._v(" "),a("p",[t._v("这里我们把请求分成两类：")]),t._v(" "),a("ol",[a("li",[t._v("一类是原生 "),a("code",[t._v("XMLHttpRequest")]),t._v(" 以及 "),a("code",[t._v("$.ajax")])]),t._v(" "),a("li",[t._v("另一类就是我们实际项目经常用的 "),a("code",[t._v("axios")]),t._v("。")])]),t._v(" "),a("p",[t._v("因为 "),a("code",[t._v("$.ajax")]),t._v(" 实际上就是封装的 "),a("code",[t._v("XMLHttpRequest")]),t._v("，所以归为一种。另外之所以这样分，是为了下面更好的区别一些东西。具体原因请继续看。")]),t._v(" "),a("p",[t._v("以 "),a("code",[t._v("post")]),t._v(" 请求为例，这里对请求地址加了标识，但是由于路由的原因，如果成功的话，都会返回 "),a("code",[t._v("hello world")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_3-1-xmlhttprequest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-xmlhttprequest"}},[t._v("#")]),t._v(" 3-1.XMLHttpRequest")]),t._v(" "),a("p",[t._v("由于请求路径是 "),a("code",[t._v("http://127.0.0.1:8081/api/xmlhttp")]),t._v("。本文以下的 "),a("code",[t._v("xmlhttp")]),t._v(" 请求均代指此次请求。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 监听事件")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onreadystatechange")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求完成")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//响应成功")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" httpResponseText "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("responseText\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("httpResponseText"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 响应失败 打印下状态码")]),t._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 请求未完成")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("readyState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 发送请求")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'post'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:8081/api/xmlhttp'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setRequestHeader")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'content-type'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'application/x-www-urlencoded'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nxhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("send")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br")])]),a("h3",{attrs:{id:"_3-2-axios"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-axios"}},[t._v("#")]),t._v(" 3-2.axios")]),t._v(" "),a("p",[t._v("同上，"),a("code",[t._v("axios1")]),t._v(" 代表下面第一种请求，"),a("code",[t._v("axios2")]),t._v(" 代表下面第二种请求。")]),t._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("axios")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  method"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'post'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:8081/api/axios1'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("warn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\naxios"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://127.0.0.1:8081/api/axios2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'axios2'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("warn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br")])]),a("h2",{attrs:{id:"_4-发起请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-发起请求"}},[t._v("#")]),t._v(" 4.发起请求")]),t._v(" "),a("p",[t._v("至此，我们一共发起了3种请求。而且我们的 "),a("code",[t._v("node")]),t._v(" 服务器已经配置了 "),a("code",[t._v("Access-Control-Allow-Origin")]),t._v("。")]),t._v(" "),a("p",[t._v("这3种请求是不是都能成功？你是不是觉得都能成功？我们看下实际发送请求后的控制台。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/171f8287cf4cbe74~tplv-t2oaga2asx-image.image",alt:""}})]),t._v(" "),a("p",[t._v("可以看到。"),a("code",[t._v("axios2")]),t._v(" 这个请求(就是用 "),a("code",[t._v("axios.post")]),t._v(" 那个)失败了。失败原因的话，如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/171f82a2543c5e62~tplv-t2oaga2asx-image.image",alt:""}})]),t._v(" "),a("p",[t._v("我来翻译下🤣。"),a("strong",[t._v("本次请求已经CORS策略被阻止了。原因是因为请求头字段'content-type'没有被预检响应的'Access-Control-Allow-Headers'所允许。")])]),t._v(" "),a("p",[t._v("是不是觉得翻译拗口，我真的尽力了。😂")]),t._v(" "),a("p",[t._v("别担心，等下就知道出现的原因以及解决方式了。而且到现在才刚刚到本文想要尽力讲清楚的地方。")]),t._v(" "),a("p",[t._v("在接触 "),a("code",[t._v("CORS")]),t._v(" 的具体策略之前，要明白的一件事是 "),a("code",[t._v("axios2")]),t._v(" 请求与 "),a("code",[t._v("axios1")]),t._v("、"),a("code",[t._v("xmlhttp")]),t._v(" 请求的不同之处。")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("axios2")]),t._v(" 的 "),a("code",[t._v("post")]),t._v(" 请求，默认的 "),a("code",[t._v("content-type")]),t._v(" 是 "),a("code",[t._v("application/json")]),t._v("。这是因为 "),a("code",[t._v("json")]),t._v(" 在前后端分离的实际开发中，已经逐渐被大众接受。于是 "),a("code",[t._v("axios")]),t._v(" 封装的 "),a("code",[t._v("post")]),t._v(" 请求默认已经按照这种MIME类型。")]),t._v(" "),a("li",[a("code",[t._v("axios")]),t._v(" 的 "),a("code",[t._v("post")]),t._v(" 请求，在有"),a("strong",[t._v("post请求参数")]),t._v("的时候，才会将 "),a("code",[t._v("content-type")]),t._v(" 设置为 "),a("code",[t._v("application/json")]),t._v("。如果没有参数，请求头默认是没有 "),a("code",[t._v("content-type")]),t._v("。这也是为什么 "),a("code",[t._v("axios1")]),t._v(" 没有出错、请求成功的原因。")]),t._v(" "),a("li",[a("code",[t._v("XMLHttpRequest")]),t._v(" 请求，我们手动设置了请求头中的 "),a("code",[t._v("content-type")]),t._v(" 为 "),a("code",[t._v("application/x-www-form-urlencoded")]),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"_5-揭开cors的面纱"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-揭开cors的面纱"}},[t._v("#")]),t._v(" 5.揭开CORS的面纱")]),t._v(" "),a("p",[t._v("在日常实际跨域的时候，分两种请求："),a("strong",[t._v("简单请求")]),t._v("和"),a("strong",[t._v("预检请求")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_5-1-简单请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-简单请求"}},[t._v("#")]),t._v(" 5-1.简单请求")]),t._v(" "),a("p",[t._v("若请求满足下述"),a("strong",[t._v("所有")]),t._v("条件，则该请求可视为"),a("strong",[t._v("简单请求")]),t._v("。")]),t._v(" "),a("ol",[a("li",[t._v("使用下列方法之一\n"),a("ul",[a("li",[a("code",[t._v("GET")])]),t._v(" "),a("li",[a("code",[t._v("POST")])]),t._v(" "),a("li",[a("code",[t._v("HEAD")])])])]),t._v(" "),a("li",[t._v("能人为的在请求头中添加的字段只包含以下：\n"),a("ul",[a("li",[a("code",[t._v("Accept")])]),t._v(" "),a("li",[a("code",[t._v("Accept-Language")])]),t._v(" "),a("li",[a("code",[t._v("Content-Language")])]),t._v(" "),a("li",[a("code",[t._v("Content-Type")]),t._v(" (该字段有额外的限制，请看下面第3项)")]),t._v(" "),a("li",[a("code",[t._v("DPR")])]),t._v(" "),a("li",[a("code",[t._v("Downlink")])]),t._v(" "),a("li",[a("code",[t._v("Save-Data")])]),t._v(" "),a("li",[a("code",[t._v("Viewport-Width")])]),t._v(" "),a("li",[a("code",[t._v("Width")])])])]),t._v(" "),a("li",[a("code",[t._v("Content-Type")]),t._v("的值仅限于下列三者之一：\n"),a("ul",[a("li",[a("code",[t._v("text/plain")])]),t._v(" "),a("li",[a("code",[t._v("application/x-www-form-urlencoded")])]),t._v(" "),a("li",[a("code",[t._v("multipart/form-data")])])])]),t._v(" "),a("li",[t._v("请求中的任意 "),a("code",[t._v("XMLHttpRequestUpload")]),t._v(" 对象均没有注册任何事件监听器。"),a("code",[t._v("XMLHttpRequestUpload")]),t._v(" 对象可以使用 "),a("code",[t._v("XMLHttpRequest.upload")]),t._v(" 属性访问。")]),t._v(" "),a("li",[t._v("请求中没有使用 "),a("code",[t._v("ReadableStream")]),t._v(" 对象。")])]),t._v(" "),a("p",[t._v("浏览器会在"),a("strong",[t._v("简单请求")]),t._v("中的请求头中自动设定"),a("code",[t._v("origin")]),t._v("属性。而且由于其他条件都已经满足，如 "),a("code",[t._v("content-type")]),t._v(" 等，所以后端服务只设置"),a("code",[t._v("Access-Control-Allow-Origin: '*'")]),t._v(" 即可。")]),t._v(" "),a("p",[t._v("正如我之前在 "),a("code",[t._v("node")]),t._v(" 服务器中设置的，因而 "),a("code",[t._v("xmlhttp")]),t._v(" 以及 "),a("code",[t._v("axios1")]),t._v(" 直接成功了。")]),t._v(" "),a("h3",{attrs:{id:"_5-2-预检请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-预检请求"}},[t._v("#")]),t._v(" 5-2.预检请求")]),t._v(" "),a("p",[t._v("当某个跨域请求不满足上述"),a("strong",[t._v("简单请求")]),t._v("的条件，这时的"),a("strong",[t._v("浏览器")]),t._v("会自动发送一条"),a("code",[t._v("options")]),t._v("方法的请求。")]),t._v(" "),a("p",[t._v("这条请求，我们称之为"),a("strong",[t._v("预检请求")]),t._v("。")]),t._v(" "),a("p",[t._v("假如使用的是谷歌 "),a("code",[t._v("chrome")]),t._v(" 浏览器 "),a("code",[t._v("v76")]),t._v(" 版本及以上。这条 "),a("code",[t._v("options")]),t._v(" 请求在控制台是默认隐藏的。")]),t._v(" "),a("p",[t._v("而 "),a("code",[t._v("firefox")]),t._v(" 目前是可以看见 "),a("code",[t._v("options")]),t._v(" 预检请求。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/171f86778eb81f01~tplv-t2oaga2asx-image.image",alt:""}})]),t._v(" "),a("p",[a("code",[t._v("Chrome")]),t._v(" 之所以这样做，是为了隐藏 "),a("code",[t._v("CORS")]),t._v(" 的一些请求。")]),t._v(" "),a("p",[t._v("但是这种方式对于开发者来说，确实不够友好。")]),t._v(" "),a("p",[t._v("具体缘由请参见该链接以及该链接中的其他链接。"),a("a",{attrs:{href:"https://support.google.com/chrome/thread/11089651?hl=en",target:"_blank",rel:"noopener noreferrer"}},[t._v("click me~"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("打开方式是在 "),a("code",[t._v("chrome")]),t._v(" 地址栏直接访问 "),a("code",[t._v("chrome://flags/#out-of-blink-cors")]),t._v("。")]),t._v(" "),a("p",[t._v("将页面上的 "),a("code",[t._v("Out of blink CORS")]),t._v(" 选项，改为 "),a("code",[t._v("Disabled")]),t._v("。然后 "),a("code",[t._v("relaunch")]),t._v(" 浏览器，设置即可生效。")]),t._v(" "),a("p",[t._v("下面是重启之后的 "),a("code",[t._v("chrome")]),t._v(" 控制台。跟之前对比的话，可以看到失败的 "),a("code",[t._v("post")]),t._v(" 请求已经变为 "),a("code",[t._v("options")]),t._v(" 请求。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/171f872f7d994833~tplv-t2oaga2asx-image.image",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_6-解决预检请求的跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-解决预检请求的跨域问题"}},[t._v("#")]),t._v(" 6.解决预检请求的跨域问题")]),t._v(" "),a("p",[a("code",[t._v("CORS")]),t._v(" 的整体流程如下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/171f8a78db4e78e5~tplv-t2oaga2asx-image.image",alt:""}})]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("简单请求，只需要配置 "),a("code",[t._v("Access-Control-Allow-Origin")])]),t._v(" "),a("p",[t._v("非简单请求，会额外发送 "),a("code",[t._v("OPTIONS")]),t._v(" 请求。")]),t._v(" "),a("p",[t._v("此时，"),a("code",[t._v("OPTIONS")]),t._v(" 会自动携带额外的"),a("strong",[t._v("请求头")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Access-Control-Request-Method")])]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Request-Headers")])]),t._v(" "),a("li",[a("code",[t._v("...等")])])]),t._v(" "),a("p",[t._v("服务端根据不同的场景需要配置对应的"),a("strong",[t._v("响应头")]),t._v("：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("Access-Control-Allow-Methods")])]),t._v(" "),a("li",[a("code",[t._v("Access-Control-Allow-Headers")])]),t._v(" "),a("li",[a("code",[t._v("...等")])])]),t._v(" "),a("p",[t._v("此外，服务端还可以设置 "),a("code",[t._v("Access-Control-Max-Age")]),t._v(" （指 "),a("code",[t._v("CORS")]),t._v(" 策略生效保持的最大时间）。")])]),t._v(" "),a("p",[t._v("对应本文上述"),a("code",[t._v("axios2")]),t._v("的问题，由此可知：")]),t._v(" "),a("p",[a("strong",[t._v("只要在node服务设置 "),a("code",[t._v("Access-Control-Allow-Headers: content-type;")]),t._v(" 即可。")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/171f8ba68f36aa20~tplv-t2oaga2asx-image.image",alt:""}})]),t._v(" "),a("p",[t._v("重新启动服务器后，再看下chrome控制台，就会发现 "),a("code",[t._v("axios2")]),t._v(" 的 "),a("code",[t._v("options")]),t._v(" 请求后的"),a("code",[t._v("post")]),t._v(" 请求也已经成功了。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/171f8bbf6314be03~tplv-t2oaga2asx-image.image",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"_7-总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-总结"}},[t._v("#")]),t._v(" 7.总结")]),t._v(" "),a("p",[t._v("之前在使用第三方的设置过 "),a("code",[t._v("CORS")]),t._v(" 的后端接口时，我使用 "),a("code",[t._v("axios")]),t._v(" 的 "),a("code",[t._v("post")]),t._v(" 方式总是请求失败。")]),t._v(" "),a("p",[t._v("测试 "),a("code",[t._v("Jquery")]),t._v(" 的 "),a("code",[t._v("$.ajax")]),t._v(" 反而成功了。")]),t._v(" "),a("p",[t._v("当时还是蛮懵的，排查不出具体原因。")]),t._v(" "),a("p",[t._v("于是记录了下问题，前俩天遇见了 "),a("code",[t._v("CORS")]),t._v(" 的"),a("strong",[t._v("简单请求")]),t._v("以及"),a("strong",[t._v("预检请求")]),t._v("这俩概念，于是一切恍然大悟。")])])}),[],!1,null,null,null);s.default=e.exports}}]);