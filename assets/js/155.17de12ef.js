(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{614:function(s,t,a){"use strict";a.r(t);var n=a(40),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[a("code",[s._v("EventSource")]),s._v(" 是客户端针对 "),a("code",[s._v("SSE")]),s._v(" 提供的接口。")]),s._v(" "),a("p",[s._v("基础使用方式为（下文中 "),a("code",[s._v("EventSource")]),s._v(" 实例均以 "),a("code",[s._v("source")]),s._v(" 替代）：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" source "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("EventSource")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其中：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("url")]),s._v(" 表示后端服务路径；")]),s._v(" "),a("li",[a("code",[s._v("options")]),s._v(" 可设置参数如下：\n"),a("ol",[a("li",[a("code",[s._v("withCredentials")]),s._v(" 表示 "),a("code",[s._v("CORS")]),s._v(" 是否携带 "),a("code",[s._v("Cookie")]),s._v("。")])])])]),s._v(" "),a("h2",{attrs:{id:"_1-实例属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-实例属性"}},[s._v("#")]),s._v(" 1.实例属性")]),s._v(" "),a("h3",{attrs:{id:"_1-1-readystate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-readystate"}},[s._v("#")]),s._v(" 1-1.readyState")]),s._v(" "),a("p",[a("code",[s._v("readyState")]),s._v(" 表示连接状态。")]),s._v(" "),a("p",[s._v("具有以下几种值：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("0")]),s._v(" 连接中")]),s._v(" "),a("li",[a("code",[s._v("1")]),s._v(" 连接成功")]),s._v(" "),a("li",[a("code",[s._v("2")]),s._v(" 连接失败")])]),s._v(" "),a("h3",{attrs:{id:"_1-2-url"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-url"}},[s._v("#")]),s._v(" 1-2.url")]),s._v(" "),a("p",[a("code",[s._v("url")]),s._v(" 表示后端服务路径。")]),s._v(" "),a("h3",{attrs:{id:"_1-3-withcredentials"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-withcredentials"}},[s._v("#")]),s._v(" 1-3.withCredentials")]),s._v(" "),a("p",[a("code",[s._v("withCredentials")]),s._v(" 表示 "),a("code",[s._v("CORS")]),s._v(" 是否携带 "),a("code",[s._v("Cookie")]),s._v("。")]),s._v(" "),a("h2",{attrs:{id:"_2-实例方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-实例方法"}},[s._v("#")]),s._v(" 2.实例方法")]),s._v(" "),a("h3",{attrs:{id:"_2-1-close"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-close"}},[s._v("#")]),s._v(" 2-1.close()")]),s._v(" "),a("p",[a("code",[s._v("close()")]),s._v(" 方法用以关闭 "),a("code",[s._v("SSE")]),s._v(" 连接。")]),s._v(" "),a("p",[s._v("当该方法被调用时，"),a("code",[s._v("SSE")]),s._v(" 的 "),a("code",[s._v("readyState")]),s._v(" 值会变化为 "),a("code",[s._v("2")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("close")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"_3-事件监听"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-事件监听"}},[s._v("#")]),s._v(" 3.事件监听")]),s._v(" "),a("h3",{attrs:{id:"_3-1-open"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-open"}},[s._v("#")]),s._v(" 3-1.open")]),s._v(" "),a("p",[a("code",[s._v("open")]),s._v(" 事件用以监听 "),a("code",[s._v("SSE")]),s._v(" 连接的建立。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'open'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Event source open...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_3-2-message"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-message"}},[s._v("#")]),s._v(" 3-2.message")]),s._v(" "),a("p",[a("code",[s._v("message")]),s._v(" 事件用以监听 "),a("code",[s._v("SSE")]),s._v(" 连接的信息传输。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'message'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Event source message...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"_3-3-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-error"}},[s._v("#")]),s._v(" 3-3.error")]),s._v(" "),a("p",[a("code",[s._v("error")]),s._v(" 事件用以监听 "),a("code",[s._v("SSE")]),s._v(" 连接的出错。")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'error'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Event source error...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[a("code",[s._v("express")]),s._v(" 中的 "),a("code",[s._v("res.send()")]),s._v(" 方法会中断 "),a("code",[s._v("SSE")]),s._v(" 连接，从而触发 "),a("code",[s._v("error")]),s._v(" 事件监听。")])]),s._v(" "),a("h3",{attrs:{id:"_3-4-自定义事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-自定义事件"}},[s._v("#")]),s._v(" 3-4.自定义事件")]),s._v(" "),a("p",[s._v("除了以上 "),a("code",[s._v("3")]),s._v(" 种的内置事件，我们也可以自定义实例监听事件。")]),s._v(" "),a("p",[a("strong",[s._v("只要保证 "),a("code",[s._v("Server")]),s._v(" 端定义对应 "),a("code",[s._v("event")]),s._v(" 字段触发即可")]),s._v("。")]),s._v(" "),a("p",[s._v("譬如：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("source"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'foo'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Event source foo...'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("只能使用 "),a("code",[s._v("addEventListener")]),s._v(" 进行监听。")]),s._v(" "),a("p",[a("code",[s._v("source.onfoo = () => {}")]),s._v(" 形式的监听不会工作。")])]),s._v(" "),a("p",[a("code",[s._v("server")]),s._v(" 端使用 "),a("code",[s._v("express")]),s._v(" 如下：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" message"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Message from foo.'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nres"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("event: 'foo'\\ndata:")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("${")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[s._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\\n\\n")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);