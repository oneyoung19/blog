(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{848:function(_,v,e){"use strict";e.r(v);var s=e(40),t=Object(s.a)({},(function(){var _=this,v=_.$createElement,e=_._self._c||v;return e("ContentSlotsDistributor",{attrs:{"slot-key":_.$parent.slotKey}},[e("p",[e("code",[_._v("JWT")]),_._v(" 的全称是 "),e("code",[_._v("JSON Web Token")]),_._v("。")]),_._v(" "),e("p",[e("a",{attrs:{href:"https://jwt.io/",target:"_blank",rel:"noopener noreferrer"}},[_._v("在线生成JWT"),e("OutboundLink")],1)]),_._v(" "),e("p",[e("a",{attrs:{href:"https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[_._v("JSON WEB TOKEN——阮一峰"),e("OutboundLink")],1)]),_._v(" "),e("p",[e("a",{attrs:{href:"https://www.zhihu.com/question/300576967/answer/659406256",target:"_blank",rel:"noopener noreferrer"}},[_._v("虽然JWT规范是无状态，但实际业务中依然要存状态"),e("OutboundLink")],1)]),_._v(" "),e("h2",{attrs:{id:"_1-session"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-session"}},[_._v("#")]),_._v(" 1.Session")]),_._v(" "),e("p",[e("code",[_._v("Session")]),_._v(" 的交互模式是，在服务端存储用户信息，并根据用户生成唯一对应的 "),e("code",[_._v("sessionID")]),_._v(" ，将 "),e("code",[_._v("sessionID")]),_._v(" 设置到响应头的 "),e("code",[_._v("set-cookie")]),_._v("，后续通信则通过客户端传递 "),e("code",[_._v("cookie")]),_._v(" 进行。")]),_._v(" "),e("p",[_._v("这种模式的缺点有：")]),_._v(" "),e("ol",[e("li",[e("p",[_._v("用户信息存储在服务端，消耗服务器资源和内存；")])]),_._v(" "),e("li",[e("p",[_._v("由于用户信息存储在数据库，因此不利于分布式部署的拓展。")])]),_._v(" "),e("li",[e("p",[_._v("利用 "),e("code",[_._v("cookie")]),_._v(" 机制，可能会产生 "),e("code",[_._v("CSRF")]),_._v(" 攻击。")])])]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("TIP")]),_._v(" "),e("p",[_._v("目前的现实业务中，有可能是将 "),e("code",[_._v("Session")]),_._v(" 与 "),e("code",[_._v("Token")]),_._v(" 结合的机制。而不是 "),e("code",[_._v("Session")]),_._v(" 与 "),e("code",[_._v("Cookie")]),_._v("。")]),_._v(" "),e("p",[_._v("也就是将 "),e("code",[_._v("sessionID")]),_._v(" 作为 "),e("code",[_._v("Token")]),_._v(" 返回给客户端，然后在通信的时候，将 "),e("code",[_._v("Token")]),_._v(" 设置到请求头中。")])]),_._v(" "),e("h2",{attrs:{id:"_2-jwt"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-jwt"}},[_._v("#")]),_._v(" 2.JWT")]),_._v(" "),e("p",[_._v("为了解决上述 "),e("code",[_._v("Session")]),_._v(" 的第 "),e("code",[_._v("1")]),_._v(" 和第 "),e("code",[_._v("2")]),_._v(" 缺点，引入了 "),e("code",[_._v("JWT")]),_._v(" 规范。")]),_._v(" "),e("p",[_._v("该规范的主要设计目的，就是"),e("strong",[_._v("将用户信息存储到客户端")]),_._v("。")]),_._v(" "),e("h3",{attrs:{id:"_2-1-数据结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-数据结构"}},[_._v("#")]),_._v(" 2-1.数据结构")]),_._v(" "),e("p",[e("strong",[e("code",[_._v("JWT")]),_._v(" 的数据结构设计为 "),e("code",[_._v("Header.Payload.Signature")])]),_._v("。")]),_._v(" "),e("ol",[e("li",[e("code",[_._v("Header")])])]),_._v(" "),e("p",[_._v("表示信息头部。")]),_._v(" "),e("p",[_._v("它通常是一个 "),e("code",[_._v("JSON")]),_._v(" 对象，描述 "),e("code",[_._v("JWT")]),_._v(" 的元数据：")]),_._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("{")]),_._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[_._v('"alg"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[_._v(":")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[_._v('"HS256"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[_._v('"typ"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[_._v(":")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[_._v('"JWT"')]),_._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("}")]),_._v("\n")])]),_._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[_._v("1")]),e("br"),e("span",{staticClass:"line-number"},[_._v("2")]),e("br"),e("span",{staticClass:"line-number"},[_._v("3")]),e("br"),e("span",{staticClass:"line-number"},[_._v("4")]),e("br")])]),e("p",[_._v("其中：")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("alg")]),_._v(" 表示签名的算法（"),e("code",[_._v("algorithm")]),_._v("），默认是 "),e("code",[_._v("HMAC SHA256")]),_._v("（写成 "),e("code",[_._v("HS256")]),_._v("）；")]),_._v(" "),e("li",[e("code",[_._v("typ")]),_._v("属性表示这个令牌（"),e("code",[_._v("token")]),_._v("）的类型（"),e("code",[_._v("type")]),_._v("），"),e("code",[_._v("JWT")]),_._v(" 令牌统一写为 "),e("code",[_._v("JWT")]),_._v("。")])]),_._v(" "),e("p",[e("strong",[_._v("定义 "),e("code",[_._v("JSON")]),_._v(" 对象后，进行 "),e("code",[_._v("base64URL")]),_._v(" 转码得到 "),e("code",[_._v("Header")]),_._v(" 字符串")]),_._v("。")]),_._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[e("code",[_._v("Payload")])])]),_._v(" "),e("p",[_._v("表示信息负载。")]),_._v(" "),e("p",[e("code",[_._v("Payload")]),_._v(" 部分也是一个 "),e("code",[_._v("JSON")]),_._v(" 对象，用来存放实际需要传递的数据。"),e("code",[_._v("JWT")]),_._v(" 规定了 "),e("code",[_._v("7")]),_._v(" 个官方字段，供选用：")]),_._v(" "),e("ul",[e("li",[e("code",[_._v("iss (issuer)")]),_._v("：签发人")]),_._v(" "),e("li",[e("code",[_._v("exp (expiration time)")]),_._v("：过期时间")]),_._v(" "),e("li",[e("code",[_._v("sub (subject)")]),_._v("：主题")]),_._v(" "),e("li",[e("code",[_._v("aud (audience)")]),_._v("：受众")]),_._v(" "),e("li",[e("code",[_._v("nbf (Not Before)")]),_._v("：生效时间")]),_._v(" "),e("li",[e("code",[_._v("iat (Issued At)")]),_._v("：签发时间")]),_._v(" "),e("li",[e("code",[_._v("jti (JWT ID)")]),_._v("：编号")])]),_._v(" "),e("p",[_._v("当然，除此以外，也可以在 "),e("code",[_._v("Payload")]),_._v(" 中"),e("strong",[_._v("添加自定义字段")]),_._v("。")]),_._v(" "),e("p",[e("strong",[_._v("定义 "),e("code",[_._v("JSON")]),_._v(" 对象后，进行 "),e("code",[_._v("base64URL")]),_._v(" 转码得到 "),e("code",[_._v("Payload")]),_._v(" 字符串")]),_._v("。")]),_._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[_._v("TIP")]),_._v(" "),e("p",[_._v("要注意的是，由于不存在加密，因此 "),e("code",[_._v("Payload")]),_._v(" 里不要携带用户的敏感信息。")])]),_._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[e("code",[_._v("Signature")])])]),_._v(" "),e("p",[_._v("表示信息签名。")]),_._v(" "),e("p",[_._v("该签名算法的原理是：")]),_._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token constant"}},[_._v("HMACSHA256")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[_._v("base64UrlEncode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("header"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[_._v("+")]),_._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[_._v('"."')]),_._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[_._v("+")]),_._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[_._v("base64UrlEncode")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v("(")]),_._v("payload"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(",")]),_._v("\n  secret"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[_._v(")")]),_._v("\n")])]),_._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[_._v("1")]),e("br"),e("span",{staticClass:"line-number"},[_._v("2")]),e("br"),e("span",{staticClass:"line-number"},[_._v("3")]),e("br"),e("span",{staticClass:"line-number"},[_._v("4")]),e("br")])]),e("p",[_._v("其中，"),e("code",[_._v("secret")]),_._v(" 表示密钥。"),e("strong",[_._v("上述算法执行之后，得到 "),e("code",[_._v("Signature")]),_._v(" 字符串")]),_._v("。")]),_._v(" "),e("h3",{attrs:{id:"_2-2-优缺点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-优缺点"}},[_._v("#")]),_._v(" 2-2.优缺点")]),_._v(" "),e("p",[e("strong",[_._v("优点")]),_._v("：")]),_._v(" "),e("ol",[e("li",[_._v("有效使用 "),e("code",[_._v("JWT")]),_._v("，可以降低服务器查询数据库的次数。")]),_._v(" "),e("li",[_._v("某种程度上有利于分布式系统拓展。")])]),_._v(" "),e("p",[e("strong",[_._v("缺点")]),_._v("：")]),_._v(" "),e("ol",[e("li",[_._v("有可能泄露。（一是 "),e("code",[_._v("Token")]),_._v(" 没有加密的话，任何人都可以转码获取到具体信息。二是在实际应用中，"),e("code",[_._v("Token")]),_._v(" 有可能是明文携带在 "),e("code",[_._v("URL")]),_._v(" 中，相当于直接暴露——相对 "),e("code",[_._v("Cookie")]),_._v(" 而言）。")]),_._v(" "),e("li",[_._v("在失效时间内，无法二次控制。譬如，实际业务中，要实现不同设备登录同一个账号，要互踢的话，纯 "),e("code",[_._v("Token")]),_._v(" 的设计无法实现。")])]),_._v(" "),e("p",[_._v("即便 "),e("code",[_._v("Token")]),_._v(" 的特点是"),e("strong",[_._v("无状态")]),_._v("，但实际业务中，可能依然要结合 "),e("code",[_._v("redis")]),_._v(" 等实现需求。")]),_._v(" "),e("p",[_._v("因此 "),e("code",[_._v("Token")]),_._v(" 只是一种规范。单纯使用 "),e("code",[_._v("Token")]),_._v(" 其实无法彻底满足业务需要。")])])}),[],!1,null,null,null);v.default=t.exports}}]);