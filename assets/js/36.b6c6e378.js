(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{485:function(t,s,n){"use strict";n.r(s);var a=n(40),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("p",[t._v("本节主要介绍 "),n("code",[t._v("MongoDB")]),t._v(" 的文档操作。")]),t._v(" "),n("p",[n("code",[t._v("MongoDB")]),t._v(" 中的数据存储在集合（"),n("code",[t._v("collection")]),t._v("）中，集合中的每条数据称为文档（"),n("code",[t._v("document")]),t._v("）。")]),t._v(" "),n("p",[t._v("其实 "),n("strong",[n("code",[t._v("MongoDB")]),t._v(" 的 "),n("code",[t._v("document")]),t._v(" 相当于 "),n("code",[t._v("SQL")]),t._v(" 中的 "),n("code",[t._v("row")])]),t._v("。")]),t._v(" "),n("h2",{attrs:{id:"查询文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查询文档"}},[t._v("#")]),t._v(" 查询文档")]),t._v(" "),n("p",[t._v("查询文档常用的方法有：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("方法名")]),t._v(" "),n("th",[t._v("说明")]),t._v(" "),n("th",[t._v("版本")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[n("code",[t._v("db.collection.find()")])]),t._v(" "),n("td",[t._v("查询集合中的文档")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.findOne()")])]),t._v(" "),n("td",[t._v("查询集合中的单个文档")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.findOneAnd*()")])]),t._v(" "),n("td",[t._v("查询集合中的单个文档，并且可以对文档进行更新、删除等操作。")]),t._v(" "),n("td",[n("code",[t._v("3.2+")])])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.aggregate()")])]),t._v(" "),n("td",[t._v("使用聚合管道对文档进行聚合操作。")]),t._v(" "),n("td",[n("code",[t._v("3.2+")])])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.count()")])]),t._v(" "),n("td",[t._v("统计集合中的文档数量。")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.distinct()")])]),t._v(" "),n("td",[t._v("返回集合中指定字段的不同值。")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.explain()")])]),t._v(" "),n("td",[t._v("返回集合中文档的执行计划。")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.findAndModify()")])]),t._v(" "),n("td",[t._v("查询集合中的单个文档，并且可以对文档进行更新、删除等操作。")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.findAndRemove()")])]),t._v(" "),n("td",[t._v("查询集合中的单个文档，并且可以对文档进行删除操作。")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.group()")])]),t._v(" "),n("td",[t._v("对集合中的文档进行分组聚合操作。")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.mapReduce()")])]),t._v(" "),n("td",[t._v("使用 "),n("code",[t._v("map")]),t._v(" 和 "),n("code",[t._v("reduce")]),t._v(" 函数对集合中的文档进行聚合操作。")]),t._v(" "),n("td")]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.parallelCollectionScan()")])]),t._v(" "),n("td",[t._v("并行扫描集合中的文档。")]),t._v(" "),n("td")])])]),t._v(" "),n("p",[t._v("此处，我们以 "),n("code",[t._v("find()")]),t._v(" 和 "),n("code",[t._v("findOne()")]),t._v(" 为例进行说明。")]),t._v(" "),n("p",[t._v("其中 "),n("strong",[n("code",[t._v("findOne()")]),t._v(" 方法只会查找第一条匹配的文档并返回，返回是对象形式")]),t._v("。")]),t._v(" "),n("p",[t._v("而 "),n("strong",[n("code",[t._v("find()")]),t._v(" 方法会返回一个 "),n("code",[t._v("cursor")]),t._v(" 对象，通过 "),n("code",[t._v("cursor")]),t._v(" 对象可以遍历集合中的所有文档")]),t._v("。")]),t._v(" "),n("p",[t._v("这个 "),n("code",[t._v("cursor")]),t._v(" 对象也可以看做 "),n("code",[t._v("JavaScript")]),t._v(" 中的 "),n("code",[t._v("Iterator")]),t._v(" 类数组对象，可以通过 "),n("code",[t._v("forEach()")]),t._v(" 方法遍历。")]),t._v(" "),n("p",[t._v("可以在 "),n("code",[t._v("MongoDB Shell")]),t._v(" 中执行以下命令进行测试：")]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("var result "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("find"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nvar array "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" result"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("toArray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nprintjson"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("array"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\narray"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("forEach"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" {\n  printjson"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("doc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])]),n("h2",{attrs:{id:"插入文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插入文档"}},[t._v("#")]),t._v(" 插入文档")]),t._v(" "),n("p",[t._v("在 "),n("code",[t._v("MongoDB")]),t._v(" 中，每一个文档都有一个 "),n("code",[t._v("_id")]),t._v(" 字段，用于唯一标识一个文档。")]),t._v(" "),n("p",[t._v("如果插入时没有指定 "),n("code",[t._v("_id")]),t._v(" 字段，"),n("code",[t._v("MongoDB")]),t._v(" 会自动为文档添加一个 "),n("code",[t._v("_id")]),t._v(" 字段。")]),t._v(" "),n("p",[t._v("插入文档常用的方法有：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("方法名")]),t._v(" "),n("th",[t._v("说明")]),t._v(" "),n("th",[t._v("版本")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[n("code",[t._v("db.collection.insertOne()")])]),t._v(" "),n("td",[t._v("将单个文档插入集合")]),t._v(" "),n("td",[n("code",[t._v("3.2+")])])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.insertMany()")])]),t._v(" "),n("td",[t._v("将多个文档插入集合")]),t._v(" "),n("td",[n("code",[t._v("3.2+")])])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.insert()")])]),t._v(" "),n("td",[t._v("将单个或多个文档插入集合")]),t._v(" "),n("td")])])]),t._v(" "),n("p",[t._v("譬如：")]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("insertOne"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("{\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("\n}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("insertMany"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  {\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("\n  }"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  {\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"李四"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n  }\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  {\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("\n  }"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  {\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"李四"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n  }\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("h2",{attrs:{id:"更新文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#更新文档"}},[t._v("#")]),t._v(" 更新文档")]),t._v(" "),n("p",[t._v("更新文档分为"),n("strong",[t._v("单个文档更新")]),t._v("与"),n("strong",[t._v("聚合管道更新")]),t._v("。")]),t._v(" "),n("p",[t._v("顾名思义，"),n("strong",[t._v("单个文档更新")]),t._v("是指更新单个文档。")]),t._v(" "),n("p",[t._v("而"),n("strong",[t._v("聚合管道更新")]),t._v("是指更新多个文档，并且可以使用聚合管道操作符对文档进行复杂的操作，例如 "),n("code",[t._v("$lookup")]),t._v("、"),n("code",[t._v("$addFields")]),t._v("、"),n("code",[t._v("$group")]),t._v(" 等操作符。")]),t._v(" "),n("p",[n("strong",[t._v("聚合管道更新")]),t._v("通常用于对符合一定条件的多个文档进行批量更新，而不是像普通的文档更新那样一次只能更新一个文档。")]),t._v(" "),n("p",[n("strong",[t._v("聚合管道更新")]),t._v("可以通过一个或多个聚合管道操作，对多个文档进行批量更新，大大提高了更新效率。")]),t._v(" "),n("h3",{attrs:{id:"单个文档更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单个文档更新"}},[t._v("#")]),t._v(" 单个文档更新")]),t._v(" "),n("p",[t._v("更新文档常用的方法有：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("方法")]),t._v(" "),n("th",[t._v("描述")]),t._v(" "),n("th",[t._v("版本")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[n("code",[t._v("db.collection.updateOne()")])]),t._v(" "),n("td",[t._v("更新单个与指定的过滤器匹配文档。")]),t._v(" "),n("td",[n("code",[t._v("3.2+")])])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.updateMany()")])]),t._v(" "),n("td",[t._v("更新所有与指定的过滤器匹配文档。")]),t._v(" "),n("td",[n("code",[t._v("3.2+")])])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.replaceOne()")])]),t._v(" "),n("td",[n("strong",[t._v("替换")]),t._v("单个与指定的过滤器匹配文档。")]),t._v(" "),n("td",[n("code",[t._v("3.2+")])])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.update()")])]),t._v(" "),n("td",[t._v("默认情况下，"),n("code",[t._v("db.collection.update()")]),t._v(" 方法更新单个文档。 要更新多个文档，请使用 "),n("code",[t._v("multi")]),t._v(" 选项。")]),t._v(" "),n("td")])])]),t._v(" "),n("p",[t._v("基本使用格式举例如下：")]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateOne"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("filter"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("update")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("replaceOne"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("filter"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("replacement"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("options"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[t._v("其中的参数含义如下：")]),t._v(" "),n("ol",[n("li",[n("code",[t._v("<filter>")]),t._v(" 查询条件")]),t._v(" "),n("li",[n("code",[t._v("<update>")]),t._v(" 更新操作，使用更新运算符")]),t._v(" "),n("li",[n("code",[t._v("<replacement>")]),t._v(" 替换文档，完整的新文档记录")]),t._v(" "),n("li",[n("code",[t._v("<options>")]),t._v(" 可选参数，如排序、限制等参数")])]),t._v(" "),n("p",[t._v("譬如：")]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateOne"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  { "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),t._v(" }"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  { $"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(": { "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" } }\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])]),n("p",[t._v("单个文档更新，也可以同时使用多个更新操作符，例如：")]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateOne"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  { "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"张三"')]),t._v(" }"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  {\n    $"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(": { "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" }"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    $currentDate: { "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lastModified"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" }\n  }\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("h3",{attrs:{id:"聚合管道更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#聚合管道更新"}},[t._v("#")]),t._v(" 聚合管道更新")]),t._v(" "),n("p",[t._v("聚合管道更新使用的是聚合管道操作符，而不是更新运算符。")]),t._v(" "),n("p",[t._v("而且聚合管道更新只能使用 "),n("code",[t._v("updateMany()")]),t._v(" 方法，且是"),n("strong",[t._v("数组形式")]),t._v("。")]),t._v(" "),n("p",[t._v("另外，聚合管道更新的执行效率要比单个文档更新高很多。")]),t._v(" "),n("p",[t._v("假设有一个集合存储每个用户的订单信息，包括订单号、用户 "),n("code",[t._v("ID")]),t._v("、商品名称和价格，并且我们想对每个用户的订单进行汇总，并将结算后的销售总额保存在用户文档中，可以使用聚合管道更新如下：")]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updateMany"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  {}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    {\n      $"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("group")]),t._v(": {\n        _id: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$userId"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        total: { $sum: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$price"')]),t._v(" }\n      }\n    }"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    {\n      $lookup: {\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"users"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        localField: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        foreignField: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),t._v("\n      }\n    }"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    {\n      $unwind: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$user"')]),t._v("\n    }"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    {\n      $addFields: {\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user.total"')]),t._v(": "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$total"')]),t._v("\n      }\n    }"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    {\n      $replaceRoot: {\n        newRoot: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"$user"')]),t._v("\n      }\n    }\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br")])]),n("p",[t._v("此代码的执行流程如下：")]),t._v(" "),n("ol",[n("li",[t._v("使用 "),n("code",[t._v("$group")]),t._v(" 操作符对每个用户的订单进行汇总，得到每个用户的销售总额")]),t._v(" "),n("li",[t._v("使用 "),n("code",[t._v("$lookup")]),t._v(" 操作符将用户文档与订单文档进行关联，得到每个用户的销售总额")]),t._v(" "),n("li",[t._v("使用 "),n("code",[t._v("$unwind")]),t._v(" 操作符将关联后的文档展开，得到每个用户的销售总额")]),t._v(" "),n("li",[t._v("使用 "),n("code",[t._v("$addFields")]),t._v(" 操作符将每个用户的销售总额添加到用户文档中")]),t._v(" "),n("li",[t._v("使用 "),n("code",[t._v("$replaceRoot")]),t._v(" 操作符将用户文档替换为聚合管道的根文档")]),t._v(" "),n("li",[t._v("使用 "),n("code",[t._v("updateMany")]),t._v(" 方法将聚合管道的根文档更新到用户文档中")]),t._v(" "),n("li",[n("code",[t._v("updateMany")]),t._v(" 方法会将聚合管道的根文档作为过滤器，将聚合管道的根文档更新为聚合管道的最后一个文档")])]),t._v(" "),n("h2",{attrs:{id:"删除文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除文档"}},[t._v("#")]),t._v(" 删除文档")]),t._v(" "),n("p",[t._v("删除文档常用的方法有：")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("方法")]),t._v(" "),n("th",[t._v("描述")]),t._v(" "),n("th",[t._v("版本")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[n("code",[t._v("db.collection.deleteOne()")])]),t._v(" "),n("td",[t._v("删除单个与指定过滤器匹配的文档")]),t._v(" "),n("td",[n("code",[t._v("3.2+")])])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.deleteMany()")])]),t._v(" "),n("td",[t._v("删除所有与指定过滤器匹配的文档")]),t._v(" "),n("td",[n("code",[t._v("3.2+")])])]),t._v(" "),n("tr",[n("td",[n("code",[t._v("db.collection.remove()")])]),t._v(" "),n("td",[t._v("删除单个文档或与指定过滤器匹配的所有文档")]),t._v(" "),n("td")])])]),t._v(" "),n("p",[t._v("如果想要删除所有文档，可以使用：")]),t._v(" "),n("div",{staticClass:"language-sql line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sql"}},[n("code",[t._v("db"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deleteMany"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("{}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 或者")]),t._v("\n\ndb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("collection"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("remove"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("{}"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("p",[t._v("这里的空对象 "),n("code",[t._v("{}")]),t._v(" 代表不过滤指定条件的文档，也就是会指代所有文档。")])])}),[],!1,null,null,null);s.default=e.exports}}]);