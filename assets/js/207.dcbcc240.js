(window.webpackJsonp=window.webpackJsonp||[]).push([[207],{664:function(s,e,a){"use strict";a.r(e);var t=a(40),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("应用容器化是将应用程序和其所有依赖项打包成一个容器中的过程。")]),s._v(" "),a("p",[s._v("这个容器可以在任何支持容器技术的操作系统上运行，而不需要重新配置或重新安装依赖项。")]),s._v(" "),a("p",[s._v("应用容器化技术提供了一种轻量级、可移植、可扩展和可隔离的部署方式，让开发者能够更方便地构建、测试和部署应用程序。")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("Docker")]),s._v(" 中，开发者可以将应用程序打包到一个镜像中，然后在容器中运行。")]),s._v(" "),a("p",[s._v("这个镜像包含了应用程序代码、库文件和运行时环境等所有需要的依赖项，从而避免了在不同的环境中重新安装和配置这些依赖项的复杂性。")]),s._v(" "),a("h2",{attrs:{id:"dockerfile"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile"}},[s._v("#")]),s._v(" Dockerfile")]),s._v(" "),a("p",[a("code",[s._v("Dockerfile")]),s._v(" 是一个文本文件，其中包含了一条条指令，用于构建一个镜像。")]),s._v(" "),a("p",[a("code",[s._v("Dockerfile")]),s._v(" 中的每一条指令都会创建一个新的镜像层，并对镜像进行更新。")]),s._v(" "),a("p",[s._v("当 "),a("code",[s._v("Docker")]),s._v(" 客户端执行 "),a("code",[s._v("docker build")]),s._v(" 命令时，它会读取 "),a("code",[s._v("Dockerfile")]),s._v(" 中的指令，并根据指令构建一个新的镜像。")]),s._v(" "),a("p",[a("code",[s._v("Dockerfile")]),s._v(" 中的指令可以分为以下几类：")]),s._v(" "),a("ul",[a("li",[s._v("基础指令（"),a("code",[s._v("FROM")]),s._v("、"),a("code",[s._v("MAINTAINER")]),s._v("、"),a("code",[s._v("RUN")]),s._v("、"),a("code",[s._v("CMD")]),s._v("、"),a("code",[s._v("EXPOSE")]),s._v("、"),a("code",[s._v("ENV")]),s._v("、"),a("code",[s._v("ADD")]),s._v("、"),a("code",[s._v("COPY")]),s._v("、"),a("code",[s._v("ENTRYPOINT")]),s._v("、"),a("code",[s._v("VOLUME")]),s._v("、"),a("code",[s._v("USER")]),s._v("、"),a("code",[s._v("WORKDIR")]),s._v("）")]),s._v(" "),a("li",[s._v("镜像维护指令（"),a("code",[s._v("LABEL")]),s._v("）")]),s._v(" "),a("li",[s._v("构建指令（"),a("code",[s._v("ARG")]),s._v("、"),a("code",[s._v("ONBUILD")]),s._v("、"),a("code",[s._v("STOPSIGNAL")]),s._v("、"),a("code",[s._v("HEALTHCHECK")]),s._v("、"),a("code",[s._v("SHELL")]),s._v("）")]),s._v(" "),a("li",[s._v("注释指令（"),a("code",[s._v("#")]),s._v("）")])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("关于如何区分命令是否会新建镜像层，一个基本的原则是：")]),s._v(" "),a("ul",[a("li",[s._v("如果指令的作用是向镜像中增添新的文件或程序，那么这条指令就会新建镜像层；")]),s._v(" "),a("li",[s._v("如果只是告诉 "),a("code",[s._v("Docker")]),s._v(" 如何完成构建或者如何运行应用程序，那么就只会增加镜像的元数据。")])])]),s._v(" "),a("p",[s._v("譬如一个简单的 "),a("code",[s._v("node")]),s._v(" 服务的 "),a("code",[s._v("Dockerfile")]),s._v(" 如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Linux x64")]),s._v("\nFROM alpine\n\nLABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maintainer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nigelpoulton@hotmail.com"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install Node and NPM")]),s._v("\nRUN apk "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" --update nodejs "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Copy app to /src")]),s._v("\nCOPY "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" /src\n\nWORKDIR /src\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Install dependencies")]),s._v("\nRUN  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n\nEXPOSE "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("在 "),a("code",[s._v("Dockerfile")]),s._v(" 中的指令主要有以下几种：")]),s._v(" "),a("h3",{attrs:{id:"from"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#from"}},[s._v("#")]),s._v(" FROM")]),s._v(" "),a("p",[a("code",[s._v("FROM")]),s._v(" 指令用于"),a("strong",[s._v("指定基础镜像")]),s._v("。")]),s._v(" "),a("p",[s._v("实际上，我们是基于基础镜像，实现一个定制化镜像。")]),s._v(" "),a("p",[s._v("因此一个 "),a("code",[s._v("Dockerfile")]),s._v(" 中 "),a("code",[s._v("FROM")]),s._v(" 是必备的指令，并且必须是第一条指令。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("FROM "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tag"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("在 "),a("code",[s._v("Docker Hub")]),s._v(" 上有非常多的高质量的官方镜像，有可以直接拿来使用的服务类的镜像，譬如：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("nginx")])]),s._v(" "),a("li",[a("code",[s._v("redis")])]),s._v(" "),a("li",[a("code",[s._v("mongo")])]),s._v(" "),a("li",[a("code",[s._v("mysql")])]),s._v(" "),a("li",[a("code",[s._v("httpd")])]),s._v(" "),a("li",[a("code",[s._v("php")])]),s._v(" "),a("li",[a("code",[s._v("tomcat")])])]),s._v(" "),a("p",[s._v("也有一些方便开发、构建、运行各种语言应用的镜像，譬如：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("node")])]),s._v(" "),a("li",[a("code",[s._v("openjdk")])]),s._v(" "),a("li",[a("code",[s._v("python")])]),s._v(" "),a("li",[a("code",[s._v("ruby")])]),s._v(" "),a("li",[a("code",[s._v("golang")])])]),s._v(" "),a("p",[s._v("此外，官方镜像中还提供了一些更为基础的操作系统镜像，譬如：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("ubuntu")])]),s._v(" "),a("li",[a("code",[s._v("debian")])]),s._v(" "),a("li",[a("code",[s._v("centos")])]),s._v(" "),a("li",[a("code",[s._v("fedora")])]),s._v(" "),a("li",[a("code",[s._v("alpine")])])]),s._v(" "),a("p",[s._v("除了选择现有镜像为基础镜像外，"),a("code",[s._v("Docker")]),s._v(" 还存在一个特殊的镜像，名为 "),a("code",[s._v("scratch")]),s._v("。")]),s._v(" "),a("p",[a("strong",[s._v("这个镜像是虚拟的概念，并不实际存在，它表示一个空白的镜像")]),s._v("。")]),s._v(" "),a("p",[s._v("如果以 "),a("code",[s._v("scratch")]),s._v(" 为基础镜像的话，意味着将不以任何镜像为基础，接下来所写的指令将作为镜像第一层开始存在。")]),s._v(" "),a("h3",{attrs:{id:"label"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#label"}},[s._v("#")]),s._v(" LABEL")]),s._v(" "),a("p",[a("code",[s._v("LABEL")]),s._v(" 指令用于给镜像以键值对的形式添加一些元数据。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("LABEL "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("譬如，声明镜像的作者和文档地址：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("LABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("maintainer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Tom"')]),s._v("\nLABEL "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("docs")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://docs.docker.com/engine/reference/builder/"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"run"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#run"}},[s._v("#")]),s._v(" RUN")]),s._v(" "),a("p",[a("code",[s._v("RUN")]),s._v(" 指令用于"),a("strong",[s._v("执行命令行命令")]),s._v("。")]),s._v(" "),a("p",[s._v("它的使用格式有两种：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RUN 命令")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("command"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# RUN ["可执行文件", "参数1", "参数2" ...]')]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("在书写 "),a("code",[s._v("Dockerfile")]),s._v(" 时，要注意的是"),a("strong",[s._v("每一条 "),a("code",[s._v("RUN")]),s._v(" 指令都会新建一层镜像")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("FROM debian:stretch\n\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y gcc libc6-dev "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O redis.tar.gz "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://download.redis.io/releases/redis-5.0.3.tar.gz"')]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/src/redis\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzf redis.tar.gz -C /usr/src/redis --strip-components"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -C /usr/src/redis\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -C /usr/src/redis "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("上面的 "),a("code",[s._v("Dockerfile")]),s._v(" 中，每一条 "),a("code",[s._v("RUN")]),s._v(" 指令都会新建一层镜像，这样会导致镜像体积过大。")]),s._v(" "),a("p",[s._v("因此，我们可以将多条 "),a("code",[s._v("RUN")]),s._v(" 指令合并为一条指令，这样就只会新建一层镜像。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("FROM debian:stretch\n\nRUN "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" update "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y gcc libc6-dev "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" -O redis.tar.gz "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://download.redis.io/releases/redis-5.0.3.tar.gz"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/src/redis "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xzf redis.tar.gz -C /usr/src/redis --strip-components"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -C /usr/src/redis "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" -C /usr/src/redis "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("其中，"),a("strong",[a("code",[s._v("\\")]),s._v(" 表示换行，"),a("code",[s._v("&&")]),s._v(" 表示将各个命令串联起来。")])]),s._v(" "),a("p",[s._v("相比之下，新的 "),a("code",[s._v("Dockerfile")]),s._v(" 中只会新建一层镜像，因此镜像体积也会更小。")]),s._v(" "),a("h3",{attrs:{id:"copy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#copy"}},[s._v("#")]),s._v(" COPY")]),s._v(" "),a("p",[a("code",[s._v("COPY")]),s._v(" 指令用于"),a("strong",[s._v("从构建上下文目录中<源路径>的文件/目录复制到新的一层的镜像内的<目标位置>")]),s._v("。")]),s._v(" "),a("p",[s._v("基本使用格式如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("COPY "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("src"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("dest"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("COPY")]),s._v(" 指令的 "),a("code",[s._v("src")]),s._v(" 参数可以是多个，但是 "),a("code",[s._v("dest")]),s._v(" 参数只能是一个。")]),s._v(" "),a("p",[a("code",[s._v("COPY")]),s._v(" 指令的 "),a("code",[s._v("src")]),s._v(" 参数可以是一个文件，也可以是一个目录。")]),s._v(" "),a("p",[a("strong",[s._v("如果 "),a("code",[s._v("src")]),s._v(" 参数是一个目录的话，那么 "),a("code",[s._v("dest")]),s._v(" 参数必须以 "),a("code",[s._v("/")]),s._v(" 结尾，否则会报错")]),s._v("。")]),s._v(" "),a("p",[a("code",[s._v("dest")]),s._v(" 不需要事先存在，"),a("code",[s._v("COPY")]),s._v(" 指令会自动创建。")]),s._v(" "),a("p",[s._v("譬如，复制 "),a("code",[s._v("package.json")]),s._v(" 到 "),a("code",[s._v("/usr/src/app/")]),s._v(" 目录中：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("COPY package.json /usr/src/app/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("此外，还需要注意一点，使用 "),a("code",[s._v("COPY")]),s._v(" 指令，源文件的各种元数据都会保留。比如读、写、执行权限、文件变更时间等。")]),s._v(" "),a("p",[s._v("这个特性对于镜像定制很有用。特别是构建相关文件都在使用 "),a("code",[s._v("Git")]),s._v(" 进行管理的时候。")]),s._v(" "),a("p",[s._v("最后，额外说明一下，"),a("code",[s._v("COPY")]),s._v(" 指令的 "),a("code",[s._v(".")]),s._v(" 符号。")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("当 "),a("code",[s._v("src")]),s._v(" 是 "),a("code",[s._v(".")]),s._v(" 时，代表的是上下文目录")]),s._v("。通常是 "),a("code",[s._v("Dockerfile")]),s._v(" 所在的目录。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("当 "),a("code",[s._v("dest")]),s._v(" 是 "),a("code",[s._v(".")]),s._v(" 时，代表的是容器内部的工作目录")]),s._v("。可以通过 "),a("code",[s._v("WORKDIR")]),s._v(" 指令来设置，默认是 "),a("code",[s._v("/")]),s._v("。")])])]),s._v(" "),a("h3",{attrs:{id:"workdir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#workdir"}},[s._v("#")]),s._v(" WORKDIR")]),s._v(" "),a("p",[a("code",[s._v("WORKDIR")]),s._v(" 指令用于"),a("strong",[s._v("设置工作目录")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("WORKDIR /path/to/workdir\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("WORKDIR")]),s._v(" 指令的参数可以是相对路径，也可以是绝对路径。")]),s._v(" "),a("p",[s._v("如果 "),a("code",[s._v("WORKDIR")]),s._v(" 指令的参数不存在，那么 "),a("code",[s._v("Docker")]),s._v(" 会自动创建这个目录。")]),s._v(" "),a("p",[s._v("如果 "),a("code",[s._v("WORKDIR")]),s._v(" 指令没有参数，那么会使用默认的工作目录，即 "),a("code",[s._v("/")]),s._v("。")]),s._v(" "),a("p",[s._v("一些初学者会将 "),a("code",[s._v("Dockerfile")]),s._v(" 当做 "),a("code",[s._v("SHELL")]),s._v(" 脚本来书写，譬如：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("RUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /app\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"helo world"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" hello.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("如果将这个 "),a("code",[s._v("Dockerfile")]),s._v(" 进行构建镜像运行后，会发现找不到 "),a("code",[s._v("/app/world.txt")]),s._v(" 文件，或者其内容不是 "),a("code",[s._v("hello")]),s._v("。")]),s._v(" "),a("p",[s._v("因为在 "),a("code",[s._v("Shell")]),s._v(" 中，连续两行是同一个进程执行环境，因此前一个命令修改的内存状态，会直接影响后一个命令；")]),s._v(" "),a("p",[s._v("而在 "),a("code",[s._v("Dockerfile")]),s._v(" 中，这两行 "),a("code",[s._v("RUN")]),s._v(" 命令的执行环境根本不同，是两个完全不同的容器。")]),s._v(" "),a("p",[s._v("因此，第二个 "),a("code",[s._v("RUN")]),s._v(" 命令是在 "),a("code",[s._v("/")]),s._v(" 目录下执行的，而不是 "),a("code",[s._v("/app")]),s._v(" 目录下。")]),s._v(" "),a("p",[s._v("这是对 "),a("code",[s._v("Dockerfile")]),s._v(" 构建分层存储的概念不了解所导致的错误。")]),s._v(" "),a("p",[a("strong",[s._v("如果需要改变以后各层的工作目录的位置")]),s._v("，那么应该使用 "),a("code",[s._v("WORKDIR")]),s._v(" 指令。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("WORKDIR /app\n\nRUN "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" world.txt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"expose"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#expose"}},[s._v("#")]),s._v(" EXPOSE")]),s._v(" "),a("p",[a("code",[s._v("EXPOSE")]),s._v(" 指令用于"),a("strong",[s._v("声明容器提供服务所使用的端口")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("EXPOSE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("EXPOSE")]),s._v(" 指令的参数可以是一个或多个，多个端口之间用空格分隔。")]),s._v(" "),a("p",[a("code",[s._v("EXPOSE")]),s._v(" 指令是声明容器运行时提供服务的端口，这只是一个声明，"),a("strong",[s._v("在容器运行时并不会因为这个声明应用就会开启这个端口的服务")]),s._v("。")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("Dockerfile")]),s._v(" 中写入这样的声明有两个好处，一个是帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射；")]),s._v(" "),a("p",[s._v("另一个用处则是在运行时使用随机端口映射时，也就是 "),a("code",[s._v("docker run -P")]),s._v(" 时，会自动随机映射 "),a("code",[s._v("EXPOSE")]),s._v(" 的端口。")]),s._v(" "),a("h3",{attrs:{id:"entrypoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#entrypoint"}},[s._v("#")]),s._v(" ENTRYPOINT")]),s._v(" "),a("p",[a("code",[s._v("ENTRYPOINT")]),s._v(" 指令用于"),a("strong",[s._v("设置容器启动时执行的命令")]),s._v("。")]),s._v(" "),a("p",[s._v("该指令的定义支持 "),a("code",[s._v("shell")]),s._v(" 形式和 "),a("code",[s._v("exec")]),s._v(" 形式。")]),s._v(" "),a("p",[s._v("基本格式如下：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"executable"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param1"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"param2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("其中，"),a("code",[s._v("executable")]),s._v(" 可以是一个 "),a("code",[s._v("shell")]),s._v(" 命令，也可以是一个可执行文件。")]),s._v(" "),a("p",[s._v("当 "),a("code",[s._v("executable")]),s._v(" 是一个 "),a("code",[s._v("shell")]),s._v(" 命令，将会在容器中启动一个新的 "),a("code",[s._v("shell")]),s._v(" 进程，并由该 "),a("code",[s._v("shell")]),s._v(" 进程解释执行命令。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("FROM python:3.9-slim-buster\nCOPY myscript.py /myscript.py\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"python"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/myscript.py"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("当 "),a("code",[s._v("executable")]),s._v(" 是一个可执行文件时，将会直接在容器中启动该可执行文件。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("FROM python:3.9-slim-buster\nCOPY myscript.py /myscript.py\nENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/bin/python"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/myscript.py"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("总的来说，如果在 "),a("code",[s._v("ENTRYPOINT")]),s._v(" 中使用了参数扩展或者希望在容器中使用管道、重定向等 "),a("code",[s._v("shell")]),s._v(" 特性，那么应该使用 "),a("code",[s._v("shell")]),s._v(" 形式；")]),s._v(" "),a("p",[s._v("如果希望执行的是一个可执行文件而不是一个 "),a("code",[s._v("shell")]),s._v(" 命令，那么应该使用 "),a("code",[s._v("exec")]),s._v(" 形式。")]),s._v(" "),a("h3",{attrs:{id:"cmd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cmd"}},[s._v("#")]),s._v(" CMD")]),s._v(" "),a("p",[a("code",[s._v("CMD")]),s._v(" 指令用于设置"),a("strong",[s._v("容器启动时默认执行")]),s._v("的命令。")]),s._v(" "),a("p",[a("code",[s._v("CMD")]),s._v(" 有多种不同的使用方式：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v('CMD ["executable","param1","param2"]')]),s._v(" ("),a("code",[s._v("exec")]),s._v(" 形式，推荐)")])]),s._v(" "),a("p",[a("strong",[s._v("在容器启动时运行指定的可执行文件和参数")]),s._v("。")]),s._v(" "),a("p",[s._v("例如，以下命令会在容器启动时运行 "),a("code",[s._v("/bin/echo")]),s._v(" 命令并输出 "),a("code",[s._v("Hello World")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("CMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/echo"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[a("code",[s._v('CMD ["param1","param2"]')]),s._v(" ("),a("code",[s._v("as default parameters to ENTRYPOINT")]),s._v(")")])]),s._v(" "),a("p",[a("strong",[s._v("在容器启动时运行 "),a("code",[s._v("ENTRYPOINT")]),s._v(" 指令指定的可执行文件，并将 "),a("code",[s._v("CMD")]),s._v(" 指令的参数作为参数传递给 "),a("code",[s._v("ENTRYPOINT")]),s._v(" 指令指定的可执行文件")]),s._v("。")]),s._v(" "),a("p",[s._v("例如，以下命令会在容器启动时运行 "),a("code",[s._v("/bin/echo")]),s._v(" 命令并输出 "),a("code",[s._v("Hello World")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ENTRYPOINT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/echo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("code",[s._v("CMD command param1 param2")]),s._v(" ("),a("code",[s._v("shell")]),s._v(" 形式)")])]),s._v(" "),a("p",[a("strong",[s._v("在容器启动时运行指定的命令")]),s._v("。")]),s._v(" "),a("p",[s._v("例如，以下命令会在容器启动时运行 "),a("code",[s._v("/bin/echo")]),s._v(" 命令并输出 "),a("code",[s._v("Hello World")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("CMD "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" Hello World\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果在运行 "),a("code",[s._v("Docker")]),s._v(" 容器时使用了自定义命令，则 "),a("code",[s._v("CMD")]),s._v(" 中指定的默认命令会被覆盖。")]),s._v(" "),a("p",[s._v("例如，如果 "),a("code",[s._v("Dockerfile")]),s._v(" 中定义了如下 "),a("code",[s._v("CMD")]),s._v(" 指令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("CMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/echo"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Hello World"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("当运行容器时，使用了自定义命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker run -it myimage /bin/bash\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("则容器启动时会运行 "),a("code",[s._v("/bin/bash")]),s._v(" 命令，而不是 "),a("code",[s._v("CMD")]),s._v(" 指令中定义的 "),a("code",[s._v("/bin/echo")]),s._v(" 命令。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("每个 "),a("code",[s._v("Dockerfile")]),s._v(" 只能有一个 "),a("code",[s._v("CMD")]),s._v(" 指令。如果有多个，只有最后一个指令会被执行。")]),s._v(" "),a("p",[s._v("同理，使用 "),a("code",[s._v("docker run")]),s._v(" 命令时，如果指定了多个命令，则只有最后一个命令会被执行，其他命令都会被忽略。")])]),s._v(" "),a("p",[s._v("譬如，以下命令：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker run myimage /bin/bash -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"echo Hello"')]),s._v(" /bin/echo "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"World"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("只会执行最后一个命令 "),a("code",[s._v('/bin/echo "World"')]),s._v("，而前面的 "),a("code",[s._v('/bin/bash -c "echo Hello"')]),s._v(" 命令会被忽略。")]),s._v(" "),a("h3",{attrs:{id:"arg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#arg"}},[s._v("#")]),s._v(" ARG")]),s._v(" "),a("p",[a("code",[s._v("ARG")]),s._v(" 指令用于"),a("strong",[s._v("设置构建镜像时传递给 "),a("code",[s._v("Dockerfile")]),s._v(" 的参数")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ARG "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("default value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("code",[s._v("ARG")]),s._v(" 指令的参数是一个变量名，可以在 "),a("code",[s._v("Dockerfile")]),s._v(" 中使用 "),a("code",[s._v("$<name>")]),s._v(" 的形式来引用这个变量。")]),s._v(" "),a("p",[a("code",[s._v("ARG")]),s._v(" 指令的参数还可以指定一个默认值，如果在构建镜像时没有指定该参数的值，则会使用默认值。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ARG "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("VERSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("latest\nFROM ubuntu:"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$VERSION")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"开发环境构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开发环境构建"}},[s._v("#")]),s._v(" 开发环境构建")]),s._v(" "),a("p",[s._v("以一个 "),a("code",[s._v("Vue")]),s._v(" 单页面应用在开发环境下的构建为例。")]),s._v(" "),a("p",[s._v("首先安装 "),a("code",[s._v("vue-cli")]),s._v("，然后执行 "),a("code",[s._v("vue create")]),s._v(" 命令创建一个 "),a("code",[s._v("Vue")]),s._v(" 单页面应用：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g @vue/cli\n\nvue create vue-demo\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("在项目根目录下，创建一个对应为开发环境的 "),a("code",[s._v("Dockerfile")]),s._v(" 文件，譬如名为 "),a("code",[s._v("Dockerfile.dev")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 基础镜像选择node 如果选择alpine等操作系统的话 需要手动RUN指令安装node")]),s._v("\nFROM node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指令容器上的工作目录 docker会自动创建")]),s._v("\nWORKDIR /app\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝本地所有代码 这样的话 即使不使用volume挂载启动，也能正常启动项目")]),s._v("\nCOPY . .\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用Yarn替代NPM node:16镜像上好像已经全局安装了yarn 如果没有的话 需要执行RUN npm install -g yarn安装yarn")]),s._v("\nRUN yarn install\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vue-cli项目默认的端口是8080 此处就暴露该端口")]),s._v("\nEXPOSE 8080\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器启动后默认执行的命令")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"yarn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构建镜像")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker image build -f Dockerfile.env -t vue-dev .")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 普通启动")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -p 8084:8080 -d --name vue-server vue-dev")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载启动 因为涉及到挂载 启动相对会耗时一些")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -p 8085:8080 -d --name vue-hot-server -v $PWD:/app vue-dev")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 该形式会实现vue项目在开发环境下的热重载，注意是热重载，而不是热更新。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 热重载：修改代码后，浏览器会自动刷新，但是会丢失当前页面的状态。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 热更新：修改代码后，浏览器不会刷新，但是会保留当前页面的状态。")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("h3",{attrs:{id:"构建镜像"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像"}},[s._v("#")]),s._v(" 构建镜像")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("Dockerfile.dev")]),s._v(" 文件构建一个名为 "),a("code",[s._v("vue-dev")]),s._v(" 的镜像：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker image build -f Dockerfile.dev -t vue-dev "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"启动容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动容器"}},[s._v("#")]),s._v(" 启动容器")]),s._v(" "),a("p",[s._v("利用 "),a("code",[s._v("vue-dev")]),s._v(" 镜像启动一个名为 "),a("code",[s._v("vue-server")]),s._v(" 且后台运行的容器：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker run -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8084")]),s._v(":8080 -d --name vue-server vue-dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后就可以在 "),a("code",[s._v("http://localhost:8084")]),s._v(" 访问到 "),a("code",[s._v("Vue")]),s._v(" 单页面应用了。")]),s._v(" "),a("p",[s._v("如果想要更改本地代码，即时反应到容器中的话，可以使用 "),a("code",[s._v("volume")]),s._v(" 即 "),a("code",[s._v("-v")]),s._v(" 挂载的方式启动容器：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker run -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8085")]),s._v(":8080 -d --name vue-hot-server -v "),a("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v(":/app vue-dev\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后就可以在 "),a("code",[s._v("http://localhost:8085")]),s._v(" 访问到 "),a("code",[s._v("Vue")]),s._v(" 单页面应用了。")]),s._v(" "),a("p",[s._v("我们将本地的 "),a("code",[s._v("vue-demo")]),s._v(" 目录挂载到容器的 "),a("code",[s._v("/app")]),s._v(" 目录下，当更改 "),a("code",[s._v("vue-demo")]),s._v(" 下的代码，容器内的 "),a("code",[s._v("/app")]),s._v(" 目录下的代码也会同步修改。")]),s._v(" "),a("p",[s._v("这样就可以实现 "),a("code",[s._v("vue")]),s._v(" 项目在开发环境下的热重载，"),a("strong",[s._v("注意是热重载，而不是热更新")]),s._v("。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),a("p",[s._v("后者 "),a("code",[s._v("volume")]),s._v(" 挂载启动，由于涉及到数据卷的创建，启动相对会耗时一些。")]),s._v(" "),a("p",[s._v("实际测试时，更改本地代码后，容器内的代码也同步修改了。")]),s._v(" "),a("p",[s._v("但需要手动刷新浏览器，页面内容才发生变化。因此，这种开发环境实现的容器，笔者认为意义并不是很大。")])]),s._v(" "),a("h2",{attrs:{id:"生产环境构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生产环境构建"}},[s._v("#")]),s._v(" 生产环境构建")]),s._v(" "),a("p",[s._v("在上文中，我们实现了开发环境下的容器化，接下来我们来实现生产环境下的容器化。")]),s._v(" "),a("p",[s._v("开发环境下的镜像，不单单有 "),a("code",[s._v("node")]),s._v(" 镜像，甚至将 "),a("code",[s._v("node_modules")]),s._v(" 也打包进了镜像中，这样的镜像体积会很大。")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("REPOSITORY")]),s._v(" "),a("th",[s._v("TAG")]),s._v(" "),a("th",[s._v("IMAGE ID")]),s._v(" "),a("th",[s._v("CREATED")]),s._v(" "),a("th",[s._v("SIZE")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("vue-dev")]),s._v(" "),a("td",[s._v("latest")]),s._v(" "),a("td",[s._v("f7102f91333d")]),s._v(" "),a("td",[s._v("24 hours ago")]),s._v(" "),a("td",[s._v("1.29GB")])])])]),s._v(" "),a("p",[s._v("而在生产环境下，我们其实只需要 "),a("code",[s._v("dist")]),s._v(" 包，并将其进行 "),a("code",[s._v("nginx")]),s._v(" 托管即可。")]),s._v(" "),a("p",[s._v("因此，我们首先需要使用 "),a("code",[s._v("node")]),s._v(" 镜像将项目打包成 "),a("code",[s._v("dist")]),s._v("，然后再使用 "),a("code",[s._v("nginx")]),s._v(" 镜像将 "),a("code",[s._v("dist")]),s._v(" 进行托管。")]),s._v(" "),a("p",[s._v("这就涉及到了一个概念："),a("strong",[s._v("多阶段构建")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"多阶段构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多阶段构建"}},[s._v("#")]),s._v(" 多阶段构建")]),s._v(" "),a("p",[s._v("多阶段的含义，就是在一个 "),a("code",[s._v("Dockerfile")]),s._v(" 文件中，可以定义多个 "),a("code",[s._v("FROM")]),s._v(" 指令，每个 "),a("code",[s._v("FROM")]),s._v(" 指令都会产生一个阶段，而每个阶段都可以使用不同的基础镜像。")]),s._v(" "),a("p",[s._v("同样，以上一节中的 "),a("code",[s._v("vue-demo")]),s._v(" 项目为例，我们在项目根目录下创建一个名为 "),a("code",[s._v("Dockerfile.prod")]),s._v(" 的文件：")]),s._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以node为基础镜像 并定义该阶段的别名为web")]),s._v("\nFROM node"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("16 as web\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义容器上的工作目录")]),s._v("\nWORKDIR /app\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拷贝本地所有代码至容器的工作目录/app")]),s._v("\nCOPY . .\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装依赖，并执行打包命令，结束后会在容器的/app目录下生成dist目录")]),s._v("\nRUN yarn install "),a("span",{pre:!0,attrs:{class:"token important"}},[s._v("&&")]),s._v(" yarn build\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 拉取nginx镜像")]),s._v("\nFROM nginx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.21.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("alpine\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将web阶段打包生成的/app/dist目录拷贝至nginx容器下的/usr/share/nginx/html目录")]),s._v("\nCOPY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("from=web /app/dist /usr/share/nginx/html\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将自定义的nginx配置文件拷贝至nginx容器下的/etc/nginx/conf.d目录")]),s._v("\nCOPY "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("from=web /app/nginx/ /etc/nginx/conf.d/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露80默认端口 以及自定义的9527端口（需要设置对应端口的nginx配置文件）")]),s._v("\nEXPOSE 80 9527\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器启动时，默认启动nginx")]),s._v("\nCMD "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-g"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"daemon off;"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("额外说明一下，"),a("code",[s._v("/app/nginx")]),s._v(" 配置文件，其实是放置在 "),a("code",[s._v("vue-demo")]),s._v(" 根目录下的 "),a("code",[s._v("nginx")]),s._v(" 目录。")]),s._v(" "),a("p",[s._v("因为我们在 "),a("code",[s._v("web")]),s._v(" 阶段使用 "),a("code",[s._v("COPY . .")]),s._v(" 将 "),a("code",[s._v("vue-demo")]),s._v(" 下的所有文件都拷贝到了容器的 "),a("code",[s._v("/app")]),s._v(" 目录下。")]),s._v(" "),a("p",[s._v("此处，对应端口 "),a("code",[s._v("9527")]),s._v("，可以在 "),a("code",[s._v("vue-demo")]),s._v(" 下的 "),a("code",[s._v("nginx")]),s._v(" 目录新建一个 "),a("code",[s._v("vue-port-9527.conf")]),s._v("：")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server {\n    listen       9527;\n    listen  [::]:9527;\n    server_name  localhost;\n\n    #access_log  /var/log/nginx/host.access.log  main;\n\n    location / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n        # 处理单页面应用的history路由\n        try_files $uri $uri/ /index.html;\n    }\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    error_page   500 502 503 504  /50x.html;\n    location = /50x.html {\n        root   /usr/share/nginx/html;\n    }\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h3",{attrs:{id:"构建镜像-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建镜像-2"}},[s._v("#")]),s._v(" 构建镜像")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("Dockerfile.prod")]),s._v(" 构建名为 "),a("code",[s._v("vue-prod")]),s._v(" 的镜像：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker build -f Dockerfile.prod -t vue-prod "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后我们对比一下，"),a("code",[s._v("vue-dev")]),s._v(" 镜像和 "),a("code",[s._v("vue-prod")]),s._v(" 镜像的体积：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("REPOSITORY")]),s._v(" "),a("th",[s._v("TAG")]),s._v(" "),a("th",[s._v("IMAGE ID")]),s._v(" "),a("th",[s._v("CREATED")]),s._v(" "),a("th",[s._v("SIZE")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("vue-dev")]),s._v(" "),a("td",[s._v("latest")]),s._v(" "),a("td",[s._v("f7102f91333d")]),s._v(" "),a("td",[s._v("24 hours ago")]),s._v(" "),a("td",[s._v("1.29GB")])]),s._v(" "),a("tr",[a("td",[s._v("vue-prod")]),s._v(" "),a("td",[s._v("latest")]),s._v(" "),a("td",[s._v("7ccd7d0e5200")]),s._v(" "),a("td",[s._v("21 hours ago")]),s._v(" "),a("td",[s._v("23.6MB")])])])]),s._v(" "),a("h3",{attrs:{id:"启动容器-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动容器-2"}},[s._v("#")]),s._v(" 启动容器")]),s._v(" "),a("p",[s._v("利用 "),a("code",[s._v("vue-prod")]),s._v(" 镜像创建一个名为 "),a("code",[s._v("vue-prod")]),s._v(" 的容器，并将容器的 "),a("code",[s._v("9527")]),s._v(" 端口映射到本地的 "),a("code",[s._v("9527")]),s._v(" 端口：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("docker run -d -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9527")]),s._v(":9527 --name vue-prod vue-prod\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);