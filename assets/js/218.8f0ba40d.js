(window.webpackJsonp=window.webpackJsonp||[]).push([[218],{673:function(t,e,s){"use strict";s.r(e);var v=s(40),_=Object(v.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("本章主要说明结合了 "),s("code",[t._v("Git Hooks")]),t._v(" 与 "),s("code",[t._v("NPM Hooks")]),t._v(" 的 "),s("code",[t._v("husky")]),t._v(" 仓库。")]),t._v(" "),s("p",[t._v("以实现在 "),s("code",[t._v("git commit")]),t._v(" 操作时对代码进行 "),s("code",[t._v("lint-staged")]),t._v(" 操作。")]),t._v(" "),s("h2",{attrs:{id:"_1-yorkie-husky"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-yorkie-husky"}},[t._v("#")]),t._v(" 1.yorkie & husky")]),t._v(" "),s("h3",{attrs:{id:"_1-1-yorkie"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-yorkie"}},[t._v("#")]),t._v(" 1-1.yorkie")]),t._v(" "),s("p",[s("code",[t._v("yorkie")]),t._v(" 是 "),s("code",[t._v("fork")]),t._v(" 自 "),s("code",[t._v("husky")]),t._v(" 的项目。目前较新版本是"),s("a",{attrs:{href:"https://www.npmjs.com/package/yorkie",target:"_blank",rel:"noopener noreferrer"}},[t._v("yorkie@2.0.0"),s("OutboundLink")],1)]),t._v(" "),s("ol",[s("li",[s("p",[t._v("项目中执行 "),s("code",[t._v("git init")]),t._v("，以支持 "),s("code",[t._v("yorkie")]),t._v(" 在 "),s("code",[t._v(".git/hooks")]),t._v(" 目录下创建 "),s("code",[t._v("hooks")]),t._v(" 文件。")])]),t._v(" "),s("li",[s("p",[t._v("它内置了 "),s("code",[t._v("install")]),t._v(" 生命周期钩子，在安装该依赖包时，会自动在 "),s("code",[t._v(".git/hooks")]),t._v(" 目录下注册所有可用 "),s("code",[t._v("hooks")]),t._v("。")])]),t._v(" "),s("li",[s("p",[t._v("用户在使用时，需要在 "),s("code",[t._v("package.json")]),t._v(" 中定制化声明 "),s("code",[t._v("Git Hooks")]),t._v("，譬如：")])])]),t._v(" "),s("div",{staticClass:"language-json line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-json"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"gitHooks"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"pre-commit"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"lint-staged"')]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"lint-staged"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),s("span",{pre:!0,attrs:{class:"token property"}},[t._v('"*.{js,jsx,vue}"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vue-cli-service lint"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"git add"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br")])]),s("p",[t._v("这样，在执行 "),s("code",[t._v("git commit")]),t._v(" 时，就会触发 "),s("code",[t._v("pre-commit")]),t._v(" 钩子。")]),t._v(" "),s("p",[s("strong",[s("em",[t._v("要注意的的一点，由于 "),s("code",[t._v("yorkie")]),t._v(" 依赖 "),s("code",[t._v(".git")]),t._v(" 目录，所以在安装 "),s("code",[t._v("yorkie")]),t._v(" 之前，最好保证当前项目目录已经执行 "),s("code",[t._v("git init")]),t._v(" 命令，创建了 "),s("code",[t._v(".git")]),t._v(" 目录")])]),t._v("。")]),t._v(" "),s("p",[t._v("如果说，先安装了 "),s("code",[t._v("yorkie")]),t._v("，后执行了 "),s("code",[t._v("git init")]),t._v("。那么你可以手动执行 "),s("code",[t._v("yorkie")]),t._v(" 的 "),s("code",[t._v("bin/install.js")]),t._v(" 文件进行补救：")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("node "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"node_modules/yorkie/bin/install.js"')]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"_1-2-husky"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-husky"}},[t._v("#")]),t._v(" 1-2.husky")]),t._v(" "),s("p",[t._v("较新版本的"),s("a",{attrs:{href:"https://typicode.github.io/husky/",target:"_blank",rel:"noopener noreferrer"}},[t._v("husky"),s("OutboundLink")],1),t._v(" 已经"),s("a",{attrs:{href:"https://blog.typicode.com/husky-git-hooks-autoinstall/",target:"_blank",rel:"noopener noreferrer"}},[t._v("不推荐 "),s("code",[t._v("autoinstall")]),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("譬如笔者在测试中使用的版本是"),s("a",{attrs:{href:"https://www.npmjs.com/package/husky",target:"_blank",rel:"noopener noreferrer"}},[t._v("husky@^8.0.3"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("新版本的 "),s("code",[t._v("husky")]),t._v(" 使用方式有两种：")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("第一种是利用 "),s("code",[t._v("npx husky-init")])])]),t._v(" "),s("li",[s("p",[t._v("第二种是手动安装 "),s("code",[t._v("husky")]),t._v("，然后配置 "),s("code",[t._v("Git Hooks")]),t._v("。")])])]),t._v(" "),s("p",[t._v("详见"),s("a",{attrs:{href:"https://typicode.github.io/husky/getting-started.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装husky"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("安装完成后，执行 "),s("code",[t._v("git config -l")]),t._v(" 会发现 "),s("code",[t._v("core.hookspath=.husky")]),t._v("。")]),t._v(" "),s("p",[t._v("如果要卸载 "),s("code",[t._v("husky")]),t._v(" 的话，执行：")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" uninstall husky "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" config --unset core.hooksPath\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[t._v("然后你可以根据实际需求，抉择是否删除 "),s("code",[t._v(".husky")]),t._v(" 目录：")]),t._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("rm")]),t._v(" -rf .husky\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("strong",[s("em",[s("code",[t._v("husky")]),t._v(" 根据 "),s("code",[t._v("git")]),t._v(" 提供的 "),s("code",[t._v("core.hooksPath")]),t._v(" 创建了 "),s("code",[t._v(".husky")]),t._v(" 目录，不再依赖 "),s("code",[t._v(".git")]),t._v(" 目录")])]),t._v("。")]),t._v(" "),s("p",[s("strong",[s("em",[t._v("但由于映射关系的存在，同样需要先利用 "),s("code",[t._v("git init")]),t._v(" 创建 "),s("code",[t._v(".git")]),t._v(" 目录")])]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"_2-yorkie-of-vue-cli"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-yorkie-of-vue-cli"}},[t._v("#")]),t._v(" 2.yorkie of vue-cli")]),t._v(" "),s("p",[s("strong",[s("code",[t._v("yorkie")]),t._v(" 是 "),s("code",[t._v("fork")]),t._v(" 自 "),s("code",[t._v("husky")]),t._v("，在安装时，会 "),s("code",[t._v("autoinstall")]),t._v("。")])]),t._v(" "),s("p",[t._v("假设 "),s("code",[t._v("vue-app-git")]),t._v(" 和 "),s("code",[t._v("vue-app-not-git")]),t._v(" 都是利用 "),s("code",[t._v("vue create")]),t._v(" 创建的项目。")]),t._v(" "),s("p",[t._v("二者的唯一区别是，"),s("code",[t._v("vue-app-git")]),t._v(" 是在本机检测有 "),s("code",[t._v("git")]),t._v(" 的情况下安装的，而 "),s("code",[t._v("vue-app-not-git")]),t._v(" 则是在本机检测没有 "),s("code",[t._v("git")]),t._v(" 的情况下安装的。")]),t._v(" "),s("p",[t._v("上述区别是通过更改全局包 "),s("code",[t._v("@vue/cli-shared-utils")]),t._v(" 中的 "),s("code",[t._v("hasGit")]),t._v(" 函数返回值实现的。")]),t._v(" "),s("p",[s("code",[t._v("vue-app-git")]),t._v(" 和 "),s("code",[t._v("vue-app-not-git")]),t._v(" 都是选择了 "),s("code",[t._v("lint on commit")]),t._v("，但实际执行，会发现：")]),t._v(" "),s("ol",[s("li",[s("code",[t._v("vue-app-git")]),t._v(" 的 "),s("code",[t._v("git commit")]),t._v(" 会触发检测。")]),t._v(" "),s("li",[s("code",[t._v("vue-app-not-git")]),t._v(" 的 "),s("code",[t._v("git commit")]),t._v(" 则不会触发检测。")])]),t._v(" "),s("p",[t._v("这是因为当 "),s("code",[t._v("yorkie")]),t._v(" 在安装会自动执行，但在 "),s("code",[t._v("vue-app-not-git")]),t._v(" 下没有找到 "),s("code",[t._v(".git")]),t._v(" 目录，也就无法在 "),s("code",[t._v(".git/hooks")]),t._v(" 下注入执行脚本。")]),t._v(" "),s("h2",{attrs:{id:"_3-notes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-notes"}},[t._v("#")]),t._v(" 3.Notes")]),t._v(" "),s("h3",{attrs:{id:"_3-1-prepare"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-prepare"}},[t._v("#")]),t._v(" 3-1.prepare")]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("scripts")]),t._v(" 下定义了 "),s("code",[t._v("prepare")]),t._v(" 生命周期钩子。")]),t._v(" "),s("p",[t._v("但利用 "),s("code",[t._v("yarn add yorkie -D")]),t._v(" 时，"),s("code",[t._v("prepare")]),t._v(" 会触发，而 "),s("code",[t._v("npm install yorkie --save-dev")]),t._v(" 并不会触发。")]),t._v(" "),s("p",[t._v("执行 "),s("code",[t._v("npm install")]),t._v(" 会触发 "),s("code",[t._v("prepare")]),t._v(" 生命周期钩子。")]),t._v(" "),s("h3",{attrs:{id:"_3-2-install-uninstall"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-install-uninstall"}},[t._v("#")]),t._v(" 3-2.install & uninstall")]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("scripts")]),t._v(" 下定义了 "),s("code",[t._v("install")]),t._v(" 和 "),s("code",[t._v("uninstall")]),t._v("。")]),t._v(" "),s("p",[t._v("但为什么触发 "),s("code",[t._v("install")]),t._v(" 和 "),s("code",[t._v("uninstall")]),t._v(" 时，并没有打印 "),s("code",[t._v("node bin/install.js")]),t._v(" 中的 "),s("code",[t._v("console")]),t._v(" 呢?")]),t._v(" "),s("p",[t._v("答案是"),s("a",{attrs:{href:"https://docs.npmjs.com/cli/v10/using-npm/scripts#a-note-on-a-lack-of-npm-uninstall-scripts",target:"_blank",rel:"noopener noreferrer"}},[t._v("与 "),s("code",[t._v("npm")]),t._v(" 版本相关"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("p",[t._v("测试了下，"),s("code",[t._v("pnpm@7.33.6")]),t._v(" 在安装或者卸载包时，不会触发 "),s("code",[t._v("install")]),t._v(" 或 "),s("code",[t._v("uninstall")]),t._v(" 生命周期钩子。")]),t._v(" "),s("p",[t._v("因此 "),s("code",[t._v("vue-app-git-pnpm")]),t._v(" 目录下的 "),s("code",[t._v("git commit")]),t._v(" 不会触发 "),s("code",[t._v("pre-commit")]),t._v(" 钩子。")]),t._v(" "),s("h2",{attrs:{id:"_4-npm-life-cycle-scripts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-npm-life-cycle-scripts"}},[t._v("#")]),t._v(" 4.NPM Life Cycle Scripts")]),t._v(" "),s("p",[t._v("查看 "),s("code",[t._v("NPM")]),t._v(" 支持的生命周期钩子："),s("a",{attrs:{href:"https://docs.npmjs.com/cli/v10/using-npm/scripts#life-cycle-scripts",target:"_blank",rel:"noopener noreferrer"}},[t._v("life-cycle-scripts"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"_5-git-hooks"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-git-hooks"}},[t._v("#")]),t._v(" 5.Git Hooks")]),t._v(" "),s("p",[t._v("查看 "),s("code",[t._v("Git")]),t._v(" 支持的钩子："),s("a",{attrs:{href:"https://git-scm.com/docs/githooks",target:"_blank",rel:"noopener noreferrer"}},[t._v("Git Hooks"),s("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=_.exports}}]);