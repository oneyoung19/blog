(window.webpackJsonp=window.webpackJsonp||[]).push([[370],{828:function(s,t,n){"use strict";n.r(t);var a=n(40),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("在 "),n("code",[s._v("Vue")]),s._v(" 中，提供了 "),n("code",[s._v("template")]),s._v(" 选项。")]),s._v(" "),n("p",[s._v("它允许我们像书写 "),n("code",[s._v("HTML")]),s._v(" 结构一样，编写基础的 "),n("code",[s._v("Vue")]),s._v(" 模板语法。")]),s._v(" "),n("p",[s._v("除此以外，"),n("code",[s._v("template")]),s._v(" 模板还支持"),n("strong",[s._v("属性绑定")]),s._v("、"),n("strong",[s._v("事件绑定")]),s._v("、"),n("strong",[s._v("指令")]),s._v("等等。")]),s._v(" "),n("h2",{attrs:{id:"核心代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#核心代码"}},[s._v("#")]),s._v(" 核心代码")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" createCompiler "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("createCompilerCreator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("baseCompile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("template"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  options"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" CompilerOptions")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" CompiledResult "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" ast "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("parse")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("template"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("trim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("optimize "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("optimize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" code "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("generate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    ast"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    render"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("render"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    staticRenderFns"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("staticRenderFns\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h2",{attrs:{id:"编译流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#编译流程"}},[s._v("#")]),s._v(" 编译流程")]),s._v(" "),n("p",[s._v("事实上，"),n("strong",[n("code",[s._v("template")]),s._v(" 并非 "),n("code",[s._v("HTML")]),s._v("，它其实是 "),n("code",[s._v("render")]),s._v(" 函数的变种，"),n("code",[s._v("Vue")]),s._v(" 以一种可见的方式呈现在我们面前")]),s._v("。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("`template` 模板字符串\n↓\n`parse` (解析) → `AST`\n↓\n`optimize` (优化) → 优化后的 `AST`，标记静态节点\n↓\n`codegen` (代码生成) → `render` 字符串\n↓\n`to-function` (转换函数) → `render` 函数\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"通用编译"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通用编译"}},[s._v("#")]),s._v(" 通用编译")]),s._v(" "),n("p",[s._v("另外，本节中的 "),n("code",[s._v("compiler")]),s._v(" 是"),n("strong",[s._v("通用编译")]),s._v("，也就是说"),n("strong",[s._v("这是一套基础库，它不会涉及到具体平台中的属性处理，但它预留了配置，供跨平台自调用")]),s._v("。")]),s._v(" "),n("p",[s._v("举例说明，假设 "),n("code",[s._v("template")]),s._v(" 结构如下：")]),s._v(" "),n("div",{staticClass:"language-js line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" template "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('<div\n  class="container"\n  style="color: red"\n  v-if="isShow"\n  :class="className"\n  :style="style"\n  :[dynamic]="dynamic"\n  @click="handleClick"\n  @confirm.stop.prevent="handleConfirm"\n  @[event]="handleEvent"\n  v-model="value"\n  v-html="html"\n>\n  <span>static</span>\n  <span>{{ name }}</span>\n  <span>{{ msg | convert }}</span>\n</div>')]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("那么"),n("strong",[s._v("单独")]),s._v("的 "),n("code",[s._v("compiler")]),s._v(" 解析之后（"),n("strong",[s._v("即 "),n("code",[s._v("baseOptions")]),s._v(" 为空对象时")]),s._v("）会存在如下 "),n("code",[s._v("AST")]),s._v(" 结构:")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/Not-Count-Contribution/img/20241112202428.png",alt:""}})]),s._v(" "),n("p",[n("code",[s._v("Vue")]),s._v(" 在 "),n("code",[s._v("platform")]),s._v(" 中专门划分了 "),n("code",[s._v("web")]),s._v(" 平台，当我们传入 "),n("code",[s._v("web")]),s._v(" 平台定义的编译 "),n("code",[s._v("baseOptions")]),s._v("，执行结果如下：")]),s._v(" "),n("p",[n("img",{attrs:{src:"https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/Not-Count-Contribution/img/20241112202332.png",alt:""}})]),s._v(" "),n("p",[s._v("在此例中对比，可以发现，"),n("code",[s._v("web compiler")]),s._v(" 结果比 "),n("code",[s._v("compiler")]),s._v(" 结果中多了 "),n("code",[s._v("model")]),s._v("、"),n("code",[s._v("staticClass")]),s._v("、"),n("code",[s._v("staticStyle")]),s._v("、"),n("code",[s._v("classBinding")]),s._v(" 以及 "),n("code",[s._v("styleBinding")]),s._v("。")])])}),[],!1,null,null,null);t.default=e.exports}}]);