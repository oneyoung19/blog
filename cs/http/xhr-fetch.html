<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>XHR/Fetch | OneYoung’s Blog</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/blog/favicon.ico">
    <link rel="manifest" href="/blog/manifest.json">
    <script>var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b5edcf6b1a12076f348b1de5dd83a662";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();</script>
    <script>(function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "o1h2x0tjoo");</script>
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-6MCGJRJCR5"></script>
    <script>window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-6MCGJRJCR5');</script>
    <meta name="description" content="个人技术博客">
    <meta name="google" content="notranslate">
    <link rel="preload" href="/blog/assets/css/0.styles.8c114d33.css" as="style"><link rel="preload" href="/blog/assets/js/app.40d5db5e.js" as="script"><link rel="preload" href="/blog/assets/js/2.edfaf709.js" as="script"><link rel="preload" href="/blog/assets/js/192.09f8b6b7.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.a8f58508.js"><link rel="prefetch" href="/blog/assets/js/100.09ef33f0.js"><link rel="prefetch" href="/blog/assets/js/101.c9c706bd.js"><link rel="prefetch" href="/blog/assets/js/102.1c834a78.js"><link rel="prefetch" href="/blog/assets/js/103.82969595.js"><link rel="prefetch" href="/blog/assets/js/104.4d452358.js"><link rel="prefetch" href="/blog/assets/js/105.9a5d0a08.js"><link rel="prefetch" href="/blog/assets/js/106.e318f9fb.js"><link rel="prefetch" href="/blog/assets/js/107.7cc34fee.js"><link rel="prefetch" href="/blog/assets/js/108.56a2a62d.js"><link rel="prefetch" href="/blog/assets/js/109.a5b05578.js"><link rel="prefetch" href="/blog/assets/js/11.f5b4c834.js"><link rel="prefetch" href="/blog/assets/js/110.3636f36b.js"><link rel="prefetch" href="/blog/assets/js/111.dbda85cf.js"><link rel="prefetch" href="/blog/assets/js/112.69bca1aa.js"><link rel="prefetch" href="/blog/assets/js/113.5c834bbc.js"><link rel="prefetch" href="/blog/assets/js/114.3ca010ff.js"><link rel="prefetch" href="/blog/assets/js/115.4b53b592.js"><link rel="prefetch" href="/blog/assets/js/116.5af93ec1.js"><link rel="prefetch" href="/blog/assets/js/117.439ffee0.js"><link rel="prefetch" href="/blog/assets/js/118.7a0dfc89.js"><link rel="prefetch" href="/blog/assets/js/119.6fa91a28.js"><link rel="prefetch" href="/blog/assets/js/12.ccadd3a1.js"><link rel="prefetch" href="/blog/assets/js/120.fc5f3df4.js"><link rel="prefetch" href="/blog/assets/js/121.d635b054.js"><link rel="prefetch" href="/blog/assets/js/122.d776b468.js"><link rel="prefetch" href="/blog/assets/js/123.fc26c721.js"><link rel="prefetch" href="/blog/assets/js/124.5d089cd5.js"><link rel="prefetch" href="/blog/assets/js/125.75d2da5d.js"><link rel="prefetch" href="/blog/assets/js/126.56f2d819.js"><link rel="prefetch" href="/blog/assets/js/127.d9503e8f.js"><link rel="prefetch" href="/blog/assets/js/128.2660e0cc.js"><link rel="prefetch" href="/blog/assets/js/129.adc44dfc.js"><link rel="prefetch" href="/blog/assets/js/13.4bbcd9d5.js"><link rel="prefetch" href="/blog/assets/js/130.359343ef.js"><link rel="prefetch" href="/blog/assets/js/131.185ad528.js"><link rel="prefetch" href="/blog/assets/js/132.dd881ccf.js"><link rel="prefetch" href="/blog/assets/js/133.74fa0cbf.js"><link rel="prefetch" href="/blog/assets/js/134.ccb8946e.js"><link rel="prefetch" href="/blog/assets/js/135.0d394f66.js"><link rel="prefetch" href="/blog/assets/js/136.3fa2d5f6.js"><link rel="prefetch" href="/blog/assets/js/137.1e6273c9.js"><link rel="prefetch" href="/blog/assets/js/138.e3896fdb.js"><link rel="prefetch" href="/blog/assets/js/139.b9df7c76.js"><link rel="prefetch" href="/blog/assets/js/14.2b166264.js"><link rel="prefetch" href="/blog/assets/js/140.6579a397.js"><link rel="prefetch" href="/blog/assets/js/141.e8c7fd2f.js"><link rel="prefetch" href="/blog/assets/js/142.c0582f5e.js"><link rel="prefetch" href="/blog/assets/js/143.bc74b163.js"><link rel="prefetch" href="/blog/assets/js/144.6191729c.js"><link rel="prefetch" href="/blog/assets/js/145.76493d82.js"><link rel="prefetch" href="/blog/assets/js/146.621b5ea5.js"><link rel="prefetch" href="/blog/assets/js/147.860237b9.js"><link rel="prefetch" href="/blog/assets/js/148.e8c85c05.js"><link rel="prefetch" href="/blog/assets/js/149.b014c849.js"><link rel="prefetch" href="/blog/assets/js/15.7735a296.js"><link rel="prefetch" href="/blog/assets/js/150.35023cd1.js"><link rel="prefetch" href="/blog/assets/js/151.898c6d2b.js"><link rel="prefetch" href="/blog/assets/js/152.f873e48d.js"><link rel="prefetch" href="/blog/assets/js/153.ee8ccba6.js"><link rel="prefetch" href="/blog/assets/js/154.8135ce73.js"><link rel="prefetch" href="/blog/assets/js/155.fd04ebbb.js"><link rel="prefetch" href="/blog/assets/js/156.66a2e5e0.js"><link rel="prefetch" href="/blog/assets/js/157.3cd66ba2.js"><link rel="prefetch" href="/blog/assets/js/158.fd8782c4.js"><link rel="prefetch" href="/blog/assets/js/159.12505aca.js"><link rel="prefetch" href="/blog/assets/js/16.ddf63894.js"><link rel="prefetch" href="/blog/assets/js/160.553a9e8b.js"><link rel="prefetch" href="/blog/assets/js/161.f3e1c3d7.js"><link rel="prefetch" href="/blog/assets/js/162.51c7e461.js"><link rel="prefetch" href="/blog/assets/js/163.fd24af29.js"><link rel="prefetch" href="/blog/assets/js/164.372d7d8f.js"><link rel="prefetch" href="/blog/assets/js/165.7e1276f7.js"><link rel="prefetch" href="/blog/assets/js/166.15ebca21.js"><link rel="prefetch" href="/blog/assets/js/167.7c46350b.js"><link rel="prefetch" href="/blog/assets/js/168.ec39caef.js"><link rel="prefetch" href="/blog/assets/js/169.d7e05b76.js"><link rel="prefetch" href="/blog/assets/js/17.d9176423.js"><link rel="prefetch" href="/blog/assets/js/170.cb60ae1f.js"><link rel="prefetch" href="/blog/assets/js/171.2a69a45a.js"><link rel="prefetch" href="/blog/assets/js/172.179634ce.js"><link rel="prefetch" href="/blog/assets/js/173.6c48d5a1.js"><link rel="prefetch" href="/blog/assets/js/174.f39d506c.js"><link rel="prefetch" href="/blog/assets/js/175.538a442a.js"><link rel="prefetch" href="/blog/assets/js/176.d787ca1c.js"><link rel="prefetch" href="/blog/assets/js/177.97becc63.js"><link rel="prefetch" href="/blog/assets/js/178.0e163998.js"><link rel="prefetch" href="/blog/assets/js/179.2908bba9.js"><link rel="prefetch" href="/blog/assets/js/18.e784a2f1.js"><link rel="prefetch" href="/blog/assets/js/180.d0b8068a.js"><link rel="prefetch" href="/blog/assets/js/181.05cd09b3.js"><link rel="prefetch" href="/blog/assets/js/182.805eea69.js"><link rel="prefetch" href="/blog/assets/js/183.4d6cc80c.js"><link rel="prefetch" href="/blog/assets/js/184.c61c148d.js"><link rel="prefetch" href="/blog/assets/js/185.5c6257e3.js"><link rel="prefetch" href="/blog/assets/js/186.fa3f290c.js"><link rel="prefetch" href="/blog/assets/js/187.f148d347.js"><link rel="prefetch" href="/blog/assets/js/188.50226c15.js"><link rel="prefetch" href="/blog/assets/js/189.1496d270.js"><link rel="prefetch" href="/blog/assets/js/19.8deaa09b.js"><link rel="prefetch" href="/blog/assets/js/190.96a6e20b.js"><link rel="prefetch" href="/blog/assets/js/191.ec17d861.js"><link rel="prefetch" href="/blog/assets/js/193.77016887.js"><link rel="prefetch" href="/blog/assets/js/194.8c340614.js"><link rel="prefetch" href="/blog/assets/js/195.eaae6dfa.js"><link rel="prefetch" href="/blog/assets/js/196.da5f2f8a.js"><link rel="prefetch" href="/blog/assets/js/197.15df8b99.js"><link rel="prefetch" href="/blog/assets/js/198.6da2e1c7.js"><link rel="prefetch" href="/blog/assets/js/199.4203d53c.js"><link rel="prefetch" href="/blog/assets/js/20.ef9cbab1.js"><link rel="prefetch" href="/blog/assets/js/200.5fad89fc.js"><link rel="prefetch" href="/blog/assets/js/201.3494e65b.js"><link rel="prefetch" href="/blog/assets/js/202.af7c371e.js"><link rel="prefetch" href="/blog/assets/js/203.1b7e66a1.js"><link rel="prefetch" href="/blog/assets/js/204.e61dc0eb.js"><link rel="prefetch" href="/blog/assets/js/205.e2eee0cf.js"><link rel="prefetch" href="/blog/assets/js/206.94cc957a.js"><link rel="prefetch" href="/blog/assets/js/207.97649e91.js"><link rel="prefetch" href="/blog/assets/js/208.d9fd4fd0.js"><link rel="prefetch" href="/blog/assets/js/209.2784d044.js"><link rel="prefetch" href="/blog/assets/js/21.4c36c09d.js"><link rel="prefetch" href="/blog/assets/js/210.90668382.js"><link rel="prefetch" href="/blog/assets/js/211.0557ff23.js"><link rel="prefetch" href="/blog/assets/js/212.aaf5fb9b.js"><link rel="prefetch" href="/blog/assets/js/213.b7b6d5fe.js"><link rel="prefetch" href="/blog/assets/js/214.920b267f.js"><link rel="prefetch" href="/blog/assets/js/215.c9350ef4.js"><link rel="prefetch" href="/blog/assets/js/216.1f51c46c.js"><link rel="prefetch" href="/blog/assets/js/217.2b5211aa.js"><link rel="prefetch" href="/blog/assets/js/218.3db344d6.js"><link rel="prefetch" href="/blog/assets/js/219.b782a04c.js"><link rel="prefetch" href="/blog/assets/js/22.ef54aad7.js"><link rel="prefetch" href="/blog/assets/js/220.50bed8cf.js"><link rel="prefetch" href="/blog/assets/js/221.6ed21261.js"><link rel="prefetch" href="/blog/assets/js/222.ae0cc542.js"><link rel="prefetch" href="/blog/assets/js/223.a5ad7069.js"><link rel="prefetch" href="/blog/assets/js/224.bcea4ff3.js"><link rel="prefetch" href="/blog/assets/js/225.c861b2a9.js"><link rel="prefetch" href="/blog/assets/js/226.46b373cc.js"><link rel="prefetch" href="/blog/assets/js/227.c09fefd8.js"><link rel="prefetch" href="/blog/assets/js/228.9218a891.js"><link rel="prefetch" href="/blog/assets/js/229.3523e6ed.js"><link rel="prefetch" href="/blog/assets/js/23.3ba46e2d.js"><link rel="prefetch" href="/blog/assets/js/230.013bbcad.js"><link rel="prefetch" href="/blog/assets/js/231.1c3224cc.js"><link rel="prefetch" href="/blog/assets/js/232.07397341.js"><link rel="prefetch" href="/blog/assets/js/233.22b182be.js"><link rel="prefetch" href="/blog/assets/js/234.3775af77.js"><link rel="prefetch" href="/blog/assets/js/235.06d92601.js"><link rel="prefetch" href="/blog/assets/js/236.75db8880.js"><link rel="prefetch" href="/blog/assets/js/237.6b9656fa.js"><link rel="prefetch" href="/blog/assets/js/238.dcd53ba3.js"><link rel="prefetch" href="/blog/assets/js/239.e58a7f3f.js"><link rel="prefetch" href="/blog/assets/js/24.6cda7501.js"><link rel="prefetch" href="/blog/assets/js/240.f0718d25.js"><link rel="prefetch" href="/blog/assets/js/241.f67e5bbf.js"><link rel="prefetch" href="/blog/assets/js/242.f43243d9.js"><link rel="prefetch" href="/blog/assets/js/243.76501ab6.js"><link rel="prefetch" href="/blog/assets/js/244.ddcbc2ad.js"><link rel="prefetch" href="/blog/assets/js/245.19d9efd5.js"><link rel="prefetch" href="/blog/assets/js/246.46fd9aa8.js"><link rel="prefetch" href="/blog/assets/js/247.5e447bc9.js"><link rel="prefetch" href="/blog/assets/js/248.7074cc24.js"><link rel="prefetch" href="/blog/assets/js/249.9b707cb4.js"><link rel="prefetch" href="/blog/assets/js/25.b72b34fd.js"><link rel="prefetch" href="/blog/assets/js/250.5b5df9a1.js"><link rel="prefetch" href="/blog/assets/js/251.a5cf8ee6.js"><link rel="prefetch" href="/blog/assets/js/252.d791df39.js"><link rel="prefetch" href="/blog/assets/js/253.c7bebde3.js"><link rel="prefetch" href="/blog/assets/js/254.df366cdd.js"><link rel="prefetch" href="/blog/assets/js/255.cb9bdd6c.js"><link rel="prefetch" href="/blog/assets/js/256.b1dc4614.js"><link rel="prefetch" href="/blog/assets/js/257.1abffcfa.js"><link rel="prefetch" href="/blog/assets/js/258.0365f4df.js"><link rel="prefetch" href="/blog/assets/js/259.8e871cff.js"><link rel="prefetch" href="/blog/assets/js/26.743f6e0d.js"><link rel="prefetch" href="/blog/assets/js/260.da827a1e.js"><link rel="prefetch" href="/blog/assets/js/261.8d874dfa.js"><link rel="prefetch" href="/blog/assets/js/262.92f2c1d9.js"><link rel="prefetch" href="/blog/assets/js/263.b7240c1c.js"><link rel="prefetch" href="/blog/assets/js/264.4cef8c46.js"><link rel="prefetch" href="/blog/assets/js/265.e2da6bcd.js"><link rel="prefetch" href="/blog/assets/js/266.8c816de5.js"><link rel="prefetch" href="/blog/assets/js/267.e31101a7.js"><link rel="prefetch" href="/blog/assets/js/268.a6790afe.js"><link rel="prefetch" href="/blog/assets/js/269.3158de51.js"><link rel="prefetch" href="/blog/assets/js/27.9f782b13.js"><link rel="prefetch" href="/blog/assets/js/270.ae5f4980.js"><link rel="prefetch" href="/blog/assets/js/271.362ebe7f.js"><link rel="prefetch" href="/blog/assets/js/272.43c76c4f.js"><link rel="prefetch" href="/blog/assets/js/273.e756db51.js"><link rel="prefetch" href="/blog/assets/js/274.96251059.js"><link rel="prefetch" href="/blog/assets/js/275.477069ff.js"><link rel="prefetch" href="/blog/assets/js/276.05997073.js"><link rel="prefetch" href="/blog/assets/js/277.7fefbe23.js"><link rel="prefetch" href="/blog/assets/js/278.1394cd0c.js"><link rel="prefetch" href="/blog/assets/js/279.a8932727.js"><link rel="prefetch" href="/blog/assets/js/28.b89ef886.js"><link rel="prefetch" href="/blog/assets/js/280.52a89918.js"><link rel="prefetch" href="/blog/assets/js/281.d5bd9e65.js"><link rel="prefetch" href="/blog/assets/js/282.5bf8befd.js"><link rel="prefetch" href="/blog/assets/js/283.fec9e16a.js"><link rel="prefetch" href="/blog/assets/js/284.b338220d.js"><link rel="prefetch" href="/blog/assets/js/285.c02c42ba.js"><link rel="prefetch" href="/blog/assets/js/286.4aca9991.js"><link rel="prefetch" href="/blog/assets/js/287.8da07fb9.js"><link rel="prefetch" href="/blog/assets/js/288.4623ba81.js"><link rel="prefetch" href="/blog/assets/js/289.742a4b47.js"><link rel="prefetch" href="/blog/assets/js/29.7b7da4d5.js"><link rel="prefetch" href="/blog/assets/js/290.8cbe0a5a.js"><link rel="prefetch" href="/blog/assets/js/291.1ff96156.js"><link rel="prefetch" href="/blog/assets/js/292.ac48d376.js"><link rel="prefetch" href="/blog/assets/js/293.d6379846.js"><link rel="prefetch" href="/blog/assets/js/294.9a87770e.js"><link rel="prefetch" href="/blog/assets/js/295.9e690035.js"><link rel="prefetch" href="/blog/assets/js/296.32303ab0.js"><link rel="prefetch" href="/blog/assets/js/297.7a9ceaf5.js"><link rel="prefetch" href="/blog/assets/js/298.28a34739.js"><link rel="prefetch" href="/blog/assets/js/299.85f03c0a.js"><link rel="prefetch" href="/blog/assets/js/3.268e2d35.js"><link rel="prefetch" href="/blog/assets/js/30.128baafb.js"><link rel="prefetch" href="/blog/assets/js/300.dace87b0.js"><link rel="prefetch" href="/blog/assets/js/301.eb0a3d9e.js"><link rel="prefetch" href="/blog/assets/js/302.0b0b4264.js"><link rel="prefetch" href="/blog/assets/js/303.7cccbdff.js"><link rel="prefetch" href="/blog/assets/js/304.3255b68b.js"><link rel="prefetch" href="/blog/assets/js/305.b52c89a3.js"><link rel="prefetch" href="/blog/assets/js/306.686be4b6.js"><link rel="prefetch" href="/blog/assets/js/307.0340a6dc.js"><link rel="prefetch" href="/blog/assets/js/308.70dad614.js"><link rel="prefetch" href="/blog/assets/js/309.685d35c4.js"><link rel="prefetch" href="/blog/assets/js/31.47d892af.js"><link rel="prefetch" href="/blog/assets/js/310.6ef31ecd.js"><link rel="prefetch" href="/blog/assets/js/311.bb8bd6de.js"><link rel="prefetch" href="/blog/assets/js/312.dae0bee3.js"><link rel="prefetch" href="/blog/assets/js/313.560ac826.js"><link rel="prefetch" href="/blog/assets/js/314.a733fd9e.js"><link rel="prefetch" href="/blog/assets/js/315.3b030081.js"><link rel="prefetch" href="/blog/assets/js/316.9c5a0e25.js"><link rel="prefetch" href="/blog/assets/js/317.e35c456c.js"><link rel="prefetch" href="/blog/assets/js/318.d9795b7a.js"><link rel="prefetch" href="/blog/assets/js/319.0a58ff1e.js"><link rel="prefetch" href="/blog/assets/js/32.6cd941c0.js"><link rel="prefetch" href="/blog/assets/js/320.9332cd57.js"><link rel="prefetch" href="/blog/assets/js/321.05ae6037.js"><link rel="prefetch" href="/blog/assets/js/322.74b5913b.js"><link rel="prefetch" href="/blog/assets/js/323.76d3ab8b.js"><link rel="prefetch" href="/blog/assets/js/324.4be06780.js"><link rel="prefetch" href="/blog/assets/js/325.191f4b8f.js"><link rel="prefetch" href="/blog/assets/js/326.54b7ca0a.js"><link rel="prefetch" href="/blog/assets/js/327.fc3a5cc6.js"><link rel="prefetch" href="/blog/assets/js/328.db5a4a60.js"><link rel="prefetch" href="/blog/assets/js/329.cbdf4fa8.js"><link rel="prefetch" href="/blog/assets/js/33.ba05070b.js"><link rel="prefetch" href="/blog/assets/js/330.2eff20ee.js"><link rel="prefetch" href="/blog/assets/js/331.c09221cf.js"><link rel="prefetch" href="/blog/assets/js/332.efdcfb29.js"><link rel="prefetch" href="/blog/assets/js/333.410949ec.js"><link rel="prefetch" href="/blog/assets/js/334.4878e340.js"><link rel="prefetch" href="/blog/assets/js/335.f8e45f37.js"><link rel="prefetch" href="/blog/assets/js/336.56cb20d5.js"><link rel="prefetch" href="/blog/assets/js/337.c4516109.js"><link rel="prefetch" href="/blog/assets/js/338.5332e436.js"><link rel="prefetch" href="/blog/assets/js/339.9f269bed.js"><link rel="prefetch" href="/blog/assets/js/34.4d3fd3e2.js"><link rel="prefetch" href="/blog/assets/js/340.ed345e3d.js"><link rel="prefetch" href="/blog/assets/js/341.31620371.js"><link rel="prefetch" href="/blog/assets/js/342.5bd4fca2.js"><link rel="prefetch" href="/blog/assets/js/343.bcd06011.js"><link rel="prefetch" href="/blog/assets/js/344.b7474758.js"><link rel="prefetch" href="/blog/assets/js/345.7788ab66.js"><link rel="prefetch" href="/blog/assets/js/346.705f2825.js"><link rel="prefetch" href="/blog/assets/js/347.3b6ffd67.js"><link rel="prefetch" href="/blog/assets/js/348.d528d212.js"><link rel="prefetch" href="/blog/assets/js/349.f16b94ec.js"><link rel="prefetch" href="/blog/assets/js/35.86adc8d1.js"><link rel="prefetch" href="/blog/assets/js/350.923e0bb6.js"><link rel="prefetch" href="/blog/assets/js/351.87205ba3.js"><link rel="prefetch" href="/blog/assets/js/352.c125c379.js"><link rel="prefetch" href="/blog/assets/js/353.6280ed6c.js"><link rel="prefetch" href="/blog/assets/js/354.88a31ec4.js"><link rel="prefetch" href="/blog/assets/js/355.af2b0aaf.js"><link rel="prefetch" href="/blog/assets/js/356.3376dd09.js"><link rel="prefetch" href="/blog/assets/js/357.2f811ec4.js"><link rel="prefetch" href="/blog/assets/js/358.fc941424.js"><link rel="prefetch" href="/blog/assets/js/359.99ef3151.js"><link rel="prefetch" href="/blog/assets/js/36.93a898f3.js"><link rel="prefetch" href="/blog/assets/js/360.d16ed802.js"><link rel="prefetch" href="/blog/assets/js/361.ace01015.js"><link rel="prefetch" href="/blog/assets/js/362.aefc6604.js"><link rel="prefetch" href="/blog/assets/js/363.96a4b3ea.js"><link rel="prefetch" href="/blog/assets/js/364.5697442f.js"><link rel="prefetch" href="/blog/assets/js/365.0ed81823.js"><link rel="prefetch" href="/blog/assets/js/366.e6e35fb2.js"><link rel="prefetch" href="/blog/assets/js/367.d7687178.js"><link rel="prefetch" href="/blog/assets/js/368.51bd3df2.js"><link rel="prefetch" href="/blog/assets/js/369.278e64d2.js"><link rel="prefetch" href="/blog/assets/js/37.d66d1f74.js"><link rel="prefetch" href="/blog/assets/js/370.53decf78.js"><link rel="prefetch" href="/blog/assets/js/371.95aff636.js"><link rel="prefetch" href="/blog/assets/js/372.2ae33109.js"><link rel="prefetch" href="/blog/assets/js/373.72ac1ae9.js"><link rel="prefetch" href="/blog/assets/js/374.6451a341.js"><link rel="prefetch" href="/blog/assets/js/375.a1dfbe9d.js"><link rel="prefetch" href="/blog/assets/js/376.aff436b7.js"><link rel="prefetch" href="/blog/assets/js/377.4e20df79.js"><link rel="prefetch" href="/blog/assets/js/378.594a9e75.js"><link rel="prefetch" href="/blog/assets/js/379.f7bbff9e.js"><link rel="prefetch" href="/blog/assets/js/38.cd0af5c4.js"><link rel="prefetch" href="/blog/assets/js/380.0b9f7b35.js"><link rel="prefetch" href="/blog/assets/js/381.2f99927c.js"><link rel="prefetch" href="/blog/assets/js/382.af50b999.js"><link rel="prefetch" href="/blog/assets/js/383.fe5d4e58.js"><link rel="prefetch" href="/blog/assets/js/384.7f91ab26.js"><link rel="prefetch" href="/blog/assets/js/385.0c2906e1.js"><link rel="prefetch" href="/blog/assets/js/386.57cd887c.js"><link rel="prefetch" href="/blog/assets/js/387.d8d28747.js"><link rel="prefetch" href="/blog/assets/js/388.20d62be7.js"><link rel="prefetch" href="/blog/assets/js/389.4522385b.js"><link rel="prefetch" href="/blog/assets/js/39.76f83000.js"><link rel="prefetch" href="/blog/assets/js/390.d6a43abb.js"><link rel="prefetch" href="/blog/assets/js/391.101e2729.js"><link rel="prefetch" href="/blog/assets/js/392.3607314c.js"><link rel="prefetch" href="/blog/assets/js/393.6b14fc76.js"><link rel="prefetch" href="/blog/assets/js/394.e6c2c4e8.js"><link rel="prefetch" href="/blog/assets/js/395.05c2776d.js"><link rel="prefetch" href="/blog/assets/js/396.20037c0d.js"><link rel="prefetch" href="/blog/assets/js/397.e2bbfe1b.js"><link rel="prefetch" href="/blog/assets/js/398.6caeee0a.js"><link rel="prefetch" href="/blog/assets/js/399.46e35a1b.js"><link rel="prefetch" href="/blog/assets/js/4.0fa13acc.js"><link rel="prefetch" href="/blog/assets/js/40.5851ec1b.js"><link rel="prefetch" href="/blog/assets/js/400.80a92f63.js"><link rel="prefetch" href="/blog/assets/js/401.32a2d616.js"><link rel="prefetch" href="/blog/assets/js/402.b0439fd6.js"><link rel="prefetch" href="/blog/assets/js/403.79e339cc.js"><link rel="prefetch" href="/blog/assets/js/41.4d388ee3.js"><link rel="prefetch" href="/blog/assets/js/42.a9eb12bb.js"><link rel="prefetch" href="/blog/assets/js/43.e6dbc7b9.js"><link rel="prefetch" href="/blog/assets/js/44.365c3fa6.js"><link rel="prefetch" href="/blog/assets/js/45.33ecb5ed.js"><link rel="prefetch" href="/blog/assets/js/46.c284dbbb.js"><link rel="prefetch" href="/blog/assets/js/47.8455033c.js"><link rel="prefetch" href="/blog/assets/js/48.c6e58050.js"><link rel="prefetch" href="/blog/assets/js/49.34bd7fc4.js"><link rel="prefetch" href="/blog/assets/js/5.942d7979.js"><link rel="prefetch" href="/blog/assets/js/50.d4c7e3e4.js"><link rel="prefetch" href="/blog/assets/js/51.037ac0b8.js"><link rel="prefetch" href="/blog/assets/js/52.8d744083.js"><link rel="prefetch" href="/blog/assets/js/53.e2e83e6f.js"><link rel="prefetch" href="/blog/assets/js/54.745cae84.js"><link rel="prefetch" href="/blog/assets/js/55.8c6b7f35.js"><link rel="prefetch" href="/blog/assets/js/56.ee7817c0.js"><link rel="prefetch" href="/blog/assets/js/57.673d918a.js"><link rel="prefetch" href="/blog/assets/js/58.f41582d3.js"><link rel="prefetch" href="/blog/assets/js/59.ac1261ad.js"><link rel="prefetch" href="/blog/assets/js/6.3b7f4ce5.js"><link rel="prefetch" href="/blog/assets/js/60.6c27c0a6.js"><link rel="prefetch" href="/blog/assets/js/61.c449862b.js"><link rel="prefetch" href="/blog/assets/js/62.8a1be7f3.js"><link rel="prefetch" href="/blog/assets/js/63.38066571.js"><link rel="prefetch" href="/blog/assets/js/64.1d082870.js"><link rel="prefetch" href="/blog/assets/js/65.9a788cb8.js"><link rel="prefetch" href="/blog/assets/js/66.c60b162f.js"><link rel="prefetch" href="/blog/assets/js/67.c8250c37.js"><link rel="prefetch" href="/blog/assets/js/68.601673e7.js"><link rel="prefetch" href="/blog/assets/js/69.0d09cab2.js"><link rel="prefetch" href="/blog/assets/js/7.9dfafb08.js"><link rel="prefetch" href="/blog/assets/js/70.f91ac3ff.js"><link rel="prefetch" href="/blog/assets/js/71.4fdc305d.js"><link rel="prefetch" href="/blog/assets/js/72.e38f183d.js"><link rel="prefetch" href="/blog/assets/js/73.c6324f97.js"><link rel="prefetch" href="/blog/assets/js/74.1434de66.js"><link rel="prefetch" href="/blog/assets/js/75.7dcf369c.js"><link rel="prefetch" href="/blog/assets/js/76.468e3be5.js"><link rel="prefetch" href="/blog/assets/js/77.09fb85c4.js"><link rel="prefetch" href="/blog/assets/js/78.38060f10.js"><link rel="prefetch" href="/blog/assets/js/79.1b213966.js"><link rel="prefetch" href="/blog/assets/js/8.c22f62c3.js"><link rel="prefetch" href="/blog/assets/js/80.9c0a25a4.js"><link rel="prefetch" href="/blog/assets/js/81.faab535e.js"><link rel="prefetch" href="/blog/assets/js/82.351ad640.js"><link rel="prefetch" href="/blog/assets/js/83.2d276a43.js"><link rel="prefetch" href="/blog/assets/js/84.d588aecb.js"><link rel="prefetch" href="/blog/assets/js/85.fc42e58b.js"><link rel="prefetch" href="/blog/assets/js/86.27841bb9.js"><link rel="prefetch" href="/blog/assets/js/87.229709e6.js"><link rel="prefetch" href="/blog/assets/js/88.fdbae63d.js"><link rel="prefetch" href="/blog/assets/js/89.c8fcacec.js"><link rel="prefetch" href="/blog/assets/js/9.e3a31bfc.js"><link rel="prefetch" href="/blog/assets/js/90.6bb29bef.js"><link rel="prefetch" href="/blog/assets/js/91.54e46486.js"><link rel="prefetch" href="/blog/assets/js/92.872d3542.js"><link rel="prefetch" href="/blog/assets/js/93.411f50de.js"><link rel="prefetch" href="/blog/assets/js/94.fc5a355f.js"><link rel="prefetch" href="/blog/assets/js/95.fe7b8ff9.js"><link rel="prefetch" href="/blog/assets/js/96.5708d18c.js"><link rel="prefetch" href="/blog/assets/js/97.e05302c6.js"><link rel="prefetch" href="/blog/assets/js/98.19e7faf7.js"><link rel="prefetch" href="/blog/assets/js/99.a11b6711.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.8c114d33.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">OneYoung’s Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Basic
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/FE/html/" class="nav-link">
  HTML
</a></li></ul></li><li class="dropdown-item"><h4>
          Feature
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/FE/html5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-subitem"><a href="/blog/FE/css3/1.start.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-subitem"><a href="/blog/FE/worker/1.WebWorker.html" class="nav-link">
  Worker
</a></li><li class="dropdown-subitem"><a href="/blog/FE/PWA/" class="nav-link">
  PWA
</a></li><li class="dropdown-subitem"><a href="/blog/FE/rendering/1.start.html" class="nav-link">
  Rendering
</a></li></ul></li><li class="dropdown-item"><h4>
          JavaScript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/FE/javascript/BOM/1.start.html" class="nav-link">
  BOM
</a></li><li class="dropdown-subitem"><a href="/blog/FE/javascript/DOM/1.start.html" class="nav-link">
  DOM
</a></li><li class="dropdown-subitem"><a href="/blog/FE/javascript/ECMAScript/1.start.html" class="nav-link">
  ECMAScript
</a></li></ul></li><li class="dropdown-item"><h4>
          JS进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/FE/js-advance/es6/" class="nav-link">
  ES6
</a></li><li class="dropdown-subitem"><a href="/blog/FE/js-advance/module/1.start.html" class="nav-link">
  Module
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架及库" class="dropdown-title"><span class="title">框架及库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Axios
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/axios/base/1.install.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-subitem"><a href="/blog/frame/axios/source-code/1.start.html" class="nav-link">
  源码解析
</a></li></ul></li><li class="dropdown-item"><h4>
          Vue2
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/vue2/base/1.start.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-subitem"><a href="/blog/frame/vue2/source-code/compiler/" class="nav-link">
  compiler
</a></li></ul></li><li class="dropdown-item"><h4>
          Nuxt
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/nuxt/base/1.start.html" class="nav-link">
  基础使用
</a></li></ul></li><li class="dropdown-item"><h4>
          Express
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/express/base/1.start.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-subitem"><a href="/blog/frame/express/source-code/1.start.html" class="nav-link">
  源码解析
</a></li></ul></li><li class="dropdown-item"><h4>
          Koa
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/koa/base/1.start.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-subitem"><a href="/blog/frame/koa/source-code/1.start.html" class="nav-link">
  源码解析
</a></li></ul></li><li class="dropdown-item"><h4>
          CryptoJs
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/crypto-js/base/1.start.html" class="nav-link">
  基础使用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学" class="dropdown-title"><span class="title">计算机科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/cs/string/1.unicode.html" class="nav-link">
  String
</a></li><li class="dropdown-item"><!----> <a href="/blog/cs/digit/1.start.html" class="nav-link">
  Digit
</a></li><li class="dropdown-item"><!----> <a href="/blog/cs/binary-file/1.start.html" class="nav-link">
  二进制数据与文件
</a></li><li class="dropdown-item"><h4>
          HTTP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/cs/http/communication.html" class="nav-link">
  通信过程
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/url.html" class="nav-link">
  URL
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/formdata.html" class="nav-link">
  FormData
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/xhr-fetch.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  XHR/Fetch
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/cors.html" class="nav-link">
  CORS
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/cookie.html" class="nav-link">
  Cookie
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/security.html" class="nav-link">
  网络安全
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/upload.html" class="nav-link">
  文件上传
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/download.html" class="nav-link">
  文件下载
</a></li></ul></li><li class="dropdown-item"><h4>
          HTTPS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/cs/https/encryption.html" class="nav-link">
  数据安全
</a></li><li class="dropdown-subitem"><a href="/blog/cs/https/tls&amp;ssl.html" class="nav-link">
  TLS与SSL
</a></li><li class="dropdown-subitem"><a href="/blog/cs/https/setup.html" class="nav-link">
  项目配置SSL
</a></li></ul></li><li class="dropdown-item"><h4>
          高级
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/cs/advance/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-subitem"><a href="/blog/cs/advance/data-structures/" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/blog/cs/advance/algorithm/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          IM
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/cs/im/sse/" class="nav-link">
  SSE
</a></li><li class="dropdown-subitem"><a href="/blog/cs/im/websocket/" class="nav-link">
  Websocket
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="跨平台" class="dropdown-title"><span class="title">跨平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/cross/h5/" class="nav-link">
  H5
</a></li><li class="dropdown-item"><!----> <a href="/blog/cross/weChat-public/1.authorization.html" class="nav-link">
  微信公众号
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/engineer/git/1.start.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/engineer/ts/1.start.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><h4>
          Package Manager
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/pkg-manager/npm/1.start.html" class="nav-link">
  NPM
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/pkg-manager/yarn/1.start.html" class="nav-link">
  Yarn
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/pkg-manager/pnpm/1.start.html" class="nav-link">
  PNPM
</a></li></ul></li><li class="dropdown-item"><h4>
          MonoRepo
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/mono-repo/workspace/1.start.html" class="nav-link">
  Workspace
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/mono-repo/lerna/1.start.html" class="nav-link">
  Lerna
</a></li></ul></li><li class="dropdown-item"><h4>
          Assist
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/babel/1.start.html" class="nav-link">
  Babel
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/postcss/1.start.html" class="nav-link">
  Postcss
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/eslint/1.start.html" class="nav-link">
  Eslint
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/prettier/1.start.html" class="nav-link">
  Prettier
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/husky/" class="nav-link">
  Husky
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/commitlint/" class="nav-link">
  CommitLint
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/conventional-changelog/" class="nav-link">
  Conventional Changelog
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/standard-version/" class="nav-link">
  Standard Version
</a></li></ul></li><li class="dropdown-item"><h4>
          Bundler
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/gulp/1.start.html" class="nav-link">
  Gulp
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/rollup/1.introduction.html" class="nav-link">
  Rollup
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/webpack/1.start.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/vite/" class="nav-link">
  Vite
</a></li></ul></li><li class="dropdown-item"><h4>
          Misc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/misc/obfuscator/" class="nav-link">
  Debugger &amp; Obfuscator
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/BE/standard/" class="nav-link">
  Standard
</a></li><li class="dropdown-item"><h4>
          认证与授权
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/BE/authentication/jwt/" class="nav-link">
  JWT
</a></li><li class="dropdown-subitem"><a href="/blog/BE/authentication/oauth2/" class="nav-link">
  OAuth2.0
</a></li><li class="dropdown-subitem"><a href="/blog/BE/authentication/2fa/" class="nav-link">
  2FA
</a></li></ul></li><li class="dropdown-item"><h4>
          SSR
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/BE/ssr/ssr-vue2/" class="nav-link">
  SSR Vue2
</a></li><li class="dropdown-subitem"><a href="/blog/BE/ssr/ssg-vue2/" class="nav-link">
  SSG Vue2
</a></li></ul></li><li class="dropdown-item"><h4>
          Node
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/BE/node/awesome/" class="nav-link">
  Awesome
</a></li><li class="dropdown-subitem"><a href="/blog/BE/node/docs/" class="nav-link">
  Docs
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/DB/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/blog/DB/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/blog/DB/oracle/" class="nav-link">
  Oracle
</a></li><li class="dropdown-item"><!----> <a href="/blog/DB/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/blog/DB/mongodb/" class="nav-link">
  Mongodb
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="部署" class="dropdown-title"><span class="title">部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/deploy/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/shell/1.start.html" class="nav-link">
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/CI-CD/1.start.html" class="nav-link">
  CI/CD
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/jenkins/1.start.html" class="nav-link">
  Jenkins
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/tool/github/" class="nav-link">
  GitHub
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/chrome/" class="nav-link">
  Chrome
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/charles/" class="nav-link">
  Charles
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/verdaccio/" class="nav-link">
  Verdaccio
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/remote-ssh/" class="nav-link">
  Remote-SSH
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/localtunnel/" class="nav-link">
  Localtunnel
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/AI/" class="nav-link">
  AI工具
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/oneyoung19" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端基础" class="dropdown-title"><span class="title">前端基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Basic
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/FE/html/" class="nav-link">
  HTML
</a></li></ul></li><li class="dropdown-item"><h4>
          Feature
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/FE/html5/" class="nav-link">
  HTML5
</a></li><li class="dropdown-subitem"><a href="/blog/FE/css3/1.start.html" class="nav-link">
  CSS3
</a></li><li class="dropdown-subitem"><a href="/blog/FE/worker/1.WebWorker.html" class="nav-link">
  Worker
</a></li><li class="dropdown-subitem"><a href="/blog/FE/PWA/" class="nav-link">
  PWA
</a></li><li class="dropdown-subitem"><a href="/blog/FE/rendering/1.start.html" class="nav-link">
  Rendering
</a></li></ul></li><li class="dropdown-item"><h4>
          JavaScript
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/FE/javascript/BOM/1.start.html" class="nav-link">
  BOM
</a></li><li class="dropdown-subitem"><a href="/blog/FE/javascript/DOM/1.start.html" class="nav-link">
  DOM
</a></li><li class="dropdown-subitem"><a href="/blog/FE/javascript/ECMAScript/1.start.html" class="nav-link">
  ECMAScript
</a></li></ul></li><li class="dropdown-item"><h4>
          JS进阶
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/FE/js-advance/es6/" class="nav-link">
  ES6
</a></li><li class="dropdown-subitem"><a href="/blog/FE/js-advance/module/1.start.html" class="nav-link">
  Module
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="框架及库" class="dropdown-title"><span class="title">框架及库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          Axios
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/axios/base/1.install.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-subitem"><a href="/blog/frame/axios/source-code/1.start.html" class="nav-link">
  源码解析
</a></li></ul></li><li class="dropdown-item"><h4>
          Vue2
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/vue2/base/1.start.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-subitem"><a href="/blog/frame/vue2/source-code/compiler/" class="nav-link">
  compiler
</a></li></ul></li><li class="dropdown-item"><h4>
          Nuxt
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/nuxt/base/1.start.html" class="nav-link">
  基础使用
</a></li></ul></li><li class="dropdown-item"><h4>
          Express
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/express/base/1.start.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-subitem"><a href="/blog/frame/express/source-code/1.start.html" class="nav-link">
  源码解析
</a></li></ul></li><li class="dropdown-item"><h4>
          Koa
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/koa/base/1.start.html" class="nav-link">
  基础使用
</a></li><li class="dropdown-subitem"><a href="/blog/frame/koa/source-code/1.start.html" class="nav-link">
  源码解析
</a></li></ul></li><li class="dropdown-item"><h4>
          CryptoJs
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/frame/crypto-js/base/1.start.html" class="nav-link">
  基础使用
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机科学" class="dropdown-title"><span class="title">计算机科学</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/cs/string/1.unicode.html" class="nav-link">
  String
</a></li><li class="dropdown-item"><!----> <a href="/blog/cs/digit/1.start.html" class="nav-link">
  Digit
</a></li><li class="dropdown-item"><!----> <a href="/blog/cs/binary-file/1.start.html" class="nav-link">
  二进制数据与文件
</a></li><li class="dropdown-item"><h4>
          HTTP
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/cs/http/communication.html" class="nav-link">
  通信过程
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/url.html" class="nav-link">
  URL
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/formdata.html" class="nav-link">
  FormData
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/xhr-fetch.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  XHR/Fetch
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/cors.html" class="nav-link">
  CORS
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/cookie.html" class="nav-link">
  Cookie
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/security.html" class="nav-link">
  网络安全
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/upload.html" class="nav-link">
  文件上传
</a></li><li class="dropdown-subitem"><a href="/blog/cs/http/download.html" class="nav-link">
  文件下载
</a></li></ul></li><li class="dropdown-item"><h4>
          HTTPS
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/cs/https/encryption.html" class="nav-link">
  数据安全
</a></li><li class="dropdown-subitem"><a href="/blog/cs/https/tls&amp;ssl.html" class="nav-link">
  TLS与SSL
</a></li><li class="dropdown-subitem"><a href="/blog/cs/https/setup.html" class="nav-link">
  项目配置SSL
</a></li></ul></li><li class="dropdown-item"><h4>
          高级
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/cs/advance/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-subitem"><a href="/blog/cs/advance/data-structures/" class="nav-link">
  数据结构
</a></li><li class="dropdown-subitem"><a href="/blog/cs/advance/algorithm/" class="nav-link">
  算法
</a></li></ul></li><li class="dropdown-item"><h4>
          IM
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/cs/im/sse/" class="nav-link">
  SSE
</a></li><li class="dropdown-subitem"><a href="/blog/cs/im/websocket/" class="nav-link">
  Websocket
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="跨平台" class="dropdown-title"><span class="title">跨平台</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/cross/h5/" class="nav-link">
  H5
</a></li><li class="dropdown-item"><!----> <a href="/blog/cross/weChat-public/1.authorization.html" class="nav-link">
  微信公众号
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title">工程化</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/engineer/git/1.start.html" class="nav-link">
  Git
</a></li><li class="dropdown-item"><!----> <a href="/blog/engineer/ts/1.start.html" class="nav-link">
  TypeScript
</a></li><li class="dropdown-item"><h4>
          Package Manager
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/pkg-manager/npm/1.start.html" class="nav-link">
  NPM
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/pkg-manager/yarn/1.start.html" class="nav-link">
  Yarn
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/pkg-manager/pnpm/1.start.html" class="nav-link">
  PNPM
</a></li></ul></li><li class="dropdown-item"><h4>
          MonoRepo
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/mono-repo/workspace/1.start.html" class="nav-link">
  Workspace
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/mono-repo/lerna/1.start.html" class="nav-link">
  Lerna
</a></li></ul></li><li class="dropdown-item"><h4>
          Assist
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/babel/1.start.html" class="nav-link">
  Babel
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/postcss/1.start.html" class="nav-link">
  Postcss
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/eslint/1.start.html" class="nav-link">
  Eslint
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/prettier/1.start.html" class="nav-link">
  Prettier
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/husky/" class="nav-link">
  Husky
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/commitlint/" class="nav-link">
  CommitLint
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/conventional-changelog/" class="nav-link">
  Conventional Changelog
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/standard-version/" class="nav-link">
  Standard Version
</a></li></ul></li><li class="dropdown-item"><h4>
          Bundler
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/gulp/1.start.html" class="nav-link">
  Gulp
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/rollup/1.introduction.html" class="nav-link">
  Rollup
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/webpack/1.start.html" class="nav-link">
  Webpack
</a></li><li class="dropdown-subitem"><a href="/blog/engineer/vite/" class="nav-link">
  Vite
</a></li></ul></li><li class="dropdown-item"><h4>
          Misc
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/engineer/misc/obfuscator/" class="nav-link">
  Debugger &amp; Obfuscator
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/BE/standard/" class="nav-link">
  Standard
</a></li><li class="dropdown-item"><h4>
          认证与授权
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/BE/authentication/jwt/" class="nav-link">
  JWT
</a></li><li class="dropdown-subitem"><a href="/blog/BE/authentication/oauth2/" class="nav-link">
  OAuth2.0
</a></li><li class="dropdown-subitem"><a href="/blog/BE/authentication/2fa/" class="nav-link">
  2FA
</a></li></ul></li><li class="dropdown-item"><h4>
          SSR
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/BE/ssr/ssr-vue2/" class="nav-link">
  SSR Vue2
</a></li><li class="dropdown-subitem"><a href="/blog/BE/ssr/ssg-vue2/" class="nav-link">
  SSG Vue2
</a></li></ul></li><li class="dropdown-item"><h4>
          Node
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/blog/BE/node/awesome/" class="nav-link">
  Awesome
</a></li><li class="dropdown-subitem"><a href="/blog/BE/node/docs/" class="nav-link">
  Docs
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/DB/sql/" class="nav-link">
  SQL
</a></li><li class="dropdown-item"><!----> <a href="/blog/DB/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/blog/DB/oracle/" class="nav-link">
  Oracle
</a></li><li class="dropdown-item"><!----> <a href="/blog/DB/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/blog/DB/mongodb/" class="nav-link">
  Mongodb
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="部署" class="dropdown-title"><span class="title">部署</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/deploy/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/shell/1.start.html" class="nav-link">
  Shell
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/nginx/" class="nav-link">
  Nginx
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/docker/" class="nav-link">
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/CI-CD/1.start.html" class="nav-link">
  CI/CD
</a></li><li class="dropdown-item"><!----> <a href="/blog/deploy/jenkins/1.start.html" class="nav-link">
  Jenkins
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/tool/github/" class="nav-link">
  GitHub
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/chrome/" class="nav-link">
  Chrome
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/charles/" class="nav-link">
  Charles
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/verdaccio/" class="nav-link">
  Verdaccio
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/remote-ssh/" class="nav-link">
  Remote-SSH
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/localtunnel/" class="nav-link">
  Localtunnel
</a></li><li class="dropdown-item"><!----> <a href="/blog/tool/AI/" class="nav-link">
  AI工具
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/oneyoung19" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/cs/http/communication.html" class="sidebar-link">HTTP通信</a></li><li><a href="/blog/cs/http/url.html" class="sidebar-link">URL类</a></li><li><a href="/blog/cs/http/formdata.html" class="sidebar-link">FormData</a></li><li><a href="/blog/cs/http/xhr-fetch.html" aria-current="page" class="active sidebar-link">XHR/Fetch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_1-form" class="sidebar-link">1.Form</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_2-xhr" class="sidebar-link">2.XHR</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_2-1-基础使用" class="sidebar-link">2-1.基础使用</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_2-2-请求头" class="sidebar-link">2-2.请求头</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_2-3-响应头" class="sidebar-link">2-3.响应头</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_2-4-实例属性" class="sidebar-link">2-4.实例属性</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_2-5-监听进度" class="sidebar-link">2-5.监听进度</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_2-6-中止请求" class="sidebar-link">2-6.中止请求</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_3-fetch" class="sidebar-link">3.Fetch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_3-1-基础使用" class="sidebar-link">3-1.基础使用</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_3-2-post-请求" class="sidebar-link">3-2.POST 请求</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_3-3-请求头" class="sidebar-link">3-3.请求头</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_3-4-响应头" class="sidebar-link">3-4.响应头</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_3-5-可设置属性" class="sidebar-link">3-5.可设置属性</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_3-6-监听进度" class="sidebar-link">3-6.监听进度</a></li><li class="sidebar-sub-header"><a href="/blog/cs/http/xhr-fetch.html#_3-7-中止请求" class="sidebar-link">3-7.中止请求</a></li></ul></li></ul></li><li><a href="/blog/cs/http/cors.html" class="sidebar-link">CORS</a></li><li><a href="/blog/cs/http/cookie.html" class="sidebar-link">Cookie</a></li><li><a href="/blog/cs/http/security.html" class="sidebar-link">前端网络安全</a></li><li><a href="/blog/cs/http/upload.html" class="sidebar-link">文件上传</a></li><li><a href="/blog/cs/http/download.html" class="sidebar-link">文件下载</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>本节重点讲述前端实现网络通讯的方式 <code>XMLHttpRequest</code> 与 <code>Fetch</code>，以及这两种方式在实际应用过程中可能出现的问题，或需要注意的地方。</p> <h2 id="_1-form"><a href="#_1-form" class="header-anchor">#</a> 1.Form</h2> <p>在开始正式的章节之前，先了解下前端在刀耕火种年代的通讯方式。</p> <p>在 <code>JavaScript</code> 这门脚本语言还没有出现的时候，前端与<strong>服务端</strong>通讯，主要是依赖 <code>Html</code> 中的 <code>form</code> 表单以及其 <code>submit</code> 提交。</p> <p>但这种形式不好的一点在于 <strong><code>submit</code> 提交后，会造成页面跳转到目标 <code>URL</code></strong>。体验极差。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>对这种场景，有一种优化手段是这样的：</p> <p>可以通过设置一个<strong>隐藏</strong>的 <code>&lt;iframe&gt;</code> 标签，并设置其 <code>id</code>，<code>&lt;iframe id=&quot;iframeId&quot;&gt;</code>，然后 <code>&lt;form&gt;</code> 标签设置 <code>target</code> 属性：</p> <p><code>&lt;form target=&quot;iframeId&quot;&gt;</code></p> <p>这样的话，<code>form</code> 提交时，页面就不会发生跳转。</p></div> <p>即使我们按照上述方式，优化了页面跳转的用户体验，但<strong>往往真实场景下，我们还要获取服务端的数据信息</strong>。</p> <p>在上述方式下，服务端数据信息会加载在 <code>&lt;iframe&gt;</code> 标签内。</p> <p>确实，我们依然可以通过某些手段来获取 <code>&lt;iframe&gt;</code> 标签内的数据（<strong>在某些浏览器下可能会有限制</strong>）。</p> <p>综合来看，<code>&lt;form&gt;</code> 表单的形式过于冗余，实际操作也会比较麻烦，完全不满足前端发展需要。</p> <p>在这种历史下，<a href="https://zh.wikipedia.org/zh-cn/AJAX" target="_blank" rel="noopener noreferrer">AJAX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>即 <code>Asynchrounous JavaScript and XML</code> 横空出世。</p> <h2 id="_2-xhr"><a href="#_2-xhr" class="header-anchor">#</a> 2.XHR</h2> <p><code>AJAX</code> 技术中的重要组成部分，即 <code>XHR</code>。</p> <p><code>XHR</code> 的全称为 <code>XMLHttpRequest</code>。</p> <p>该技术是目前大多数网站的主流通讯手段。</p> <h3 id="_2-1-基础使用"><a href="#_2-1-基础使用" class="header-anchor">#</a> 2-1.基础使用</h3> <ol><li>创建 <code>XMLHttpRequest</code></li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li><p><code>xhr.open(method, url, [async, user, password])</code></p> <ul><li><code>method</code> 请求方法</li> <li><code>url</code> 请求地址</li> <li>可选参数：
<ul><li><code>async</code>，设置为 <code>false</code> 时，请求会是同步形式。默认是 <code>true</code>，即<strong>异步加载</strong>。</li> <li><code>user</code> 登录名。</li> <li><code>password</code> 密码。</li></ul></li></ul></li> <li><p><code>xhr.send([body])</code></p> <ul><li>可选参数：
<ul><li><code>body</code> 请求体。（当请求方式为 <code>POST</code> 时，可传递 <code>body</code>）</li></ul></li></ul></li> <li><p><code>xhr</code>相关监听事件</p> <ul><li><code>xhr.onreadystatechange</code></li> <li><code>xhr.onprogress</code></li> <li><code>xhr.onload</code></li> <li><code>xhr.onerror</code></li></ul></li></ol> <p>事件中，以往代码中较为常用的是 <code>onreadystatechange</code>。</p> <p>此处记录下 <code>readyState</code> 在不同值下的表示含义：</p> <ul><li><code>0 UNSET</code> 初始状态</li> <li><code>1 OPENED</code> <code>open</code> 被调用</li> <li><code>2 HEADERS_RECEIVED</code> 接收到 <code>response header</code></li> <li><code>3 LOADING</code> 响应正在被加载（接收到一个数据包）</li> <li><code>4 DONE</code> 请求完成</li></ul> <p><code>XMLHttpRequest</code> 对象以 <code>0 → 1 → 2 → 3 → … → 3 → 4</code> 的顺序在它们之间转变。</p> <p>每当通过网络接收到一个数据包，就会重复一次状态 <code>3</code>。</p> <p>可能在非常老的代码中找到 <code>readystatechange</code> 这样的事件监听器，它的存在是有历史原因的，因为曾经有很长一段时间都没有 <code>load</code> 以及其他事件。</p> <p>如今，它已被 <code>load/error/progress</code> 事件处理程序所替代。</p> <ol start="5"><li>响应
<ul><li><code>status</code></li> <li><code>statusText</code></li> <li><code>response</code></li></ul></li></ol> <h3 id="_2-2-请求头"><a href="#_2-2-请求头" class="header-anchor">#</a> 2-2.请求头</h3> <p>设置请求头：</p> <p><code>xhr.setRequestHeader(key, value)</code></p> <p>但部分请求头，是浏览器自动添加的。譬如 <code>Referer</code>、<code>Host</code> 等。</p> <ul><li><code>Accept-Charset</code></li> <li><code>Accept-Encoding</code></li> <li><code>Access-Control-Request-Headers</code></li> <li><code>Access-Control-Request-Method</code></li> <li><code>Connection</code></li> <li><code>Content-Length</code></li> <li><code>Cookie</code></li> <li><code>Cookie2</code></li> <li><code>Date</code></li> <li><code>DNT</code></li> <li><code>Expect</code></li> <li><code>Host</code></li> <li><code>Keep-Alive</code></li> <li><code>Origin</code></li> <li><code>Referer</code></li> <li><code>Set-Cookie</code></li> <li><code>TE</code></li> <li><code>Trailer</code></li> <li><code>Transfer-Encoding</code></li> <li><code>Upgrade</code></li> <li><code>Via</code></li></ul> <p>更多详细介绍可见<a href="https://xhr.spec.whatwg.org/#the-setrequestheader()-method" target="_blank" rel="noopener noreferrer">此处<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>为了用户安全和请求的正确性，<code>XMLHttpRequest</code> 不允许更改它们。</p> <p><strong>当进行添加不被允许的请求头时，会被忽略</strong>。</p> <p><code>Request Header</code> 一旦设置，无法覆盖、移除。</p> <p>譬如，设置</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span>

xhr<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> <span class="token number">456</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>最终的请求头结果是 <code>token: 123, 456</code>，而不是 <code>token: 456</code>。</p> <h3 id="_2-3-响应头"><a href="#_2-3-响应头" class="header-anchor">#</a> 2-3.响应头</h3> <p>通过 <code>xhr</code> 获取响应头有俩种方式：</p> <ol><li>获取所有响应头， <code>xhr.getAllResponseHeaders()</code>。</li> <li>获取固定响应头，<code>xhr.getResponseHeader(key)</code>。</li></ol> <p>通过 <code>xhr.getAllResponseHeaders()</code> 获取到的响应头，有如下 <code>console</code> 打印：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>accept-ranges: bytes
access-control-allow-credentials: true
cache-control: public, max-age=0
content-length: 1944
content-type: text/html; charset=UTF-8
date: Sat, 17 Sep 2022 11:17:34 GMT
etag: W/&quot;1ad-1834acfa7cd&quot;
last-modified: Sat, 17 Sep 2022 09:37:46 GMT
vary: Origin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>各行 <code>header</code> 之间的换行符始终为 <code>\r\n</code>，（不依赖于操作系统）。</p> <p>证明这个的方式如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> allResponseHeaders <span class="token operator">=</span> xhr<span class="token punctuation">.</span><span class="token function">getAllResponseHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>allResponseHeaders<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>allResponseHeaders<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>打印结果：</p> <p><img src="https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/e6c9d24ely1h69tvgduxjj22k80nagtb.jpg" alt=""></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>\r</code> 代表光标移动到该行的首部</p> <p><code>\n</code> 代表光标换行</p></div> <p><code>xhr.getResponseHeader(key)</code> 中，<code>key</code> 值是<strong>大小写不敏感的</strong>，即 <code>byte-case-insensitive</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">)</span> <span class="token comment">// key值是大小写不敏感的</span>

xhr<span class="token punctuation">.</span><span class="token function">getResponseHeader</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">)</span> <span class="token comment">// 获取不存在的header的话，返回null</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-4-实例属性"><a href="#_2-4-实例属性" class="header-anchor">#</a> 2-4.实例属性</h3> <p>可以给 <code>XMLHttpRequest</code> 的实例设置属性，以自定义某些行为。</p> <ol><li><code>responseType</code> 响应类型
<ul><li><code>''</code> 响应格式为字符串</li> <li><code>text</code> 响应格式为字符串</li> <li><code>arraybuffer</code> 响应格式为 <code>ArrayBuffer</code></li> <li><code>blob</code> 响应格式为 <code>Blob</code></li> <li><code>document</code> 响应格式为 <code>XML document</code> 或 <code>HTML document</code></li> <li><code>json</code> 响应格式为 <code>JSON</code></li></ul></li></ol> <p>譬如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'blob'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>设置之后，浏览器会将服务端响应自动转化为 <code>blob</code>。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在 <code>Fetch</code> 中，并没有此属性。</p> <p>但可以利用 <code>response</code> 的 <code>blob()</code> 方法手动转化响应。</p></div> <ol start="2"><li><code>timeout</code> 超时时间，单位 <code>ms</code>。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span>timeout <span class="token operator">=</span> <span class="token number">3000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li><code>withCredentials</code> 跨源时，是否携带凭证。
当发生跨源时，<code>ajax</code> 默认不会将 <code>cookie</code> 或其他 <code>HTTP</code> 授权凭证发送到其他源。</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span>withCredentials <span class="token operator">=</span> <span class="token boolean">true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>下图为跨源场景下，是否设置 <code>withCredentials</code> 时，请求头信息的区别：</p> <p><img src="https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/e6c9d24ely1h69vue1qttj21sr0u012e.jpg" alt=""></p> <h3 id="_2-5-监听进度"><a href="#_2-5-监听进度" class="header-anchor">#</a> 2-5.监听进度</h3> <p>关于 <code>ajax</code> 进度，涉及到<strong>上传进度</strong>和<strong>下载进度</strong>。</p> <p><code>xhr</code> 提供了一个专门用于上传控制的对象，即 <code>xhr.upload</code>。</p> <p>该对象提供了一系列事件，可以用于<strong>监听上传</strong>：</p> <ul><li><code>loadstart</code> —— 上传开始。</li> <li><code>progress</code> —— 上传期间定期触发。</li> <li><code>abort</code> —— 上传中止。</li> <li><code>error</code> —— 非 <code>HTTP</code> 错误。</li> <li><code>load</code> —— 上传成功完成。</li> <li><code>timeout</code> —— 上传超时（如果设置了 <code>timeout</code> 属性）。</li> <li><code>loadend</code> —— 上传完成，无论成功还是 <code>error</code>。</li></ul> <p>譬如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Uploaded </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>loaded<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>total<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> bytes</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Upload finished successfully.</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

xhr<span class="token punctuation">.</span>upload<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error during the upload: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>xhr<span class="token punctuation">.</span>status<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>要注意两点：</p> <ul><li>只适用于上传 <code>file</code>，其他数据形式不会触发。</li> <li>需要在 <code>xhr.send</code> 方法之前进行定义。</li></ul></div> <p>监听<strong>下载进度</strong>的话，则是可以使用 <code>xhr.onprogress</code> 方法。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onprogress</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_2-6-中止请求"><a href="#_2-6-中止请求" class="header-anchor">#</a> 2-6.中止请求</h3> <p><code>xhr</code> 可直接利用 <code>xhr.abort()</code> 来中止请求。</p> <p>此时 <code>xhr.status</code> 会变为 <code>0</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>xhr<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="_3-fetch"><a href="#_3-fetch" class="header-anchor">#</a> 3.Fetch</h2> <p><code>fetch</code> 是一种新提出的基于 <code>Promise</code> 的现代通讯方法。</p> <p>旧版本的浏览器不支持它（可以 <code>polyfill</code>），但是它在现代浏览器中的<a href="https://caniuse.com/fetch" target="_blank" rel="noopener noreferrer">支持情况<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>很好。</p> <h3 id="_3-1-基础使用"><a href="#_3-1-基础使用" class="header-anchor">#</a> 3-1.基础使用</h3> <p><code>var p = fetch(url, [options])</code></p> <ul><li><code>url</code> 要访问的 <code>URL</code>。</li> <li><code>options</code> 可选参数
<ul><li><code>method</code> 请求方式，<code>GET</code>、<code>POST</code> 等。</li> <li><code>header</code> 设置自定义请求头。</li></ul></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:3000'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'X-Requested-With'</span><span class="token operator">:</span> <span class="token number">123</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	<span class="token comment">//通讯失败的话 TypeError: Failed to fetch</span>
	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>打印的 <code>response</code> 如下：</p> <p><img src="https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/e6c9d24ely1h69wgkpzhwj21gi0rstd8.jpg" alt=""></p> <p>可以看出，该 <code>response</code> 对象的属性有：</p> <ul><li><code>body</code> 响应体。<code>ReadableStream</code> 类型。</li> <li><code>bodyUsed</code> 响应体是否已处理转化</li> <li><code>headers</code> 响应体</li> <li><code>ok</code> 布尔值，如果 <code>HTTP</code> 状态码为 <code>200-299</code>，则为 <code>true</code>。</li> <li><code>redirected</code> 布尔值，是否重定向。</li> <li><code>status</code> <code>HTTP</code> 状态码，例如 <code>200</code>。</li> <li><code>statusText</code> 状态描述文本。</li> <li><code>type</code> 通讯类型。
<ul><li><code>basic</code> 基础、普通</li> <li><code>opaque</code> 不透明、保密。</li></ul></li> <li><code>url</code> 通讯地址。</li></ul> <p>我们得到的响应体数据是 <code>ReadableStream</code> 类型，允许逐块读取 <code>body</code>，需要使用特定的方法进行二次处理，这与 <code>xhr</code> 设置 <code>responseType</code>，直接获取对应类型的数据方式是不一致的。</p> <p><code>Response</code> 提供了多种基于 <code>Promise</code> 的方法，来以不同的格式访问 <code>body</code> 数据。</p> <p>可见上图中的原型属性上的额外方法：</p> <ul><li><code>text()</code>  文本形式。</li> <li><code>json()</code>  以 <code>JSON</code> 形式解析。</li> <li><code>formData()</code> <code>FormData</code> 形式。</li> <li><code>blob()</code> <code>Blob</code> 形式。</li> <li><code>ArrayBuffer()</code> <code>ArrayBuffer</code> 形式。</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>只能选择一种读取 <code>body</code> 的方法</strong>，譬如：</p> <p>使用 <code>response.text()</code>，此时 <code>response.bodyUsed</code> 属性已变为 <code>true</code>。</p> <p>紧接着使用 <code>response.json()</code>，则会报错：<code>Failed to execute 'json' on 'Response': body stream already read</code>。</p></div> <h3 id="_3-2-post-请求"><a href="#_3-2-post-请求" class="header-anchor">#</a> 3-2.<code>POST</code> 请求</h3> <p><code>GET</code> 请求直接通过 <code>queryString</code> 的形式即可进行请求查询。</p> <p>这里我们着重分析下，在 <code>POST</code> 请求下，设置 <code>body</code> 选项进行传递数据。</p> <p>首先，简单封装一个 <code>fetch</code> 请求：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">fetchByPost</span> <span class="token punctuation">(</span><span class="token parameter">body<span class="token punctuation">,</span> headers</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'http://127.0.0.1:3000/save'</span>
  <span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
    headers<span class="token punctuation">,</span>
    body
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h4 id="_1-普通字符串"><a href="#_1-普通字符串" class="header-anchor">#</a> 1. 普通字符串</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fetchByPost</span><span class="token punctuation">(</span><span class="token string">'Hello world'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当请求体是普通字符串时：</p> <p><strong>浏览器会自动设置请求头 <code>Content-Type: text/plain;charset=UTF-8</code></strong>。</p></div> <p><button id="btn-string">普通字符串</button> <script>
var btn= document.querySelector('#btn-string')
btn.addEventListener('click', function () {
fetchByPost('Hello world')
})
</script></p> <h4 id="_2-json-字符串"><a href="#_2-json-字符串" class="header-anchor">#</a> 2. <code>JSON</code> 字符串</h4> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fetchByPost</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'Hello world'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当请求体是 <code>JSON</code> 字符串时：</p> <p><strong>浏览器会自动设置请求头 <code>Content-Type: text/plain;charset=UTF-8</code></strong>。</p></div> <p><button id="btn-json">JSON字符串</button> <script>
var btn= document.querySelector('#btn-json')
btn.addEventListener('click', function () {
fetchByPost(JSON.stringify({ text: 'Hello world' }))
})
</script></p> <p>为了保证服务端，能够根据 <code>Content-Type</code> 正确解析我们的请求，所以往往需要手动设置请求头 <code>Content-Type: application/json</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fetchByPost</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> text<span class="token operator">:</span> <span class="token string">'Hello world'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><button id="btn-json-header">发送JSON请求头</button> <script>
var btn= document.querySelector('#btn-json-header')
btn.addEventListener('click', function () {
fetchByPost(JSON.stringify({ text: 'Hello world' }), {
'Content-Type': 'application/json'
})
})
</script></p> <h4 id="_3-urlsearchparams"><a href="#_3-urlsearchparams" class="header-anchor">#</a> 3. <code>URLSearchParams</code></h4> <p><code>URLSearchParams</code> 的参数形式可以看做是 <code>name=a&amp;value=b&amp;...</code> 这种形式。</p> <p>这种形式，也被称作 <code>application/x-www-urlencoded</code> 编码形式。</p> <p>为了更便捷的操作，<code>JavaScript</code> 提供原生了 <code>URL</code> (操作路径) 和 <code>URLSearchParams</code> (操作路径参数) 两类构造函数。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当请求体是 <code>URLSearchParams</code> 构造函数的实例时：</p> <p><strong>浏览器会自动设置请求头 <code>Content-Type: application/x-www-form-urlencoded;charset=UTF-8</code></strong>。</p> <p><strong>也可以调用 <code>urlSearchParams.toString()</code>，然后开发者手动声明<code>Content-Type: application/x-www-form-urlencoded;charset=UTF-8</code>，这样浏览器也能正确解析请求体</strong>。</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ①示例一</span>
<span class="token keyword">var</span> urlSearchParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLSearchParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
urlSearchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Jack'</span><span class="token punctuation">)</span>
urlSearchParams<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Tom'</span><span class="token punctuation">)</span>
urlSearchParams<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Jerry'</span><span class="token punctuation">)</span>
<span class="token function">fetchByPost</span><span class="token punctuation">(</span>urlSearchParams<span class="token punctuation">)</span>

<span class="token comment">// ②示例二</span>
<span class="token function">fetchByPost</span><span class="token punctuation">(</span>urlSearchParams<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/x-www-form-urlencoded'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><button id="btn-params-demo-one">示例一</button> <button id="btn-params-demo-two">示例二</button> <script>
var btnOne = document.querySelector('#btn-params-demo-one')
var btnTwo = document.querySelector('#btn-params-demo-two')
var urlSearchParams = new URLSearchParams()
urlSearchParams.set('name', 'Jack')
urlSearchParams.set('name', 'Tom')
urlSearchParams.append('name', 'Jerry')
btnOne.addEventListener('click', function () {
fetchByPost(urlSearchParams)
})
btnTwo.addEventListener('click', function () {
fetchByPost(urlSearchParams.toString(), {
'Content-Type': 'application/x-www-form-urlencoded'
})
})
</script></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>在 <a href="https://github.com/axios/axios#using-applicationx-www-form-urlencoded-format" target="_blank" rel="noopener noreferrer">axios<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 中，关于<code>application/x-www-form-urlencoded</code> 编码有两种推荐处理形式：</p> <ul><li><code>URLSearchParams</code></li> <li><code>qs</code> 库</li></ul></div> <h4 id="_4-formdata"><a href="#_4-formdata" class="header-anchor">#</a> 4. <code>FormData</code></h4> <p><code>FormData</code> 以 <code>multipart/form-data</code> 形式发送数据。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当请求体是 <code>FormData</code> 构造函数的实例时：</p> <p><strong>浏览器会自动设置请求头 <code>Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryc8BjYr4SYh77YIdb</code></strong>。</p> <p>此处的 <code>boundary</code> 是浏览器自动添加的值，用于区分 <code>FormData</code> 中的参数值。</p> <p>所以，当检测到请求体 <code>body</code> 是 <code>FormData</code> 实例时，通常要将已存在的 <code>Content-Type</code> 请求头删除掉，由浏览器自己控制，否则 <code>boundary</code> 值会缺失。</p> <p>在 <code>axios</code> 的源码中，其正是如此设计的。</p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'Jerry'</span><span class="token punctuation">)</span>
formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'myFile'</span><span class="token punctuation">,</span> <span class="token string">'file'</span><span class="token punctuation">)</span>
<span class="token function">fetchByPost</span><span class="token punctuation">(</span>formData<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><button id="btn-formdata">FormData</button> <script>
var btn = document.querySelector('#btn-formdata')
var formData = new FormData()
formData.append('name', 'Jerry')
formData.append('myFile', 'file')
btn.addEventListener('click', function () {
fetchByPost(formData)
})
</script></p> <h4 id="_5-blob-buffersource"><a href="#_5-blob-buffersource" class="header-anchor">#</a> 5. <code>Blob/BufferSource</code></h4> <p>可利用 <code>Blob/BufferSource</code> 发送二进制数据。</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>当请求体是 <code>Blob</code> 构造函数的实例时：</p> <p><strong>浏览器会根据 <code>Blob</code> 的内建类型，自动添加对应的请求头。</strong></p></div> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'hello world'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'image/png'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token function">fetchByPost</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><button id="btn-blob">Blob</button> <script>
var btn = document.querySelector('#btn-blob')
var blob = new Blob(['hello world'], {
type: 'image/png'
})
btn.addEventListener('click', function () {
fetchByPost(blob)
})
</script></p> <h3 id="_3-3-请求头"><a href="#_3-3-请求头" class="header-anchor">#</a> 3-3.请求头</h3> <p>在 <code>fetch</code> 中设置自定义请求头的话，直接配置 <code>headers</code> 对象实现即可。</p> <p>但正如我们之前提到过的，出于浏览器的限制，我们无法对部分 <a href="https://fetch.spec.whatwg.org/#forbidden-header-name" target="_blank" rel="noopener noreferrer">forbidden HTTP headers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 进行覆盖设置：</p> <ul><li><code>Accept-Charset</code>, <code>Accept-Encoding</code></li> <li><code>Access-Control-Request-Headers</code></li> <li><code>Access-Control-Request-Method</code></li> <li><code>Connection</code></li> <li><code>Content-Length</code></li> <li><code>Cookie</code>, <code>Cookie2</code></li> <li><code>Date</code></li> <li><code>DNT</code></li> <li><code>Expect</code></li> <li><code>Host</code></li> <li><code>Keep-Alive</code></li> <li><code>Origin</code></li> <li><code>Referer</code></li> <li><code>TE</code></li> <li><code>Trailer</code></li> <li><code>Transfer-Encoding</code></li> <li><code>Upgrade</code></li> <li><code>Via</code></li> <li><code>Proxy-*</code></li> <li><code>Sec-*</code></li></ul> <p>这些 <code>header</code> 保证了 <code>HTTP</code> 的正确性和安全性，<strong>它们仅由浏览器控制</strong>。</p> <h3 id="_3-4-响应头"><a href="#_3-4-响应头" class="header-anchor">#</a> 3-4.响应头</h3> <p>不同于 <code>xhr</code> 的响应头获取方式，<code>fetch</code> 中的响应头，通过 <code>response</code> 中的 <code>headers</code> 对象来获取。</p> <p><code>headers</code> 是一个类似于 <code>Map</code> 的对象。</p> <p>它并不是 <code>Map</code>，但能使用 <code>get</code> 或者 <code>迭代器</code> 等方法。可以理解成，对于普通对象做了额外拓展。</p> <p>以下是其原型上的方法：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>append: ƒ append()
delete: ƒ delete()
entries: ƒ entries()
forEach: ƒ forEach()
get: ƒ ()
set: f ()
has: ƒ has()
keys: ƒ keys()
values: ƒ values()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>以下是一个应用代码的 <code>demo</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:3000'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> headers <span class="token punctuation">}</span> <span class="token operator">=</span> response

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Credentials'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// null</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 11</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// text/html; charset=utf-8</span>

  <span class="token comment">// 同样的，发生跨域请求时，只能获取响应头中的简单响应头（&quot;HELP&quot;）</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_3-5-可设置属性"><a href="#_3-5-可设置属性" class="header-anchor">#</a> 3-5.可设置属性</h3> <p><code>fetch(url, [options])</code></p> <p>本节，重点总结 <code>options</code> 可选参数中的所有可配置属性：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8085'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">/*
    请求方式
  */</span>
  method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    请求头
  */</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/*
	  请求体
  */</span>
  body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fileName<span class="token operator">:</span> <span class="token string">'file-1663733546921'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    AbortController 来中止请求
  */</span>
  signal<span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    same-origin 同源的情况下发送凭证
    omit 任何情况下都不发送凭证
    include 任何情况下都发送凭证
  */</span>
  credentials<span class="token operator">:</span> <span class="token string">&quot;same-origin&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    - 默认值为 about:client 以客户端规则为准（个人推测）
    - 空字符串&quot;&quot; 以不发送 Referer header，
    - 或者直接写作当前源的 url，写作其他源的url不会起作用
  */</span>
  referrer<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    可设置项与http中的referrerPolicy保持一致，譬如：
    strict-origin-when-cross-origin
    no-referrer-when-downgrade
    no-referrer
    origin
    same-origin
    ...
  */</span>
  referrerPolicy<span class="token operator">:</span> <span class="token string">&quot;no-referrer-when-downgrade&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    cors 标识这是一个跨源请求
    no-cors 标识这不是一个跨源请求。在跨源请求中设置该项时，fetch结果的body是null，即使响应body有数据。也就是该响应会变成不透明类型 `opaque`。
    same-origin 同源请求
  */</span>
  mode<span class="token operator">:</span> <span class="token string">'no-cors'</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    &quot;default&quot; —— fetch 使用标准的 HTTP 缓存规则和 header，
    &quot;no-store&quot; —— 完全忽略 HTTP 缓存，如果我们设置 header If-Modified-Since，If-None-Match，If-Unmodified-Since，If-Match，或 If-Range，则此模式会成为默认模式，
    &quot;reload&quot; —— 不从 HTTP 缓存中获取结果（如果有），而是使用响应填充缓存（如果 response header 允许此操作），
    &quot;no-cache&quot; —— 如果有一个已缓存的响应，则创建一个有条件的请求，否则创建一个普通的请求。使用响应填充 HTTP 缓存，
    &quot;force-cache&quot; —— 使用来自 HTTP 缓存的响应，即使该响应已过时（stale）。如果 HTTP 缓存中没有响应，则创建一个常规的 HTTP 请求，行为像正常那样，
    &quot;only-if-cached&quot; —— 使用来自 HTTP 缓存的响应，即使该响应已过时（stale）。如果 HTTP 缓存中没有响应，则报错。只有当 mode 为 same-origin 时生效。
  */</span>
  cache<span class="token operator">:</span> <span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    follow 默认值，遵循 HTTP 重定向
    error HTTP 重定向时报错
    manual 允许手动处理 HTTP 重定向。在重定向的情况下，我们将获得一个特殊的响应对象，其中包含 response.type=&quot;opaqueredirect&quot; 和归零/空状态以及大多数其他属性。
  */</span>
  redirect<span class="token operator">:</span> <span class="token string">&quot;follow&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    子资源完整性
    一个 hash，像 &quot;sha256-abcdef1234567890&quot;
  */</span>
  integrity<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">/*
    keepalive 选项表示该请求可能会在网页关闭后继续存在
  */</span>
  keepalive<span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br></div></div><h3 id="_3-6-监听进度"><a href="#_3-6-监听进度" class="header-anchor">#</a> 3-6.监听进度</h3> <p>截止到本文更新日期，<code>2022年09月30日</code>，<code>fetch</code> 没有提供监听上传进度的方式，也没有其他 <code>hack</code> 方式。</p> <p>相对的，<code>XMLHttpRequest</code> 则有原生的 <code>xhr.upload.onprogress</code> 以及 <code>xhr.onprogress</code> 两事件来监听进度。</p> <p><code>fetch</code> 的下载进度监听方式，则可以使用一种 <code>hack</code> 方式。具体实现思路如下：</p> <ul><li>服务端需要返回 <code>Content-Length</code>，即<strong>总长度 <code>total</code></strong>。</li> <li>根据读取结果，拼接 <code>length</code>，即<strong>加载长度 <code>loaded</code></strong>。</li></ul> <p>利用 <code>fetch</code> 获取到的<strong>响应体数据</strong>是可读流<a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream" target="_blank" rel="noopener noreferrer">ReadableStream<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>读取 <code>ReadableStream</code> 需要利用 <a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStreamDefaultReader" target="_blank" rel="noopener noreferrer">ReadableStreamDefaultReader<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:3000/download'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
  headers<span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  body<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    fileName<span class="token operator">:</span> <span class="token string">'file-1663733546921'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> receivedLength <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token comment">// 获取Content-Length</span>
  <span class="token keyword">const</span> contentLength <span class="token operator">=</span> response<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Content-Length'</span><span class="token punctuation">)</span>
  <span class="token comment">// ReadableStream</span>
  <span class="token keyword">const</span> stream <span class="token operator">=</span> response<span class="token punctuation">.</span>body
  <span class="token comment">// ReadableStreamDefaultReader</span>
  <span class="token keyword">const</span> reader <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> done<span class="token punctuation">,</span> value <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      receivedLength <span class="token operator">+=</span> value<span class="token punctuation">.</span>length
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Received </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>receivedLength<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>contentLength<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="_3-7-中止请求"><a href="#_3-7-中止请求" class="header-anchor">#</a> 3-7.中止请求</h3> <p><code>fetch</code> 函数返回的是 <code>promise</code>。</p> <p>而 <code>promise</code> 一般是没有中止 <code>abort</code> 的说法。</p> <p>为此，有一个特殊的内建对象 <code>AbortController</code>，它不仅可以中止 <code>fetch</code>，还可以中止其他异步任务。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://raw.githubusercontent.com/oneyoung19/vuepress-blog-img/main/img/e6c9d24ely1h6fhtj864tj21340o0424.jpg" alt=""></p> <h4 id="_1-reject-中止-promise"><a href="#_1-reject-中止-promise" class="header-anchor">#</a> 1.<code>reject</code> 中止 <code>promise</code></h4> <p>因为 <code>fetch</code> 本身支持 <code>promise</code>，所以在了解中止 <code>fetch</code> 之前，我们先实现如何中止 <code>Promise</code>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> r <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">function</span> <span class="token function">timeout</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    r <span class="token operator">=</span> reject
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">timeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">r</span><span class="token punctuation">(</span><span class="token string">'fail'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>上一种方式是把 <code>reject</code> 暴露出来，<code>promise</code> 的状态一旦确定，就不能再更改。</p> <p>该方式的缺点是如果多个 <code>promise</code>，就需要声明多个 <code>reject</code> 变量，难以维护。</p> <p>因此可以选择，包装一下 <code>promise</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> abort <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resovle<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token function">executor</span><span class="token punctuation">(</span>resovle<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
          <span class="token function-variable function">abort</span> <span class="token operator">=</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      p<span class="token punctuation">.</span>abort <span class="token operator">=</span> abort
      <span class="token keyword">return</span> p
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 这里不能直接把 then 和 catch 加到上面的末尾去。主要原因是在于then是有返回值的</span>
<span class="token comment">// test</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>

test<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token string">'aborted!'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这里的中止 <code>promise</code>，原理实际上是将 <code>reject</code> 操作权暴露给了外部，供外部在合适的时机调用 <code>reject</code>, 以使 <code>promise</code> 的状态变为 <code>rejected</code>。</p> <p><strong>并不是严格意义上的 <code>abort</code>。</strong></p></div> <h4 id="_2-abort-中止-fetch"><a href="#_2-abort-中止-fetch" class="header-anchor">#</a> 2.<code>abort</code> 中止 <code>fetch</code></h4> <p><code>ES</code> 语法中有 <code>AbortController</code> 与 <code>AbortSignal</code>。</p> <p>而 <code>fetch</code> 的设计，兼容了这俩类构造函数，以实现 <code>abort</code>。</p> <p>具体使用方法如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">'https://jsonplaceholder.typicode.com/users/1'</span>
<span class="token keyword">const</span> abortController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> abortController

<span class="token function">fetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  method<span class="token operator">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
  signal
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

abortController<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>需要额外注意一点，<strong><code>abort</code> 方法的调用，其 <code>this</code> 指向必须指向 <code>AbortController</code> 实例</strong>。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// ✅</span>
abortController<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ❌ Illegal invocation</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> abort <span class="token punctuation">}</span> <span class="token operator">=</span> abortController
<span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_3-abort-中止-promise"><a href="#_3-abort-中止-promise" class="header-anchor">#</a> 3.<code>abort</code> 中止 <code>promise</code></h4> <p>封装一个支持 <code>AbortController</code> 的 <code>promise</code>：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">executor<span class="token punctuation">,</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">executor</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>signal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        signal<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'abort'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'The use aborted a request'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> abortController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> abortController

<span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  signal
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

abortController<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="_4-abortcontroller的简单实现"><a href="#_4-abortcontroller的简单实现" class="header-anchor">#</a> 4. <code>AbortController</code>的简单实现</h4> <p>此处根据原理，<strong>简单</strong>实现 <code>AbortController</code> 与 <code>AbortSignal</code>:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">AbortController</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>signal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortSignal</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">abort</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>signal<span class="token punctuation">.</span>aborted <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">AbortSignal</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'aborted'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token keyword">get</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token keyword">set</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token string">'abort'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>eventMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">addEventListener</span> <span class="token punctuation">(</span><span class="token parameter">event<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>eventMap<span class="token punctuation">[</span>event<span class="token punctuation">]</span> <span class="token operator">=</span> cb
  <span class="token punctuation">}</span>
  <span class="token function">execute</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>eventMap<span class="token punctuation">[</span>event<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">myFetch</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> signal <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span> <span class="token operator">&gt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'Success'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>signal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      signal<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'abort'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'Reject by abort'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> abortController <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> signal <span class="token punctuation">}</span> <span class="token operator">=</span> abortController

<span class="token function">myFetch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  signal
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

abortController<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/27/2024, 7:35:01 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/cs/http/formdata.html" class="prev">
        FormData
      </a></span> <span class="next"><a href="/blog/cs/http/cors.html">
        CORS
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog/assets/js/app.40d5db5e.js" defer></script><script src="/blog/assets/js/2.edfaf709.js" defer></script><script src="/blog/assets/js/192.09f8b6b7.js" defer></script>
  </body>
</html>
